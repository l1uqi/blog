{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"themes/landscape/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/blank.gif","path":"fancybox/blank.gif","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_loading.gif","path":"fancybox/fancybox_loading.gif","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_loading@2x.gif","path":"fancybox/fancybox_loading@2x.gif","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_sprite.png","path":"fancybox/fancybox_sprite.png","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_overlay.png","path":"fancybox/fancybox_overlay.png","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_sprite@2x.png","path":"fancybox/fancybox_sprite@2x.png","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.css","path":"fancybox/jquery.fancybox.css","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.js","path":"fancybox/jquery.fancybox.js","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.pack.js","path":"fancybox/jquery.fancybox.pack.js","modified":1,"renderable":1},{"_id":"themes/landscape/source/js/script.js","path":"js/script.js","modified":1,"renderable":1},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.eot","path":"css/fonts/fontawesome-webfont.eot","modified":1,"renderable":1},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.svg","path":"css/fonts/fontawesome-webfont.svg","modified":1,"renderable":1},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.ttf","path":"css/fonts/fontawesome-webfont.ttf","modified":1,"renderable":1},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.woff","path":"css/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/landscape/source/css/images/banner.jpg","path":"css/images/banner.jpg","modified":1,"renderable":1},{"_id":"themes/landscape/source/css/fonts/FontAwesome.otf","path":"css/fonts/FontAwesome.otf","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/fancybox_buttons.png","path":"fancybox/helpers/fancybox_buttons.png","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-buttons.css","path":"fancybox/helpers/jquery.fancybox-buttons.css","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-buttons.js","path":"fancybox/helpers/jquery.fancybox-buttons.js","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-media.js","path":"fancybox/helpers/jquery.fancybox-media.js","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-thumbs.js","path":"fancybox/helpers/jquery.fancybox-thumbs.js","modified":1,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-thumbs.css","path":"fancybox/helpers/jquery.fancybox-thumbs.css","modified":1,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/css/index.styl","path":"css/index.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/404.jpg","path":"img/404.jpg","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/css/var.styl","path":"css/var.styl","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/img/friend_404.gif","path":"img/friend_404.gif","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/main.js","path":"js/main.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/tw_cn.js","path":"js/tw_cn.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/algolia.js","path":"js/search/algolia.js","modified":0,"renderable":1},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/local-search.js","path":"js/search/local-search.js","modified":0,"renderable":1}],"Cache":[{"_id":"source/_posts/hello-world.md","hash":"7d98d6592de80fdcd2949bd7401cec12afd98cdf","modified":499162500000},{"_id":"themes/landscape/Gruntfile.js","hash":"71adaeaac1f3cc56e36c49d549b8d8a72235c9b9","modified":499162500000},{"_id":"themes/landscape/.npmignore","hash":"58d26d4b5f2f94c2d02a4e4a448088e4a2527c77","modified":499162500000},{"_id":"themes/landscape/LICENSE","hash":"c480fce396b23997ee23cc535518ffaaf7f458f8","modified":499162500000},{"_id":"themes/landscape/README.md","hash":"37fae88639ef60d63bd0de22314d7cc4c5d94b07","modified":499162500000},{"_id":"themes/landscape/_config.yml","hash":"79ac6b9ed6a4de5a21ea53fc3f5a3de92e2475ff","modified":499162500000},{"_id":"themes/landscape/package.json","hash":"544f21a0b2c7034998b36ae94dba6e3e0f39f228","modified":499162500000},{"_id":"themes/landscape/languages/de.yml","hash":"3ebf0775abbee928c8d7bda943c191d166ded0d3","modified":499162500000},{"_id":"themes/landscape/languages/default.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":499162500000},{"_id":"themes/landscape/languages/fr.yml","hash":"415e1c580ced8e4ce20b3b0aeedc3610341c76fb","modified":499162500000},{"_id":"themes/landscape/languages/ja.yml","hash":"a73e1b9c80fd6e930e2628b393bfe3fb716a21a9","modified":499162500000},{"_id":"themes/landscape/languages/es.yml","hash":"76edb1171b86532ef12cfd15f5f2c1ac3949f061","modified":499162500000},{"_id":"themes/landscape/languages/ko.yml","hash":"881d6a0a101706e0452af81c580218e0bfddd9cf","modified":499162500000},{"_id":"themes/landscape/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":499162500000},{"_id":"themes/landscape/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":499162500000},{"_id":"themes/landscape/languages/pt.yml","hash":"57d07b75d434fbfc33b0ddb543021cb5f53318a8","modified":499162500000},{"_id":"themes/landscape/languages/zh-TW.yml","hash":"53ce3000c5f767759c7d2c4efcaa9049788599c3","modified":499162500000},{"_id":"themes/landscape/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":499162500000},{"_id":"themes/landscape/languages/zh-CN.yml","hash":"ca40697097ab0b3672a80b455d3f4081292d1eed","modified":499162500000},{"_id":"themes/landscape/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":499162500000},{"_id":"themes/landscape/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":499162500000},{"_id":"themes/landscape/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":499162500000},{"_id":"themes/landscape/layout/layout.ejs","hash":"f155824ca6130080bb057fa3e868a743c69c4cf5","modified":499162500000},{"_id":"themes/landscape/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":499162500000},{"_id":"themes/landscape/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":499162500000},{"_id":"themes/landscape/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":499162500000},{"_id":"themes/landscape/scripts/fancybox.js","hash":"aa411cd072399df1ddc8e2181a3204678a5177d9","modified":499162500000},{"_id":"themes/landscape/layout/_partial/after-footer.ejs","hash":"d0d753d39038284d52b10e5075979cc97db9cd20","modified":499162500000},{"_id":"themes/landscape/layout/_partial/archive-post.ejs","hash":"c7a71425a946d05414c069ec91811b5c09a92c47","modified":499162500000},{"_id":"themes/landscape/layout/_partial/archive.ejs","hash":"950ddd91db8718153b329b96dc14439ab8463ba5","modified":499162500000},{"_id":"themes/landscape/layout/_partial/footer.ejs","hash":"93518893cf91287e797ebac543c560e2a63b8d0e","modified":499162500000},{"_id":"themes/landscape/layout/_partial/article.ejs","hash":"c4c835615d96a950d51fa2c3b5d64d0596534fed","modified":499162500000},{"_id":"themes/landscape/layout/_partial/gauges-analytics.ejs","hash":"aad6312ac197d6c5aaf2104ac863d7eba46b772a","modified":499162500000},{"_id":"themes/landscape/layout/_partial/google-analytics.ejs","hash":"f921e7f9223d7c95165e0f835f353b2938e40c45","modified":499162500000},{"_id":"themes/landscape/layout/_partial/head.ejs","hash":"5abf77aec957d9445fc71a8310252f0013c84578","modified":499162500000},{"_id":"themes/landscape/layout/_partial/header.ejs","hash":"7e749050be126eadbc42decfbea75124ae430413","modified":499162500000},{"_id":"themes/landscape/layout/_partial/mobile-nav.ejs","hash":"e952a532dfc583930a666b9d4479c32d4a84b44e","modified":499162500000},{"_id":"themes/landscape/layout/_partial/sidebar.ejs","hash":"930da35cc2d447a92e5ee8f835735e6fd2232469","modified":499162500000},{"_id":"themes/landscape/layout/_widget/archive.ejs","hash":"beb4a86fcc82a9bdda9289b59db5a1988918bec3","modified":499162500000},{"_id":"themes/landscape/layout/_widget/category.ejs","hash":"dd1e5af3c6af3f5d6c85dfd5ca1766faed6a0b05","modified":499162500000},{"_id":"themes/landscape/layout/_widget/recent_posts.ejs","hash":"0d4f064733f8b9e45c0ce131fe4a689d570c883a","modified":499162500000},{"_id":"themes/landscape/layout/_widget/tagcloud.ejs","hash":"b4a2079101643f63993dcdb32925c9b071763b46","modified":499162500000},{"_id":"themes/landscape/layout/_widget/tag.ejs","hash":"2de380865df9ab5f577f7d3bcadf44261eb5faae","modified":499162500000},{"_id":"themes/landscape/source/css/style.styl","hash":"a70d9c44dac348d742702f6ba87e5bb3084d65db","modified":499162500000},{"_id":"themes/landscape/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":499162500000},{"_id":"themes/landscape/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":499162500000},{"_id":"themes/landscape/source/css/_extend.styl","hash":"222fbe6d222531d61c1ef0f868c90f747b1c2ced","modified":499162500000},{"_id":"themes/landscape/source/css/_variables.styl","hash":"628e307579ea46b5928424313993f17b8d729e92","modified":499162500000},{"_id":"themes/landscape/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":499162500000},{"_id":"themes/landscape/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":499162500000},{"_id":"themes/landscape/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":499162500000},{"_id":"themes/landscape/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":499162500000},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":499162500000},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":499162500000},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":499162500000},{"_id":"themes/landscape/source/js/script.js","hash":"2876e0b19ce557fca38d7c6f49ca55922ab666a1","modified":499162500000},{"_id":"themes/landscape/layout/_partial/post/category.ejs","hash":"c6bcd0e04271ffca81da25bcff5adf3d46f02fc0","modified":499162500000},{"_id":"themes/landscape/layout/_partial/post/date.ejs","hash":"6197802873157656e3077c5099a7dda3d3b01c29","modified":499162500000},{"_id":"themes/landscape/layout/_partial/post/gallery.ejs","hash":"3d9d81a3c693ff2378ef06ddb6810254e509de5b","modified":499162500000},{"_id":"themes/landscape/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":499162500000},{"_id":"themes/landscape/layout/_partial/post/title.ejs","hash":"2f275739b6f1193c123646a5a31f37d48644c667","modified":499162500000},{"_id":"themes/landscape/layout/_partial/post/nav.ejs","hash":"16a904de7bceccbb36b4267565f2215704db2880","modified":499162500000},{"_id":"themes/landscape/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":499162500000},{"_id":"themes/landscape/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":499162500000},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":499162500000},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":499162500000},{"_id":"themes/landscape/source/css/_partial/archive.styl","hash":"db15f5677dc68f1730e82190bab69c24611ca292","modified":499162500000},{"_id":"themes/landscape/source/css/_partial/article.styl","hash":"10685f8787a79f79c9a26c2f943253450c498e3e","modified":499162500000},{"_id":"themes/landscape/source/css/_partial/comment.styl","hash":"79d280d8d203abb3bd933ca9b8e38c78ec684987","modified":499162500000},{"_id":"themes/landscape/source/css/_partial/footer.styl","hash":"e35a060b8512031048919709a8e7b1ec0e40bc1b","modified":499162500000},{"_id":"themes/landscape/source/css/_partial/header.styl","hash":"85ab11e082f4dd86dde72bed653d57ec5381f30c","modified":499162500000},{"_id":"themes/landscape/source/css/fonts/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":499162500000},{"_id":"themes/landscape/source/css/_partial/highlight.styl","hash":"bf4e7be1968dad495b04e83c95eac14c4d0ad7c0","modified":499162500000},{"_id":"themes/landscape/source/css/_partial/mobile.styl","hash":"a399cf9e1e1cec3e4269066e2948d7ae5854d745","modified":499162500000},{"_id":"themes/landscape/source/css/_partial/sidebar-bottom.styl","hash":"8fd4f30d319542babfd31f087ddbac550f000a8a","modified":499162500000},{"_id":"themes/landscape/source/css/_partial/sidebar.styl","hash":"404ec059dc674a48b9ab89cd83f258dec4dcb24d","modified":499162500000},{"_id":"themes/landscape/source/css/_partial/sidebar-aside.styl","hash":"890349df5145abf46ce7712010c89237900b3713","modified":499162500000},{"_id":"themes/landscape/source/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":499162500000},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":499162500000},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":499162500000},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":499162500000},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":499162500000},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":499162500000},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":499162500000},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":499162500000},{"_id":"themes/landscape/source/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/LICENSE","hash":"1128f8f91104ba9ef98d37eea6523a888dcfa5de","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/README.md","hash":"c34579d9d7239828ce7d8abc235521eaf4ea9e17","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/README_CN.md","hash":"25cfdbaf9883095322259c4f49bd08f0a7cffa0e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/_config.yml","hash":"81913d80786e8f89ddc9cae77c18905b02b361fd","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/package.json","hash":"f27e1f85ce0c51ffc29ea313cc06edcd288c685f","modified":1667792759902},{"_id":"node_modules/hexo-theme-butterfly/plugins.yml","hash":"d46811a3c50f7057681ac496de4beda107aa26b6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/languages/zh-TW.yml","hash":"947f794e862bb2813e36887f777bdb760f70a322","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/archive.pug","hash":"a0c034c2d319320a54046805e80b58dc48b7e233","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/languages/en.yml","hash":"d1bb560698eb8b0079495b7b18b44facb610f9fd","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/category.pug","hash":"710708cfdb436bc875602abf096c919ccdf544db","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/post.pug","hash":"fc9f45252d78fcd15e4a82bfd144401cba5b169a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/languages/default.yml","hash":"1e37a3695d50e3e61d7c36e58a6dac872a4a56cd","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/index.pug","hash":"e1c3146834c16e6077406180858add0a8183875a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/page.pug","hash":"baf469784aef227e4cc840550888554588e87a13","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/languages/zh-CN.yml","hash":"28b6f0c39155651d747eb595e0a283bc97be2e09","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/bug_report.yml","hash":"fc468a93a64c7a3e408fbac921c9f5a5a8f32027","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/tag.pug","hash":"0440f42569df2676273c026a92384fa7729bc4e9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/config.yml","hash":"7dfe7189ffeaebb6db13842237f8e124649bea3d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/.github/ISSUE_TEMPLATE/feature_request.yml","hash":"996640605ed1e8e35182f0fd9a60a88783b24b03","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/.github/workflows/publish.yml","hash":"05857c2f265246d8de00e31037f2720709540c09","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/.github/workflows/stale.yml","hash":"ac62b989b5550c756e1986fcc68f243170705383","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/404.pug","hash":"cb49f737aca272ccfeb62880bd651eccee72a129","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/additional-js.pug","hash":"346b6b650b9dee4844f3be7865886002f82da24c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/footer.pug","hash":"02390a5b6ae1f57497b22ba2e6be9f13cfb7acac","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head.pug","hash":"7dee9b73acdec2a34d41a45119ebe8bb8650bf6c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/layout.pug","hash":"919020d4cd7ae68694b2326edeed4328c7f933cd","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/pagination.pug","hash":"0b80f04950bd0fe5e6c4e7b7559adf4d0ce28436","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/rightside.pug","hash":"699d0d2cff233628752956c4434125c8203f7d63","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/sidebar.pug","hash":"8d39473ed112d113674a0f689f63fae06c72abd2","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/404.js","hash":"83cd7f73225ccad123afbd526ce1834eb1eb6a6d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/cdn.js","hash":"acfe765fb2c607bff7198630dbfa53a888c36357","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/init.js","hash":"b4940a5c73d3a5cd8bb5883e3041ecdd905a74e0","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/comment.js","hash":"a3d1f417965ca20253c36f9e93429f3df6268856","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/stylus.js","hash":"9819f0996234fbd80d6c50a9e526c56ebf22588d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/events/welcome.js","hash":"3cfc46c749e2fd7ae9c2a17206238ed0e0e17e7d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/filters/random_cover.js","hash":"21379ed2dccb69c43b893895c9d56238c11e5f43","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/aside_archives.js","hash":"2ec66513d5322f185d2071acc052978ba9415a8e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/filters/post_lazyload.js","hash":"932df912976261929f809b7dbd4eb473e7787345","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/aside_categories.js","hash":"e00efdb5d02bc5c6eb4159e498af69fa61a7dbb9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/findArchiveLength.js","hash":"ee3e70098eb0849497d50b75e18cf4a27c397d52","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/inject_head_js.js","hash":"b4cd617c619d1a0df93603721a6fa1317526174b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/page.js","hash":"763dab5c83f50c1c62fffc9a9dfedea29bb4e629","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/helpers/related_post.js","hash":"d368a8830e506c8b5eb6512b709ec8db354d5ea1","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/button.js","hash":"91d954f6e9fe6e571eb8ec9f8996294b2dc3688e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/flink.js","hash":"ab62919fa567b95fbe14889517abda649991b1ee","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/gallery.js","hash":"f79c99f6c5b626c272dc2bed2b0250d6b91bb28a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/hide.js","hash":"396c3ab1bcf1c7693ad7e506eadd13016c6769b6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/inlineImg.js","hash":"a43ee2c7871bdd93cb6beb804429e404570f7929","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/mermaid.js","hash":"531808a290b8bdd66bac2faab211ada8e9646a37","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/label.js","hash":"03b2afef41d02bd1045c89578a02402c28356006","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/note.js","hash":"d51812b43924f1bbf413c67499510dd125022005","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/tabs.js","hash":"6c6e415623d0fd39da016d9e353bb4f5cca444f5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/scripts/tag/timeline.js","hash":"300eb779588bf35a1b687d9f829d866074b707e3","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/index.styl","hash":"861998e4ac67a59529a8245a9130d68f826c9c12","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/img/404.jpg","hash":"fb4489bc1d30c93d28f7332158c1c6c1416148de","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/var.styl","hash":"e018dad9f674fc5564112b99032fe5fe8b2d195f","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/main.js","hash":"189359400f6cd4d814ca9ebb5a27b96f7031bce3","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/utils.js","hash":"0b95daada72abb5d64a1e3236049a60120e47cca","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/tw_cn.js","hash":"5c1391c9e96950833641f178b5f23c58422fb659","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/Open_Graph.pug","hash":"fe4d847177b824e09c75e9c7b723184c708c569a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/config_site.pug","hash":"7df90c8e432e33716517ab918b0a125bc284041b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/analytics.pug","hash":"15530d9ac59c576d79af75dd687efe71e8d261b0","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/google_adsense.pug","hash":"95a37e92b39c44bcbea4be7e29ddb3921c5b8220","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/config.pug","hash":"2df5a033104775ee9c8715925bb32c3ec5b75da0","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/noscript.pug","hash":"d16ad2ee0ff5751fd7f8a5ce1b83935518674977","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/preconnect.pug","hash":"65a23b5170204e55b813ce13a79d799b66b7382c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/pwa.pug","hash":"3d492cfe645d37c94d30512e0b230b0a09913148","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/head/site_verification.pug","hash":"e2e8d681f183f00ce5ee239c42d2e36b3744daad","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/index.pug","hash":"aa175e2254704335f4da09175e59ef2375ca7d03","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/menu_item.pug","hash":"31346a210f4f9912c5b29f51d8f659913492f388","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/nav.pug","hash":"78a3abd90bb3c18cd773d3d5abac3541e7f415e5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/post-info.pug","hash":"9698f22751778dde063cbfbd01c59ca4462ccd85","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/header/social.pug","hash":"0d953e51d04a9294a64153c89c20f491a9ec42d4","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/fullpage-loading.pug","hash":"c4b86758f3a3deae4612c31d725814c8753a7804","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/index.pug","hash":"131f344d68b4c241d6e03849b243ee792fcd3cea","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/loading/pace.pug","hash":"278855fe4399489bdef0393697bb87420e671fe9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/post/post-copyright.pug","hash":"ebecba46a5f4efe1c98a386df06c56e26fbd07b9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/post/reward.pug","hash":"864869c43fe5b5bb6f4ac6b13dd4bfb16ea47550","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/mixins/article-sort.pug","hash":"2fb74d0b0e4b98749427c5a1a1b0acb6c85fadc4","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/mixins/post-ui.pug","hash":"6ae047d566289294cc2f6192cacbff297cec9f1a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/aplayer.pug","hash":"c7cfade2b160380432c47eef4cd62273b6508c58","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/effect.pug","hash":"6528e86656906117a1af6b90e0349c2c4651d5e1","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/pangu.pug","hash":"0f024e36b8116118233e10118714bde304e01e12","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/prismjs.pug","hash":"ffb9ea15a2b54423cd4cd441e2d061b8233e9b58","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/pjax.pug","hash":"fc0b09068009edd4026d90a669608cbe211aeecf","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/subtitle.pug","hash":"142621f70bedcb5033ee99a988f7bb6c5eea3493","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_ad.pug","hash":"60dc48a7b5d89c2a49123c3fc5893ab9c57dd225","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_announcement.pug","hash":"ae392459ad401a083ca51ee0b27526b3c1e1faed","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_archives.pug","hash":"86897010fe71503e239887fd8f6a4f5851737be9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_author.pug","hash":"e37468e63db2a0ac09b65d21b7de3e62425bb455","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_categories.pug","hash":"d1a416d0a8a7916d0b1a41d73adc66f8c811e493","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_bottom_self.pug","hash":"13dc8ce922e2e2332fe6ad5856ebb5dbf9ea4444","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_post_toc.pug","hash":"3057a2f6f051355e35d3b205121af8735100eacf","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_newest_comment.pug","hash":"6d93564a8bd13cb9b52ee5e178db3bcbf18b1bc6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_recent_post.pug","hash":"9c1229af6ab48961021886882c473514101fba21","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_webinfo.pug","hash":"35ce167c5a275211bfc1fa3d49adfde5b404d98f","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_top_self.pug","hash":"ae67c6d4130a6c075058a9c1faea1648bcc6f83e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/index.pug","hash":"7fb096656c8a6c21a4b6a5100885b1081d6021ed","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/widget/card_tags.pug","hash":"438aea3e713ed16b7559b9a80a9c5ec0221263df","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/categories.pug","hash":"5276a8d2835e05bd535fedc9f593a0ce8c3e8437","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/flink.pug","hash":"e3d574921fca8e756923bf3b303835e57b9a26b2","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/default-page.pug","hash":"12c65c174d26a41821df9bad26cdf1087ec5b0ca","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/page/tags.pug","hash":"6311eda08e4515281c51bd49f43902a51832383c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_global/function.styl","hash":"644d520fe80cc82058467708ab82ccad313b0c27","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_global/index.styl","hash":"714f19e7d66df84938bd1b82b33d5667abe1f147","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight.styl","hash":"2f95e99b8351fbecd9037a1bbdc3fee9d6ea8a77","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_mode/darkmode.styl","hash":"a92984f566c97bb4179f34be79240af1552c6f17","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/theme.styl","hash":"bcd384c8b2aa0390c9eb69ac1abbfd1240ce1da4","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_mode/readmode.styl","hash":"69f8e9414526dfda3af9a71c8e528fdd0ecbbfe5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/aside.styl","hash":"a0010d833ed30211601c1e0bbbc68e85b77428c6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/chat.styl","hash":"f9a5d3f1fc5ed0ed2ee4c1eaa58ed650d11ddebd","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/comments.styl","hash":"c61dccca690d486c3d9c29cf028d87b777385141","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/footer.styl","hash":"26be2afa9d4e7016cf3c42a6cd166f01e8e4ad5c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/head.styl","hash":"a457a0dbe23af21a7b6b8bfc5ee103c9fe92e89c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/loading.styl","hash":"ac2aeee9926f75b2a0098efe1c114126987430f2","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/pagination.styl","hash":"fb9f78bfbb79579f1d752cb73fb6d25c8418e0fd","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/post.styl","hash":"23db4e3cab68fed78601fc8a9c39ff5753bcc716","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/relatedposts.styl","hash":"d53de408cb27a2e704aba7f7402b7caebe0410d8","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/reward.styl","hash":"c5cfed620708807a48076b5ee59b0ba84e29aa80","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/rightside.styl","hash":"bd88ee30ebf8ca2e7b4d3a034c317fd61733921f","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/sidebar.styl","hash":"631ca35a38bc4ac052e9caf47508ff1f99842fc7","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_layout/third-party.styl","hash":"56389925671c7e8da0c033769421269e15e8f795","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/404.styl","hash":"50dbb9e6d98c71ffe16741b8c1b0c1b9771efd2b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/archives.styl","hash":"6f4b4ede52305bce9b22c8c897dcbde8af6e2ce4","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/common.styl","hash":"a58d35d698885f1034dedbe99f7dbc1a801412c6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/categories.styl","hash":"f01ee74948cedb44e53cd3bb1ef36b7d2778ede7","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/flink.styl","hash":"98d755b686ee833e9da10afaa40c4ec2bd66c19a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/homepage.styl","hash":"8c90483d461e09cb06e91b16d8bb7b3205b0a40c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_page/tags.styl","hash":"580feb7e8b0822a1be48ac380f8c5c53b1523321","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/button.styl","hash":"45f0c32bdea117540f6b14ebac6450d7142bd710","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/gallery.styl","hash":"a310e48f826a4cacc55d8e68f43806e5085554f6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/hexo.styl","hash":"d76c38adf1d9c1279ef4241835667789f5b736e0","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/inlineImg.styl","hash":"df9d405c33a9a68946b530410f64096bcb72560c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/hide.styl","hash":"ce489ca2e249e2a3cf71584e20d84bdb022e3475","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/label.styl","hash":"66c59e193d794cdb02cca7bd1dc4aea5a19d7e84","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/note.styl","hash":"85ae91c83691ea4511f4277da1194a185251cc78","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/tabs.styl","hash":"bf9568444dd54e39dc59b461323dcd38942f27d9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_tags/timeline.styl","hash":"f071156d439556e7463ed4bc61ceee87170d5d08","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_third-party/normalize.min.css","hash":"2c18a1c9604af475b4749def8f1959df88d8b276","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/algolia.styl","hash":"51e45625929d57c9df3ba9090af99b9b7bb9a15b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/index.styl","hash":"39d61cbe0c1e937f83ba3b147afaa29b4de2f87d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_search/local-search.styl","hash":"25e58a7a8bda4b73d0a0e551643ca01b09ccd7e5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/algolia.js","hash":"9feb248552667c53ce1b19bc7a295215f8c77008","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/js/search/local-search.js","hash":"3071a4208fdf89ad7e0031536dd6ffa7bc951e4d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/disqus.pug","hash":"d85c3737b5c9548553a78b757a7698df126a52cf","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/artalk.pug","hash":"99d9b17668260b242749c16851d9ec1024d31899","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/index.pug","hash":"b2d274db84ef22fbd6d5ea8f4404821898934209","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/remark42.pug","hash":"001e8be47854b891efe04013c240c38fed4185eb","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/fb.pug","hash":"b2aadea7351fae8382b8c2a3b9de810d922b0ec1","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/valine.pug","hash":"39427e107230a10790972349c9dd4c4f31d55eb7","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/waline.pug","hash":"5f648086a33a32d169a2f8d8c549c08aa02f67db","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/card-post-count/twikoo.pug","hash":"58406a7a3bf45815769f652bf3ef81e57dcd07eb","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/chatra.pug","hash":"481cd5053bafb1a19f623554a27d3aa077ea59c3","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/crisp.pug","hash":"76634112c64023177260d1317ae39cef2a68e35f","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/index.pug","hash":"0611d9216f4c128ebdea4cc21454c3dc4a6398d5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/daovoice.pug","hash":"cfe63e7d26a6665df6aa32ca90868ad48e05ec04","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/gitter.pug","hash":"d1d2474420bf4edc2e43ccdff6f92b8b082143df","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/messenger.pug","hash":"ccb7d8ce3ded7364f9a15334b68ad73869fca757","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/chat/tidio.pug","hash":"24a926756c2300b9c561aaab6bd3a71fdd16e16d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/artalk.pug","hash":"49dcc23815e1d5264bb65c91e7dc67b1a723d1ea","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/disqus.pug","hash":"8ec24c1939895ac0db2b2e8700bc9307b4ceb53c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/disqusjs.pug","hash":"98ef20f8a3b10c1692f9b2b3c06033d2da8a8eae","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/facebook_comments.pug","hash":"eefdaa94956adc7a3ca90dd8edcd70a7574b439c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/giscus.pug","hash":"591ef23c583690bd74af0cafb09af64ba5bd8151","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/gitalk.pug","hash":"22e2ef30fe5eb1db7566e89943c74ece029b2a8e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/index.pug","hash":"351fe25fbf02635b1f9e86e5e244c7d61f69baa7","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/js.pug","hash":"00ed91c52939b9675b316137f854d13684c895a6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/livere.pug","hash":"52ea8aa26b84d3ad38ae28cdf0f163e9ca8dced7","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/remark42.pug","hash":"e9bdf80d6796afc04eb809dbbe780d97f22c7fcd","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/twikoo.pug","hash":"e18fbd88d8942e53e771f29b26209ab735c5c567","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/utterances.pug","hash":"a737046e730eb7264606ba0536218964044492f9","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/valine.pug","hash":"e55b9c0f8ced231f47eb88bd7f4ec99f29c5c29d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/comments/waline.pug","hash":"15462d1ed04651ad3b430c682842ac400f6f9b47","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/index.pug","hash":"b8ae5fd7d74e1edcef21f5004fc96147e064d219","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/mathjax.pug","hash":"1c846c8d51649b8554d91536323eaeb20c8fc236","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/mermaid.pug","hash":"8e33aca36a4d3ae9e041ba05ced8eff56ae38f77","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/math/katex.pug","hash":"dfcbd9881be569ea420eff1a6b00e4f4dbe2138e","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/artalk.pug","hash":"c12c898b35dd014780c1f3220ddbe12e7270983c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/disqus-comment.pug","hash":"04b2a5882e789a988e41d45abe606f0617b08e38","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/github-issues.pug","hash":"e846ddfe4a63b15d1416f6055f5756af5e3da7c6","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/index.pug","hash":"4ec0642f2d5444acfab570a6f8c7868e7ff43fde","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/remark42.pug","hash":"ab167c00da4506f591b96f0591bf5bd214a26d4b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/twikoo-comment.pug","hash":"233907dd7f5b5f33412701d2ccffbc0bbae8707b","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/valine.pug","hash":"d19e1c2c0a50f0e4547d71a17b9be88e8152f17c","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/newest-comments/waline.pug","hash":"dd0bc119029b62dce5dc965d5de7377e438fa29a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/algolia.pug","hash":"e8245d0b4933129bb1c485d8de11a9e52e676348","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/index.pug","hash":"da3b9437d061ee68dbc383057db5c73034c49605","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/search/local-search.pug","hash":"178c9cdcc4ce5a006885b24ce4a3d624e4734899","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/add-this.pug","hash":"2980f1889226ca981aa23b8eb1853fde26dcf89a","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/index.pug","hash":"4c4a9c15215ae8ac5eadb0e086b278f76db9ee92","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/addtoany.pug","hash":"85c92f8a7e44d7cd1c86f089a05be438535e5362","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/layout/includes/third-party/share/share-js.pug","hash":"f61d63724ea5c5f352568b3a16bde023affefbe5","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight/diff.styl","hash":"cf1fae641c927621a4df1be5ca4a853b9b526e23","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/highlight/index.styl","hash":"18804c58239d95798fa86d0597f32d7f7dd30051","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/index.styl","hash":"5dc2e0bcae9a54bfb9bdcc82d02ae5a3cf1ca97d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/line-number.styl","hash":"8970cc1916c982b64a1478792b2822d1d31e276d","modified":499162500000},{"_id":"node_modules/hexo-theme-butterfly/source/css/_highlight/prismjs/diff.styl","hash":"5972c61f5125068cbe0af279a0c93a54847fdc3b","modified":499162500000},{"_id":"source/_posts/ESLint 初体验.md","hash":"7886e4512e44b54dfb47e716970a662561d2a28e","modified":1667802847715},{"_id":"source/_posts/Electron 启动动画实现.md","hash":"20005bafedc3c8b4439156046805c37e57a509af","modified":1667803655225},{"_id":"source/_posts/ESLint 如何在Vue或React中使用.md","hash":"6fd45eae93727f543549cb9f03aad126609cdeef","modified":1667802857206},{"_id":"source/_posts/向往的生活.md","hash":"10f229ccb59e155b38936eda87fefa4911883268","modified":1667802060639},{"_id":"source/_posts/27.md","hash":"d948ffe857b01fa8397bb3cd045eaf709c47b24e","modified":1667804807984},{"_id":"source/_posts/CSS 通过子元素设置父元素.md","hash":"c1ff4ba2e903515db48a1160098396db749bece7","modified":1667803623259},{"_id":"source/_posts/Electron自动更新or手动触发更新.md","hash":"941f4c0e64dfd3fbe1d53dcdb237fdfea978da8f","modified":1667803651862},{"_id":"source/_posts/Flutter Andoird 返回键退出友好处理.md","hash":"ff54fc51b6b379d9eca06bcbbeb4650405ea4be3","modified":1667802884613},{"_id":"source/_posts/Luckysheet 初体验.md","hash":"62c614dde0e7675387dc33a3ecc0ea88aa00c6e5","modified":1667802587422},{"_id":"source/_posts/使用Lottie 让动画更简单.md","hash":"47e74ff7b73e6c00cf7b039556f88644bbaf4c5f","modified":1667802635313},{"_id":"source/_posts/Flutter 启动页实现.md","hash":"e60b6f9e0e6aa5981081a3d91935cb2fb83209ed","modified":1667802887817},{"_id":"source/categories/index.md","hash":"66ad6d54238a43e3952a0d693837e70e182f5e08","modified":1667801991463},{"_id":"source/tags/index.md","hash":"1531db36bbf5cc06a88868233a4ab7d57a976248","modified":1667802012442},{"_id":"public/categories/index.html","hash":"b0d610da98a1dfaba491bd350c297d95c59d8563","modified":1675392194713},{"_id":"public/tags/index.html","hash":"60f089ef13d02fcb91ea562e401aa52af1956f71","modified":1675392194713},{"_id":"public/2022/09/10/Luckysheet 初体验/index.html","hash":"6eaf0dea20550a2d78310fb9acc76595a4a51eec","modified":1675392144044},{"_id":"public/2022/08/16/CSS 通过子元素设置父元素/index.html","hash":"a5c4f7222d0cc89f500c5dd15a6ef219438d8ba8","modified":1675392144044},{"_id":"public/2022/08/10/使用Lottie 让动画更简单/index.html","hash":"008767983bdbcd84e089da9deb92ad6f6c97b46c","modified":1675392144044},{"_id":"public/2022/06/10/Flutter 启动页实现/index.html","hash":"3d94fdafe6d10a74ce889f5989ea14a4ae1bff12","modified":1675392144044},{"_id":"public/2022/06/05/Flutter Andoird 返回键退出友好处理/index.html","hash":"9816498388fba3ac3e40f1a5b785bfdd7cd40eae","modified":1675392144044},{"_id":"public/2022/03/20/ESLint 如何在Vue或React中使用/index.html","hash":"c1372e2b295204ecddbea1531933419949d01082","modified":1675392144044},{"_id":"public/2022/03/11/ESLint 初体验/index.html","hash":"92e290307d9073ec2397b403c8bc828c48e4389a","modified":1675392144044},{"_id":"public/2021/11/16/27/index.html","hash":"2806aa82cec10b4e6f112c07cda3670c74e3bc34","modified":1675392144044},{"_id":"public/2021/03/11/Electron 启动动画实现/index.html","hash":"3f760d7bdc59b92a2df92e1d2afc8b88cba3e012","modified":1675392144044},{"_id":"public/2021/01/20/Electron自动更新or手动触发更新/index.html","hash":"2be863c0623f189db88278a34da54e13abc4e0c1","modified":1675392144044},{"_id":"public/2019/09/10/向往的生活/index.html","hash":"f34dd46e079c6b031c50a5ee4641833f9f81b880","modified":1675392144044},{"_id":"public/categories/生活琐碎/index.html","hash":"f2681b599dea0f10bfd2725c86ebac79a6c74c42","modified":1675392194713},{"_id":"public/categories/前端/index.html","hash":"44f54784053f85a3696ba5cf7fe0f325931c5cf7","modified":1675392194713},{"_id":"public/index.html","hash":"dceefb3f54a1cf170fc31eb589b3453f35c4581b","modified":1675392194713},{"_id":"public/page/2/index.html","hash":"87efbd0c9a35c4a21fa3e57f03cb6e8a6293ca4a","modified":1675392194713},{"_id":"public/tags/杂谈/index.html","hash":"84f73e6b2733be3c66e8119f6422735ca186feac","modified":1675392194713},{"_id":"public/tags/Eslint/index.html","hash":"03843d07a8e04b39620826b22340c0c3e8ef6a65","modified":1675392194713},{"_id":"public/tags/Electron/index.html","hash":"221f22c9a0d1d57103a17e7a96a946041bbdc29c","modified":1675392194713},{"_id":"public/tags/CSS/index.html","hash":"fa156571547cad4ef7df6f46e0ab9ee00e43198c","modified":1675392194713},{"_id":"public/tags/Flutter/index.html","hash":"0ab0b2d621a765b452952809f1ef0170fa302a6b","modified":1675392194713},{"_id":"public/tags/动画/index.html","hash":"32752c7f7c392061910eecc54d0610dd0aa5a53b","modified":1675392194713},{"_id":"public/tags/Luckysheet/index.html","hash":"f178d7e2b1cc01c41e23ea680749b77546e2d7c8","modified":1675392194713},{"_id":"public/archives/index.html","hash":"ff2ab07a0eba418284745e8da420efb24c83ca51","modified":1675392194713},{"_id":"public/archives/page/2/index.html","hash":"09c1ba9121ae90ca7e9c4bddb3d3c8b49759930d","modified":1675392194713},{"_id":"public/archives/2019/index.html","hash":"53f08631cfc9f7342de7ed765f259bab3508b142","modified":1675392194713},{"_id":"public/archives/2019/09/index.html","hash":"dfa908fe19211052181f98d8ccb232f0b4ad16a4","modified":1675392194713},{"_id":"public/archives/2021/index.html","hash":"375664f37e8bae60389a56d84ee18634ad121381","modified":1675392194713},{"_id":"public/archives/2021/01/index.html","hash":"91f25e00496547a1aa1be95ab257b91d9738080b","modified":1675392194713},{"_id":"public/archives/2021/03/index.html","hash":"3b07bcb9d11d8a8f69299012d82a44051abbb9c0","modified":1675392194713},{"_id":"public/archives/2021/11/index.html","hash":"08ac4d116ed9689e04439b0bd7a68db7f61db693","modified":1675392194713},{"_id":"public/archives/2022/index.html","hash":"d67e2d431c6326e983bcc8b62c7a03a3d0a30e79","modified":1675392194713},{"_id":"public/archives/2022/03/index.html","hash":"bd6e9202a5a6c54fe47a71f30452578ad2681ed5","modified":1675392194713},{"_id":"public/archives/2022/06/index.html","hash":"5e70de6d127e3d01269cc6824c4dbb7ad09b3541","modified":1675392194713},{"_id":"public/archives/2022/08/index.html","hash":"c287ff6ad888c28681c5939d8eac2f609f17dac4","modified":1675392194713},{"_id":"public/archives/2022/09/index.html","hash":"fdc86080b0badad2d073d1a9d238dee48e0254ba","modified":1675392194713},{"_id":"public/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1675392144044},{"_id":"public/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1675392144044},{"_id":"public/fancybox/fancybox_sprite@2x.png","hash":"8fbed67cfc7b2406a3692b427d78326a097270d1","modified":1675392144044},{"_id":"public/fancybox/fancybox_sprite.png","hash":"03a4c9f8c4a37c1c0309204d2f76c767c56ef109","modified":1675392144044},{"_id":"public/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1675392144044},{"_id":"public/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1675392144044},{"_id":"public/css/fonts/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1675392144044},{"_id":"public/css/fonts/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1675392144044},{"_id":"public/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1675392144044},{"_id":"public/css/fonts/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1675392144044},{"_id":"public/img/favicon.png","hash":"3cf89864b4f6c9b532522a4d260a2e887971c92d","modified":1675392144044},{"_id":"public/img/friend_404.gif","hash":"8d2d0ebef70a8eb07329f57e645889b0e420fa48","modified":1675392144044},{"_id":"public/img/404.jpg","hash":"7d9fd16a04b0ca2e07cd686714ef9b62e7ea020a","modified":1675392144044},{"_id":"public/css/fonts/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1675392144044},{"_id":"public/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1675392144044},{"_id":"public/js/script.js","hash":"2876e0b19ce557fca38d7c6f49ca55922ab666a1","modified":1675392144044},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1675392144044},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1675392144044},{"_id":"public/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1675392144044},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1675392144044},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1675392144044},{"_id":"public/css/var.css","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1675392144044},{"_id":"public/js/utils.js","hash":"0b95daada72abb5d64a1e3236049a60120e47cca","modified":1675392144044},{"_id":"public/js/search/algolia.js","hash":"9feb248552667c53ce1b19bc7a295215f8c77008","modified":1675392144044},{"_id":"public/js/search/local-search.js","hash":"3071a4208fdf89ad7e0031536dd6ffa7bc951e4d","modified":1675392144044},{"_id":"public/css/style.css","hash":"3986ef4b1f56bf0ac3bc45aab261e0278794c3f1","modified":1675392144044},{"_id":"public/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1675392144044},{"_id":"public/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1675392144044},{"_id":"public/css/index.css","hash":"6cdc246b0b9ff65a7a1754550a04e5bbf13798e6","modified":1675392144044},{"_id":"public/js/main.js","hash":"189359400f6cd4d814ca9ebb5a27b96f7031bce3","modified":1675392144044},{"_id":"public/js/tw_cn.js","hash":"5c1391c9e96950833641f178b5f23c58422fb659","modified":1675392144044},{"_id":"public/css/fonts/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1675392144044},{"_id":"public/css/images/banner.jpg","hash":"108bec147ed081f6577ac6f779605840a3f0e5bc","modified":1675392144044},{"_id":"source/_posts/前端业务埋点.md","hash":"f24f427410e09fd7f57dfb4836c4a8da579eafbc","modified":1668563315754},{"_id":"public/2022/11/07/前端业务埋点/index.html","hash":"479b5726f1aef57a978ea7228be847fd84f9a209","modified":1667888997573},{"_id":"public/archives/2022/11/index.html","hash":"e3c3e8a9f0323061e8ad595eb5336c75d1730e45","modified":1675392194713},{"_id":"public/tags/埋点采集/index.html","hash":"07afc86f70e9fcd366a33788ee726d94933b7880","modified":1675392194713},{"_id":"source/_posts/前端曝光实现.md","hash":"82c13719bed74c902286fc2e5d12cb6634f6126a","modified":1668056270597},{"_id":"source/_posts/前端业务埋点曝光实现.md","hash":"7f84bcb65249a9975390f5c3095248539a4d6fff","modified":1670305607471},{"_id":"source/_posts/JS Image加载遇到的问题.md","hash":"0a3acf42e3eba73d2bf78b3ee97c643eece264fc","modified":1668564343664},{"_id":"source/_posts/前端业务埋点数据上报.md","hash":"ebfebcad31b5f17c98194775a8a8373294833204","modified":1670305613211},{"_id":"public/2022/11/15/JS Image加载遇到的问题/index.html","hash":"b513457a7489342f24aafb398fbd625f930e56ef","modified":1675392144044},{"_id":"public/2022/11/08/前端业务埋点曝光实现/index.html","hash":"8d3c7c514872f1a2729a268c2e940afb49c5e6f2","modified":1675392144044},{"_id":"public/2022/11/10/前端业务埋点数据上报/index.html","hash":"10a460d0ebfd5f9ca74cd325485abc168683ce2a","modified":1675392144044},{"_id":"public/2022/11/05/前端业务埋点/index.html","hash":"5dfee4b7ec3e93d9b9b90e2141cf60e6a3b5db1f","modified":1675392144044},{"_id":"public/archives/2022/page/2/index.html","hash":"e79b35879abee11aea292bc81d3c7a1ec6fa3fe1","modified":1675392194713},{"_id":"public/categories/前端/page/2/index.html","hash":"f60a63307b2d67173f1704f6264e351016dc7464","modified":1675392194713},{"_id":"public/tags/图片加载/index.html","hash":"8b16560f68aee2246cc010a86616fdee3150f446","modified":1675392194713},{"_id":"source/_posts/addEventListener中this指向.md","hash":"2195f5768ce2655dd2f1890bf5b476d91aa8ac54","modified":1675390094308},{"_id":"source/_posts/JS对象中addEventListener this指向.md","hash":"b15ea5018a567b570a29815cff36b2fea4f22b83","modified":1675391353118},{"_id":"public/2023/02/03/JS对象中addEventListener this指向/index.html","hash":"8f8d450db8692f3046f0f593a966faa77905ab86","modified":1675392144044},{"_id":"public/archives/2023/index.html","hash":"0bbeb4d383a6d7c8e0c5303e9987d2b28fd02609","modified":1675392194713},{"_id":"public/archives/2023/02/index.html","hash":"da91c8f46a3d743a1653e3bb7ace74821ccd3cd7","modified":1675392194713},{"_id":"public/tags/JS/index.html","hash":"f5678c58fa4ba4e41b8c4ffbcb6a2827c9c51fd5","modified":1675392194713}],"Category":[{"name":"杂谈","_id":"cla6e7lt10001bw774wccg0mg"},{"name":"Web","_id":"cla6e7lt50002bw77faq70s52"},{"name":"生活琐碎","_id":"cla6ecapa0001pk77g4j6cvq8"},{"name":"前端","_id":"cla6ecape0003pk7774axfa0c"}],"Data":[],"Page":[{"title":"分类","date":"2022-11-07T06:17:40.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2022-11-07 14:17:40\ntype: \"categories\"\n---\n","updated":"2022-11-07T06:19:51.463Z","path":"categories/index.html","_id":"cla6e7lsw0000bw770x1qef9e","comments":1,"layout":"page","content":"","site":{"data":{}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":""},{"title":"标签","date":"2022-11-07T06:19:59.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2022-11-07 14:19:59\ntype: \"tags\"\n---\n","updated":"2022-11-07T06:20:12.442Z","path":"tags/index.html","_id":"cla6ecap90000pk777r1j5qv9","comments":1,"layout":"page","content":"","site":{"data":{}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":""}],"Post":[{"title":"ESLint 初体验","top_img":false,"date":"2022-03-10T16:00:00.000Z","cover":"https://img0.baidu.com/it/u=126596768,3405821946&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=286","_content":"\n## 介绍\n\nESLint是一个用来识别 ECMAScript 并且按照规则给出报告的代码检测工具，使用它可以避免低级错误和统一代码的风格。如果每次在代码提交之前都进行一次eslint代码检查，就不会因为某个字段未定义为undefined或null这样的错误而导致服务崩溃，可以有效的控制项目代码的质量\n\n## 好处\n\n俗话说的好没有规矩不成方圆 代码规范是程序员的根本，入门第一步，从规范代码开始。\neslint根本目的是统一项目的代码风格规范，养成规范的写代码习惯，减少不必要的错误和隐患。\n\n\n## 安装\n\n``` sh\n    npm install -g eslint // 全局安装\n\n    npm install --save-dev eslint // 项目安装\n```\n\n## 使用\n\n项目根目录新建.eslintrc.js文件 配置eslint。\n\n如果全局安装eslint可以在项目运行, 初始化配置文件。\n\n可以根据个人喜好或团队选择\n\n``` sh\neslint --init\n\n1 How would you like to use ESLint? (Use arrow keys)\nTo check syntax only   // 只检查语法\n❯ To check syntax and find problems // 检查语法并找出问题\nTo check syntax, find problems, and enforce code style // 检查语法、发现问题并强制执行代码样式\n\n2 What type of modules does your project use? (Use arrow keys)\n❯ JavaScript modules (import/export) \n  CommonJS (require/exports) \n  None of these\n\n3 Which framework does your project use? \n  React \n  Vue.js \n❯ None of these\n\n...\n```\n\n- 初始化配置如下\n\n``` json \nmodule.exports = {\n    \"env\": {\n        \"browser\": true,\n        \"es6\": true\n    },\n    \"extends\": \"eslint:recommended\",\n    \"globals\": {\n        \"Atomics\": \"readonly\",\n        \"SharedArrayBuffer\": \"readonly\"\n    },\n    \"parserOptions\": {\n        \"ecmaVersion\": 2018\n    },\n    \"rules\": {\n    }\n};\n```\n\n- 接下来添加一条rule\n\n``` json\n\"rules\": {\n\t// if while function 后面的{ 必须与if在同一行。\n\t\"brace-style\": [2, \"1tbs\", { \"allowSingleLine\": true }],\n}\n```\n\n- 测试文件: util.js\n\n``` js\nvar d = new Date()\nvar time = d.getHours()\nif (time<10)\n{\ndocument.write(\"<b>Good morning</b>\" )\n}\nelse if (time>=10 && time<16) \n{\ndocument.write(\"<b>Good day</b>\")\n}\nelse\n{\ndocument.write(\"<b>Hello World!</b>\")\n}\n```\n\n- 控制台执行\n``` sh\neslint src/util.js\n\n\n...src/util.js\n\n4:1  error  Opening curly brace does not appear on the same line as controlling statement  brace-style\n   6:1  error  Closing curly brace does not appear on the same line as the subsequent block   brace-style\n   9:1  error  Closing curly brace does not appear on the same line as the subsequent block   brace-style\n  11:1  error  Opening curly brace does not appear on the same line as controlling statement  brace-style\n\n✖ 4 problems (4 errors, 0 warnings)\n  4 errors and 0 warnings potentially fixable with the `--fix` option.\n```\n\neslint rule生效 结果自然是会报错\n在当前场景大括号不能单独占一行\n\n\n\n这时我们可以执行 eslint --fix\npackage中配置命令替代单个eslint --fix\n\n``` json\neslint --fix util.js // 自行纠正\n\n// 配置命令全局执行,省事\n// package.js \n\"scripts\": {\n\t\"eslint-fix\": \"eslint src/**/*.*  --fix\"\n}\n```\n\n接下来在新建一个vue文件\nsrc/index.vue\n\n控制台执行\n\nnpm run eslint-fix\n出现报错\n\n![](/coding/eslint/error.png)\n\n::: warning\neslint此时不认识vue文件, 所以只能当成js文件进行处理,\n\n正因为js外层不能包含html标记 所以会出现报错信息。\n:::","source":"_posts/ESLint 初体验.md","raw":"---\ntitle: ESLint 初体验\ntop_img: false\ndate: 2022-03-11\ncategories: \n- 前端\ntags:\n- Eslint\ncover: https://img0.baidu.com/it/u=126596768,3405821946&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=286\n---\n\n## 介绍\n\nESLint是一个用来识别 ECMAScript 并且按照规则给出报告的代码检测工具，使用它可以避免低级错误和统一代码的风格。如果每次在代码提交之前都进行一次eslint代码检查，就不会因为某个字段未定义为undefined或null这样的错误而导致服务崩溃，可以有效的控制项目代码的质量\n\n## 好处\n\n俗话说的好没有规矩不成方圆 代码规范是程序员的根本，入门第一步，从规范代码开始。\neslint根本目的是统一项目的代码风格规范，养成规范的写代码习惯，减少不必要的错误和隐患。\n\n\n## 安装\n\n``` sh\n    npm install -g eslint // 全局安装\n\n    npm install --save-dev eslint // 项目安装\n```\n\n## 使用\n\n项目根目录新建.eslintrc.js文件 配置eslint。\n\n如果全局安装eslint可以在项目运行, 初始化配置文件。\n\n可以根据个人喜好或团队选择\n\n``` sh\neslint --init\n\n1 How would you like to use ESLint? (Use arrow keys)\nTo check syntax only   // 只检查语法\n❯ To check syntax and find problems // 检查语法并找出问题\nTo check syntax, find problems, and enforce code style // 检查语法、发现问题并强制执行代码样式\n\n2 What type of modules does your project use? (Use arrow keys)\n❯ JavaScript modules (import/export) \n  CommonJS (require/exports) \n  None of these\n\n3 Which framework does your project use? \n  React \n  Vue.js \n❯ None of these\n\n...\n```\n\n- 初始化配置如下\n\n``` json \nmodule.exports = {\n    \"env\": {\n        \"browser\": true,\n        \"es6\": true\n    },\n    \"extends\": \"eslint:recommended\",\n    \"globals\": {\n        \"Atomics\": \"readonly\",\n        \"SharedArrayBuffer\": \"readonly\"\n    },\n    \"parserOptions\": {\n        \"ecmaVersion\": 2018\n    },\n    \"rules\": {\n    }\n};\n```\n\n- 接下来添加一条rule\n\n``` json\n\"rules\": {\n\t// if while function 后面的{ 必须与if在同一行。\n\t\"brace-style\": [2, \"1tbs\", { \"allowSingleLine\": true }],\n}\n```\n\n- 测试文件: util.js\n\n``` js\nvar d = new Date()\nvar time = d.getHours()\nif (time<10)\n{\ndocument.write(\"<b>Good morning</b>\" )\n}\nelse if (time>=10 && time<16) \n{\ndocument.write(\"<b>Good day</b>\")\n}\nelse\n{\ndocument.write(\"<b>Hello World!</b>\")\n}\n```\n\n- 控制台执行\n``` sh\neslint src/util.js\n\n\n...src/util.js\n\n4:1  error  Opening curly brace does not appear on the same line as controlling statement  brace-style\n   6:1  error  Closing curly brace does not appear on the same line as the subsequent block   brace-style\n   9:1  error  Closing curly brace does not appear on the same line as the subsequent block   brace-style\n  11:1  error  Opening curly brace does not appear on the same line as controlling statement  brace-style\n\n✖ 4 problems (4 errors, 0 warnings)\n  4 errors and 0 warnings potentially fixable with the `--fix` option.\n```\n\neslint rule生效 结果自然是会报错\n在当前场景大括号不能单独占一行\n\n\n\n这时我们可以执行 eslint --fix\npackage中配置命令替代单个eslint --fix\n\n``` json\neslint --fix util.js // 自行纠正\n\n// 配置命令全局执行,省事\n// package.js \n\"scripts\": {\n\t\"eslint-fix\": \"eslint src/**/*.*  --fix\"\n}\n```\n\n接下来在新建一个vue文件\nsrc/index.vue\n\n控制台执行\n\nnpm run eslint-fix\n出现报错\n\n![](/coding/eslint/error.png)\n\n::: warning\neslint此时不认识vue文件, 所以只能当成js文件进行处理,\n\n正因为js外层不能包含html标记 所以会出现报错信息。\n:::","slug":"ESLint 初体验","published":1,"updated":"2022-11-07T06:34:07.715Z","_id":"cla68v71x0000nk775wcff8ql","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>ESLint是一个用来识别 ECMAScript 并且按照规则给出报告的代码检测工具，使用它可以避免低级错误和统一代码的风格。如果每次在代码提交之前都进行一次eslint代码检查，就不会因为某个字段未定义为undefined或null这样的错误而导致服务崩溃，可以有效的控制项目代码的质量</p>\n<h2 id=\"好处\"><a href=\"#好处\" class=\"headerlink\" title=\"好处\"></a>好处</h2><p>俗话说的好没有规矩不成方圆 代码规范是程序员的根本，入门第一步，从规范代码开始。<br>eslint根本目的是统一项目的代码风格规范，养成规范的写代码习惯，减少不必要的错误和隐患。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g eslint // 全局安装</span><br><span class=\"line\"></span><br><span class=\"line\">npm install --save-dev eslint // 项目安装</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>项目根目录新建.eslintrc.js文件 配置eslint。</p>\n<p>如果全局安装eslint可以在项目运行, 初始化配置文件。</p>\n<p>可以根据个人喜好或团队选择</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">eslint --init</span><br><span class=\"line\"></span><br><span class=\"line\">1 How would you like to use ESLint? (Use arrow keys)</span><br><span class=\"line\">To check syntax only   // 只检查语法</span><br><span class=\"line\">❯ To check syntax and find problems // 检查语法并找出问题</span><br><span class=\"line\">To check syntax, find problems, and enforce code style // 检查语法、发现问题并强制执行代码样式</span><br><span class=\"line\"></span><br><span class=\"line\">2 What <span class=\"built_in\">type</span> of modules does your project use? (Use arrow keys)</span><br><span class=\"line\">❯ JavaScript modules (import/export) </span><br><span class=\"line\">  CommonJS (require/exports) </span><br><span class=\"line\">  None of these</span><br><span class=\"line\"></span><br><span class=\"line\">3 Which framework does your project use? </span><br><span class=\"line\">  React </span><br><span class=\"line\">  Vue.js </span><br><span class=\"line\">❯ None of these</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>初始化配置如下</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports = <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;env&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;browser&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;es6&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;extends&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;eslint:recommended&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;globals&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;Atomics&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;readonly&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;SharedArrayBuffer&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;readonly&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;parserOptions&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;ecmaVersion&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2018</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;rules&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>接下来添加一条rule</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;rules&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">\t<span class=\"comment\">// if while function 后面的&#123; 必须与if在同一行。</span></span><br><span class=\"line\">\t<span class=\"attr\">&quot;brace-style&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;1tbs&quot;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span> <span class=\"attr\">&quot;allowSingleLine&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span> <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>测试文件: util.js</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> d = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()</span><br><span class=\"line\"><span class=\"keyword\">var</span> time = d.<span class=\"title function_\">getHours</span>()</span><br><span class=\"line\"><span class=\"keyword\">if</span> (time&lt;<span class=\"number\">10</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">write</span>(<span class=\"string\">&quot;&lt;b&gt;Good morning&lt;/b&gt;&quot;</span> )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (time&gt;=<span class=\"number\">10</span> &amp;&amp; time&lt;<span class=\"number\">16</span>) </span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">write</span>(<span class=\"string\">&quot;&lt;b&gt;Good day&lt;/b&gt;&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">write</span>(<span class=\"string\">&quot;&lt;b&gt;Hello World!&lt;/b&gt;&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>控制台执行<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">eslint src/util.js</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">...src/util.js</span><br><span class=\"line\"></span><br><span class=\"line\">4:1  error  Opening curly brace does not appear on the same line as controlling statement  brace-style</span><br><span class=\"line\">   6:1  error  Closing curly brace does not appear on the same line as the subsequent block   brace-style</span><br><span class=\"line\">   9:1  error  Closing curly brace does not appear on the same line as the subsequent block   brace-style</span><br><span class=\"line\">  11:1  error  Opening curly brace does not appear on the same line as controlling statement  brace-style</span><br><span class=\"line\"></span><br><span class=\"line\">✖ 4 problems (4 errors, 0 warnings)</span><br><span class=\"line\">  4 errors and 0 warnings potentially fixable with the `--fix` option.</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p>eslint rule生效 结果自然是会报错<br>在当前场景大括号不能单独占一行</p>\n<p>这时我们可以执行 eslint –fix<br>package中配置命令替代单个eslint –fix</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">eslint --fix util.js <span class=\"comment\">// 自行纠正</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 配置命令全局执行,省事</span></span><br><span class=\"line\"><span class=\"comment\">// package.js </span></span><br><span class=\"line\"><span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">\t<span class=\"attr\">&quot;eslint-fix&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;eslint src/**/*.*  --fix&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>接下来在新建一个vue文件<br>src/index.vue</p>\n<p>控制台执行</p>\n<p>npm run eslint-fix<br>出现报错</p>\n<p><img src=\"/coding/eslint/error.png\"></p>\n<p>::: warning<br>eslint此时不认识vue文件, 所以只能当成js文件进行处理,</p>\n<p>正因为js外层不能包含html标记 所以会出现报错信息。<br>:::</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p>ESLint是一个用来识别 ECMAScript 并且按照规则给出报告的代码检测工具，使用它可以避免低级错误和统一代码的风格。如果每次在代码提交之前都进行一次eslint代码检查，就不会因为某个字段未定义为undefined或null这样的错误而导致服务崩溃，可以有效的控制项目代码的质量</p>\n<h2 id=\"好处\"><a href=\"#好处\" class=\"headerlink\" title=\"好处\"></a>好处</h2><p>俗话说的好没有规矩不成方圆 代码规范是程序员的根本，入门第一步，从规范代码开始。<br>eslint根本目的是统一项目的代码风格规范，养成规范的写代码习惯，减少不必要的错误和隐患。</p>\n<h2 id=\"安装\"><a href=\"#安装\" class=\"headerlink\" title=\"安装\"></a>安装</h2><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install -g eslint // 全局安装</span><br><span class=\"line\"></span><br><span class=\"line\">npm install --save-dev eslint // 项目安装</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>项目根目录新建.eslintrc.js文件 配置eslint。</p>\n<p>如果全局安装eslint可以在项目运行, 初始化配置文件。</p>\n<p>可以根据个人喜好或团队选择</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">eslint --init</span><br><span class=\"line\"></span><br><span class=\"line\">1 How would you like to use ESLint? (Use arrow keys)</span><br><span class=\"line\">To check syntax only   // 只检查语法</span><br><span class=\"line\">❯ To check syntax and find problems // 检查语法并找出问题</span><br><span class=\"line\">To check syntax, find problems, and enforce code style // 检查语法、发现问题并强制执行代码样式</span><br><span class=\"line\"></span><br><span class=\"line\">2 What <span class=\"built_in\">type</span> of modules does your project use? (Use arrow keys)</span><br><span class=\"line\">❯ JavaScript modules (import/export) </span><br><span class=\"line\">  CommonJS (require/exports) </span><br><span class=\"line\">  None of these</span><br><span class=\"line\"></span><br><span class=\"line\">3 Which framework does your project use? </span><br><span class=\"line\">  React </span><br><span class=\"line\">  Vue.js </span><br><span class=\"line\">❯ None of these</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>初始化配置如下</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports = <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;env&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;browser&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;es6&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;extends&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;eslint:recommended&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;globals&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;Atomics&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;readonly&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;SharedArrayBuffer&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;readonly&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;parserOptions&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;ecmaVersion&quot;</span><span class=\"punctuation\">:</span> <span class=\"number\">2018</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;rules&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>接下来添加一条rule</li>\n</ul>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;rules&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">\t<span class=\"comment\">// if while function 后面的&#123; 必须与if在同一行。</span></span><br><span class=\"line\">\t<span class=\"attr\">&quot;brace-style&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span><span class=\"number\">2</span><span class=\"punctuation\">,</span> <span class=\"string\">&quot;1tbs&quot;</span><span class=\"punctuation\">,</span> <span class=\"punctuation\">&#123;</span> <span class=\"attr\">&quot;allowSingleLine&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span> <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>测试文件: util.js</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> d = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>()</span><br><span class=\"line\"><span class=\"keyword\">var</span> time = d.<span class=\"title function_\">getHours</span>()</span><br><span class=\"line\"><span class=\"keyword\">if</span> (time&lt;<span class=\"number\">10</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">write</span>(<span class=\"string\">&quot;&lt;b&gt;Good morning&lt;/b&gt;&quot;</span> )</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (time&gt;=<span class=\"number\">10</span> &amp;&amp; time&lt;<span class=\"number\">16</span>) </span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">write</span>(<span class=\"string\">&quot;&lt;b&gt;Good day&lt;/b&gt;&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">else</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">write</span>(<span class=\"string\">&quot;&lt;b&gt;Hello World!&lt;/b&gt;&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>控制台执行<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">eslint src/util.js</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">...src/util.js</span><br><span class=\"line\"></span><br><span class=\"line\">4:1  error  Opening curly brace does not appear on the same line as controlling statement  brace-style</span><br><span class=\"line\">   6:1  error  Closing curly brace does not appear on the same line as the subsequent block   brace-style</span><br><span class=\"line\">   9:1  error  Closing curly brace does not appear on the same line as the subsequent block   brace-style</span><br><span class=\"line\">  11:1  error  Opening curly brace does not appear on the same line as controlling statement  brace-style</span><br><span class=\"line\"></span><br><span class=\"line\">✖ 4 problems (4 errors, 0 warnings)</span><br><span class=\"line\">  4 errors and 0 warnings potentially fixable with the `--fix` option.</span><br></pre></td></tr></table></figure></li>\n</ul>\n<p>eslint rule生效 结果自然是会报错<br>在当前场景大括号不能单独占一行</p>\n<p>这时我们可以执行 eslint –fix<br>package中配置命令替代单个eslint –fix</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">eslint --fix util.js <span class=\"comment\">// 自行纠正</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 配置命令全局执行,省事</span></span><br><span class=\"line\"><span class=\"comment\">// package.js </span></span><br><span class=\"line\"><span class=\"attr\">&quot;scripts&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">\t<span class=\"attr\">&quot;eslint-fix&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;eslint src/**/*.*  --fix&quot;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>接下来在新建一个vue文件<br>src/index.vue</p>\n<p>控制台执行</p>\n<p>npm run eslint-fix<br>出现报错</p>\n<p><img src=\"/coding/eslint/error.png\"></p>\n<p>::: warning<br>eslint此时不认识vue文件, 所以只能当成js文件进行处理,</p>\n<p>正因为js外层不能包含html标记 所以会出现报错信息。<br>:::</p>\n"},{"title":"Electron 启动动画实现","top_img":false,"date":"2021-03-10T16:00:00.000Z","cover":"https://img0.baidu.com/it/u=1589470868,4145284120&fm=253&fmt=auto&app=138&f=PNG?w=720&h=241","_content":"\n## 背景\nElectron是通过Chromium和Node.js集成来达到这一开发体验的, 我们可以用React / Vue 很轻松的搭建一个桌面应用程序。应用启动时就避免不了短暂的白屏或者需要启动时加载基础数据。\n\n那么怎样解决这一问题呢?\n\n有APP开发经验的同学肯定立马就想到了 启动动画(开屏广告)。\n\n\n## 思路\n\n1. 应用启动额外创建 Loading窗口 ,并且主窗口默认隐藏\n2. 主窗口加载完毕通过 ipcRenderer 通知主窗口显示, Loading窗口关闭\n\n## 实现\n\n- 准备开屏动画\n\n- 配置主进程main.js文件\n\n``` js\nconst createWindow = async () => {\n  mainWindow = new BrowserWindow({\n    minHeight: 600,\n    minWidth: 1024, width: 1280, height: 720, titleBarStyle: 'hidden', frame: false, show: false\n  });\n    ……\n};\n```\n\n- 创建loading窗口\n\n``` js\n// loading\nconst createLoadingWindow = async () => {   \n  loadingWindow = new BrowserWindow({\n    height: 260,\n    width: 650,\n    show: true,\n    transparent: true,  // 透明窗口\n    maximizable: false,  //禁止双击放大\n    frame: false   // 去掉顶部操作栏\n  })\n\n  loadingWindow.loadURL(url.format({\n    // loading.html 加载动画\n    pathname: path.join(__dirname, './lib/loading/loading.html'),\n    protocol: 'file:',\n    slashes: true\n  }))\n    ……\n}\n```\n\n- 动画展示隐藏\n\n``` js\nimport { ipcRenderer } from \"electron\";\nconst ipcMain = require('electron').ipcMain;\n\n// 页面加载完毕时调用 通知关闭loading\nipcRenderer.send(\"close-loading-window\");\n\napp.on('ready', () => {\n  // 创建加载动画 \n  createLoadingWindow();\n  // 创建主窗口\n  createWindow();\n  // 监听页面加载完毕事件\n  ipcMain.on('close-loading-window', () => {\n    \n    if(loadingWindow) {\n      loadingWindow.close();\n    }\n    mainWindow.show();\n  })\n\n});\n```\n\n## 完成\n\n![animation](https://user-images.githubusercontent.com/70128222/194988437-76bc5bcf-6abe-4419-8303-0e7e72f7bf5e.gif)\n\n\n## 不足\n\ntransparent: true,  // 透明窗口\n\n在win7下不起作用\n\n解决方案: [禁用硬件加速(未尝试)](https://github.com/electron/electron/issues/2170#ref-issue-623539865)\n\n``` js\napp.disableHardwareAcceleration();\n\napp.on('ready', () => {\n  setTimeout(() => {\n    createWindow();\n    autoUpdater.checkForUpdatesAndNotify();\n    createMenu();\n  }, 50);\n});\n```","source":"_posts/Electron 启动动画实现.md","raw":"---\ntitle: Electron 启动动画实现\ntop_img: false\ndate: 2021-03-11\ncategories: \n- 前端\ntags:\n- Electron\ncover: https://img0.baidu.com/it/u=1589470868,4145284120&fm=253&fmt=auto&app=138&f=PNG?w=720&h=241\n---\n\n## 背景\nElectron是通过Chromium和Node.js集成来达到这一开发体验的, 我们可以用React / Vue 很轻松的搭建一个桌面应用程序。应用启动时就避免不了短暂的白屏或者需要启动时加载基础数据。\n\n那么怎样解决这一问题呢?\n\n有APP开发经验的同学肯定立马就想到了 启动动画(开屏广告)。\n\n\n## 思路\n\n1. 应用启动额外创建 Loading窗口 ,并且主窗口默认隐藏\n2. 主窗口加载完毕通过 ipcRenderer 通知主窗口显示, Loading窗口关闭\n\n## 实现\n\n- 准备开屏动画\n\n- 配置主进程main.js文件\n\n``` js\nconst createWindow = async () => {\n  mainWindow = new BrowserWindow({\n    minHeight: 600,\n    minWidth: 1024, width: 1280, height: 720, titleBarStyle: 'hidden', frame: false, show: false\n  });\n    ……\n};\n```\n\n- 创建loading窗口\n\n``` js\n// loading\nconst createLoadingWindow = async () => {   \n  loadingWindow = new BrowserWindow({\n    height: 260,\n    width: 650,\n    show: true,\n    transparent: true,  // 透明窗口\n    maximizable: false,  //禁止双击放大\n    frame: false   // 去掉顶部操作栏\n  })\n\n  loadingWindow.loadURL(url.format({\n    // loading.html 加载动画\n    pathname: path.join(__dirname, './lib/loading/loading.html'),\n    protocol: 'file:',\n    slashes: true\n  }))\n    ……\n}\n```\n\n- 动画展示隐藏\n\n``` js\nimport { ipcRenderer } from \"electron\";\nconst ipcMain = require('electron').ipcMain;\n\n// 页面加载完毕时调用 通知关闭loading\nipcRenderer.send(\"close-loading-window\");\n\napp.on('ready', () => {\n  // 创建加载动画 \n  createLoadingWindow();\n  // 创建主窗口\n  createWindow();\n  // 监听页面加载完毕事件\n  ipcMain.on('close-loading-window', () => {\n    \n    if(loadingWindow) {\n      loadingWindow.close();\n    }\n    mainWindow.show();\n  })\n\n});\n```\n\n## 完成\n\n![animation](https://user-images.githubusercontent.com/70128222/194988437-76bc5bcf-6abe-4419-8303-0e7e72f7bf5e.gif)\n\n\n## 不足\n\ntransparent: true,  // 透明窗口\n\n在win7下不起作用\n\n解决方案: [禁用硬件加速(未尝试)](https://github.com/electron/electron/issues/2170#ref-issue-623539865)\n\n``` js\napp.disableHardwareAcceleration();\n\napp.on('ready', () => {\n  setTimeout(() => {\n    createWindow();\n    autoUpdater.checkForUpdatesAndNotify();\n    createMenu();\n  }, 50);\n});\n```","slug":"Electron 启动动画实现","published":1,"updated":"2022-11-07T06:47:35.225Z","_id":"cla6bjxvo0000w077afij1kl9","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>Electron是通过Chromium和Node.js集成来达到这一开发体验的, 我们可以用React / Vue 很轻松的搭建一个桌面应用程序。应用启动时就避免不了短暂的白屏或者需要启动时加载基础数据。</p>\n<p>那么怎样解决这一问题呢?</p>\n<p>有APP开发经验的同学肯定立马就想到了 启动动画(开屏广告)。</p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><ol>\n<li>应用启动额外创建 Loading窗口 ,并且主窗口默认隐藏</li>\n<li>主窗口加载完毕通过 ipcRenderer 通知主窗口显示, Loading窗口关闭</li>\n</ol>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><ul>\n<li><p>准备开屏动画</p>\n</li>\n<li><p>配置主进程main.js文件</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">createWindow</span> = <span class=\"keyword\">async</span> (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  mainWindow = <span class=\"keyword\">new</span> <span class=\"title class_\">BrowserWindow</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">minHeight</span>: <span class=\"number\">600</span>,</span><br><span class=\"line\">    <span class=\"attr\">minWidth</span>: <span class=\"number\">1024</span>, <span class=\"attr\">width</span>: <span class=\"number\">1280</span>, <span class=\"attr\">height</span>: <span class=\"number\">720</span>, <span class=\"attr\">titleBarStyle</span>: <span class=\"string\">&#x27;hidden&#x27;</span>, <span class=\"attr\">frame</span>: <span class=\"literal\">false</span>, <span class=\"attr\">show</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">    ……</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>创建loading窗口</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// loading</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">createLoadingWindow</span> = <span class=\"keyword\">async</span> (<span class=\"params\"></span>) =&gt; &#123;   </span><br><span class=\"line\">  loadingWindow = <span class=\"keyword\">new</span> <span class=\"title class_\">BrowserWindow</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">height</span>: <span class=\"number\">260</span>,</span><br><span class=\"line\">    <span class=\"attr\">width</span>: <span class=\"number\">650</span>,</span><br><span class=\"line\">    <span class=\"attr\">show</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">transparent</span>: <span class=\"literal\">true</span>,  <span class=\"comment\">// 透明窗口</span></span><br><span class=\"line\">    <span class=\"attr\">maximizable</span>: <span class=\"literal\">false</span>,  <span class=\"comment\">//禁止双击放大</span></span><br><span class=\"line\">    <span class=\"attr\">frame</span>: <span class=\"literal\">false</span>   <span class=\"comment\">// 去掉顶部操作栏</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  loadingWindow.<span class=\"title function_\">loadURL</span>(url.<span class=\"title function_\">format</span>(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// loading.html 加载动画</span></span><br><span class=\"line\">    <span class=\"attr\">pathname</span>: path.<span class=\"title function_\">join</span>(__dirname, <span class=\"string\">&#x27;./lib/loading/loading.html&#x27;</span>),</span><br><span class=\"line\">    <span class=\"attr\">protocol</span>: <span class=\"string\">&#x27;file:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">slashes</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;))</span><br><span class=\"line\">    ……</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>动画展示隐藏</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; ipcRenderer &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;electron&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> ipcMain = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;electron&#x27;</span>).<span class=\"property\">ipcMain</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 页面加载完毕时调用 通知关闭loading</span></span><br><span class=\"line\">ipcRenderer.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;close-loading-window&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;ready&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 创建加载动画 </span></span><br><span class=\"line\">  <span class=\"title function_\">createLoadingWindow</span>();</span><br><span class=\"line\">  <span class=\"comment\">// 创建主窗口</span></span><br><span class=\"line\">  <span class=\"title function_\">createWindow</span>();</span><br><span class=\"line\">  <span class=\"comment\">// 监听页面加载完毕事件</span></span><br><span class=\"line\">  ipcMain.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;close-loading-window&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(loadingWindow) &#123;</span><br><span class=\"line\">      loadingWindow.<span class=\"title function_\">close</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    mainWindow.<span class=\"title function_\">show</span>();</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"完成\"><a href=\"#完成\" class=\"headerlink\" title=\"完成\"></a>完成</h2><p><img src=\"https://user-images.githubusercontent.com/70128222/194988437-76bc5bcf-6abe-4419-8303-0e7e72f7bf5e.gif\" alt=\"animation\"></p>\n<h2 id=\"不足\"><a href=\"#不足\" class=\"headerlink\" title=\"不足\"></a>不足</h2><p>transparent: true,  // 透明窗口</p>\n<p>在win7下不起作用</p>\n<p>解决方案: <a href=\"https://github.com/electron/electron/issues/2170#ref-issue-623539865\">禁用硬件加速(未尝试)</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">disableHardwareAcceleration</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;ready&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">createWindow</span>();</span><br><span class=\"line\">    autoUpdater.<span class=\"title function_\">checkForUpdatesAndNotify</span>();</span><br><span class=\"line\">    <span class=\"title function_\">createMenu</span>();</span><br><span class=\"line\">  &#125;, <span class=\"number\">50</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>Electron是通过Chromium和Node.js集成来达到这一开发体验的, 我们可以用React / Vue 很轻松的搭建一个桌面应用程序。应用启动时就避免不了短暂的白屏或者需要启动时加载基础数据。</p>\n<p>那么怎样解决这一问题呢?</p>\n<p>有APP开发经验的同学肯定立马就想到了 启动动画(开屏广告)。</p>\n<h2 id=\"思路\"><a href=\"#思路\" class=\"headerlink\" title=\"思路\"></a>思路</h2><ol>\n<li>应用启动额外创建 Loading窗口 ,并且主窗口默认隐藏</li>\n<li>主窗口加载完毕通过 ipcRenderer 通知主窗口显示, Loading窗口关闭</li>\n</ol>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><ul>\n<li><p>准备开屏动画</p>\n</li>\n<li><p>配置主进程main.js文件</p>\n</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">createWindow</span> = <span class=\"keyword\">async</span> (<span class=\"params\"></span>) =&gt; &#123;</span><br><span class=\"line\">  mainWindow = <span class=\"keyword\">new</span> <span class=\"title class_\">BrowserWindow</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">minHeight</span>: <span class=\"number\">600</span>,</span><br><span class=\"line\">    <span class=\"attr\">minWidth</span>: <span class=\"number\">1024</span>, <span class=\"attr\">width</span>: <span class=\"number\">1280</span>, <span class=\"attr\">height</span>: <span class=\"number\">720</span>, <span class=\"attr\">titleBarStyle</span>: <span class=\"string\">&#x27;hidden&#x27;</span>, <span class=\"attr\">frame</span>: <span class=\"literal\">false</span>, <span class=\"attr\">show</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">    ……</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>创建loading窗口</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// loading</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">createLoadingWindow</span> = <span class=\"keyword\">async</span> (<span class=\"params\"></span>) =&gt; &#123;   </span><br><span class=\"line\">  loadingWindow = <span class=\"keyword\">new</span> <span class=\"title class_\">BrowserWindow</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">height</span>: <span class=\"number\">260</span>,</span><br><span class=\"line\">    <span class=\"attr\">width</span>: <span class=\"number\">650</span>,</span><br><span class=\"line\">    <span class=\"attr\">show</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">    <span class=\"attr\">transparent</span>: <span class=\"literal\">true</span>,  <span class=\"comment\">// 透明窗口</span></span><br><span class=\"line\">    <span class=\"attr\">maximizable</span>: <span class=\"literal\">false</span>,  <span class=\"comment\">//禁止双击放大</span></span><br><span class=\"line\">    <span class=\"attr\">frame</span>: <span class=\"literal\">false</span>   <span class=\"comment\">// 去掉顶部操作栏</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  loadingWindow.<span class=\"title function_\">loadURL</span>(url.<span class=\"title function_\">format</span>(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// loading.html 加载动画</span></span><br><span class=\"line\">    <span class=\"attr\">pathname</span>: path.<span class=\"title function_\">join</span>(__dirname, <span class=\"string\">&#x27;./lib/loading/loading.html&#x27;</span>),</span><br><span class=\"line\">    <span class=\"attr\">protocol</span>: <span class=\"string\">&#x27;file:&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">slashes</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;))</span><br><span class=\"line\">    ……</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>动画展示隐藏</li>\n</ul>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; ipcRenderer &#125; <span class=\"keyword\">from</span> <span class=\"string\">&quot;electron&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> ipcMain = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;electron&#x27;</span>).<span class=\"property\">ipcMain</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 页面加载完毕时调用 通知关闭loading</span></span><br><span class=\"line\">ipcRenderer.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;close-loading-window&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;ready&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 创建加载动画 </span></span><br><span class=\"line\">  <span class=\"title function_\">createLoadingWindow</span>();</span><br><span class=\"line\">  <span class=\"comment\">// 创建主窗口</span></span><br><span class=\"line\">  <span class=\"title function_\">createWindow</span>();</span><br><span class=\"line\">  <span class=\"comment\">// 监听页面加载完毕事件</span></span><br><span class=\"line\">  ipcMain.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;close-loading-window&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(loadingWindow) &#123;</span><br><span class=\"line\">      loadingWindow.<span class=\"title function_\">close</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    mainWindow.<span class=\"title function_\">show</span>();</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"完成\"><a href=\"#完成\" class=\"headerlink\" title=\"完成\"></a>完成</h2><p><img src=\"https://user-images.githubusercontent.com/70128222/194988437-76bc5bcf-6abe-4419-8303-0e7e72f7bf5e.gif\" alt=\"animation\"></p>\n<h2 id=\"不足\"><a href=\"#不足\" class=\"headerlink\" title=\"不足\"></a>不足</h2><p>transparent: true,  // 透明窗口</p>\n<p>在win7下不起作用</p>\n<p>解决方案: <a href=\"https://github.com/electron/electron/issues/2170#ref-issue-623539865\">禁用硬件加速(未尝试)</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.<span class=\"title function_\">disableHardwareAcceleration</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;ready&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">createWindow</span>();</span><br><span class=\"line\">    autoUpdater.<span class=\"title function_\">checkForUpdatesAndNotify</span>();</span><br><span class=\"line\">    <span class=\"title function_\">createMenu</span>();</span><br><span class=\"line\">  &#125;, <span class=\"number\">50</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>"},{"title":"ESLint 如何在Vue或React中使用","top_img":false,"date":"2022-03-19T16:00:00.000Z","cover":"https://img0.baidu.com/it/u=126596768,3405821946&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=286","_content":"\nvue或react都有对应的插件实现\n\n[eslint-plugin-vue](https://github.com/vuejs/eslint-plugin-vue)\n\n[eslint-plugin-react](https://github.com/yannickcr/eslint-plugin-react)\n\n由于 Vue 中的单个文件组件不是普通的 JavaScript，因此无法使用默认解析器，因此引入了新的文件组件。 通过表示模板语法的特定部分以及标签内的内容生成增强的 AST 节点。\n\n以上面Vue文件报错为例子\n\n我们可以通过[eslint-plugin-vue](https://github.com/vuejs/eslint-plugin-vue)来实现\n\n首先项目根目录安装\n\n```jsx\nnpm install --save-dev eslint eslint-plugin-vue\n```\n\n然后执行 npm run eslint-fix进行校验\n\n前面所遇到的html标记已经得到解决 eslint能正确识别vue文件。\n\n## 配合IDE食用更佳\n\n在实际的开发过程中, 当然希望编辑器能即使反馈错误并提示\n\n以VsCode为例\n\n### 安装插件\n\n![1](https://user-images.githubusercontent.com/70128222/194988143-edd0851f-53ae-4e10-8313-3fac2587c29b.jpg)\n\n\n### 预期效果\n\n![2](https://user-images.githubusercontent.com/70128222/194988159-866d59b4-4c96-46ce-bc18-5f4cd565548b.jpg)\n\n如果未生效\n\n请确保EsLint开启\n\n如遇报错 解决报错直至开启\n\n![3](https://user-images.githubusercontent.com/70128222/194988171-ff456002-8e76-413c-aef9-2ecd63a842fb.jpg)\n\n ","source":"_posts/ESLint 如何在Vue或React中使用.md","raw":"---\ntitle: ESLint 如何在Vue或React中使用\ntop_img: false\ndate: 2022-03-20\ncategories: \n- 前端\ntags:\n- Eslint\ncover: https://img0.baidu.com/it/u=126596768,3405821946&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=286\n---\n\nvue或react都有对应的插件实现\n\n[eslint-plugin-vue](https://github.com/vuejs/eslint-plugin-vue)\n\n[eslint-plugin-react](https://github.com/yannickcr/eslint-plugin-react)\n\n由于 Vue 中的单个文件组件不是普通的 JavaScript，因此无法使用默认解析器，因此引入了新的文件组件。 通过表示模板语法的特定部分以及标签内的内容生成增强的 AST 节点。\n\n以上面Vue文件报错为例子\n\n我们可以通过[eslint-plugin-vue](https://github.com/vuejs/eslint-plugin-vue)来实现\n\n首先项目根目录安装\n\n```jsx\nnpm install --save-dev eslint eslint-plugin-vue\n```\n\n然后执行 npm run eslint-fix进行校验\n\n前面所遇到的html标记已经得到解决 eslint能正确识别vue文件。\n\n## 配合IDE食用更佳\n\n在实际的开发过程中, 当然希望编辑器能即使反馈错误并提示\n\n以VsCode为例\n\n### 安装插件\n\n![1](https://user-images.githubusercontent.com/70128222/194988143-edd0851f-53ae-4e10-8313-3fac2587c29b.jpg)\n\n\n### 预期效果\n\n![2](https://user-images.githubusercontent.com/70128222/194988159-866d59b4-4c96-46ce-bc18-5f4cd565548b.jpg)\n\n如果未生效\n\n请确保EsLint开启\n\n如遇报错 解决报错直至开启\n\n![3](https://user-images.githubusercontent.com/70128222/194988171-ff456002-8e76-413c-aef9-2ecd63a842fb.jpg)\n\n ","slug":"ESLint 如何在Vue或React中使用","published":1,"updated":"2022-11-07T06:34:17.206Z","_id":"cla6bjxvs0001w0779t273tpe","comments":1,"layout":"post","photos":[],"link":"","content":"<p>vue或react都有对应的插件实现</p>\n<p><a href=\"https://github.com/vuejs/eslint-plugin-vue\">eslint-plugin-vue</a></p>\n<p><a href=\"https://github.com/yannickcr/eslint-plugin-react\">eslint-plugin-react</a></p>\n<p>由于 Vue 中的单个文件组件不是普通的 JavaScript，因此无法使用默认解析器，因此引入了新的文件组件。 通过表示模板语法的特定部分以及标签内的内容生成增强的 AST 节点。</p>\n<p>以上面Vue文件报错为例子</p>\n<p>我们可以通过<a href=\"https://github.com/vuejs/eslint-plugin-vue\">eslint-plugin-vue</a>来实现</p>\n<p>首先项目根目录安装</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev eslint eslint-plugin-vue</span><br></pre></td></tr></table></figure>\n\n<p>然后执行 npm run eslint-fix进行校验</p>\n<p>前面所遇到的html标记已经得到解决 eslint能正确识别vue文件。</p>\n<h2 id=\"配合IDE食用更佳\"><a href=\"#配合IDE食用更佳\" class=\"headerlink\" title=\"配合IDE食用更佳\"></a>配合IDE食用更佳</h2><p>在实际的开发过程中, 当然希望编辑器能即使反馈错误并提示</p>\n<p>以VsCode为例</p>\n<h3 id=\"安装插件\"><a href=\"#安装插件\" class=\"headerlink\" title=\"安装插件\"></a>安装插件</h3><p><img src=\"https://user-images.githubusercontent.com/70128222/194988143-edd0851f-53ae-4e10-8313-3fac2587c29b.jpg\" alt=\"1\"></p>\n<h3 id=\"预期效果\"><a href=\"#预期效果\" class=\"headerlink\" title=\"预期效果\"></a>预期效果</h3><p><img src=\"https://user-images.githubusercontent.com/70128222/194988159-866d59b4-4c96-46ce-bc18-5f4cd565548b.jpg\" alt=\"2\"></p>\n<p>如果未生效</p>\n<p>请确保EsLint开启</p>\n<p>如遇报错 解决报错直至开启</p>\n<p><img src=\"https://user-images.githubusercontent.com/70128222/194988171-ff456002-8e76-413c-aef9-2ecd63a842fb.jpg\" alt=\"3\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>vue或react都有对应的插件实现</p>\n<p><a href=\"https://github.com/vuejs/eslint-plugin-vue\">eslint-plugin-vue</a></p>\n<p><a href=\"https://github.com/yannickcr/eslint-plugin-react\">eslint-plugin-react</a></p>\n<p>由于 Vue 中的单个文件组件不是普通的 JavaScript，因此无法使用默认解析器，因此引入了新的文件组件。 通过表示模板语法的特定部分以及标签内的内容生成增强的 AST 节点。</p>\n<p>以上面Vue文件报错为例子</p>\n<p>我们可以通过<a href=\"https://github.com/vuejs/eslint-plugin-vue\">eslint-plugin-vue</a>来实现</p>\n<p>首先项目根目录安装</p>\n<figure class=\"highlight jsx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install --save-dev eslint eslint-plugin-vue</span><br></pre></td></tr></table></figure>\n\n<p>然后执行 npm run eslint-fix进行校验</p>\n<p>前面所遇到的html标记已经得到解决 eslint能正确识别vue文件。</p>\n<h2 id=\"配合IDE食用更佳\"><a href=\"#配合IDE食用更佳\" class=\"headerlink\" title=\"配合IDE食用更佳\"></a>配合IDE食用更佳</h2><p>在实际的开发过程中, 当然希望编辑器能即使反馈错误并提示</p>\n<p>以VsCode为例</p>\n<h3 id=\"安装插件\"><a href=\"#安装插件\" class=\"headerlink\" title=\"安装插件\"></a>安装插件</h3><p><img src=\"https://user-images.githubusercontent.com/70128222/194988143-edd0851f-53ae-4e10-8313-3fac2587c29b.jpg\" alt=\"1\"></p>\n<h3 id=\"预期效果\"><a href=\"#预期效果\" class=\"headerlink\" title=\"预期效果\"></a>预期效果</h3><p><img src=\"https://user-images.githubusercontent.com/70128222/194988159-866d59b4-4c96-46ce-bc18-5f4cd565548b.jpg\" alt=\"2\"></p>\n<p>如果未生效</p>\n<p>请确保EsLint开启</p>\n<p>如遇报错 解决报错直至开启</p>\n<p><img src=\"https://user-images.githubusercontent.com/70128222/194988171-ff456002-8e76-413c-aef9-2ecd63a842fb.jpg\" alt=\"3\"></p>\n"},{"title":"向往的生活","top_img":false,"date":"2019-09-09T16:00:00.000Z","_content":"\n\n身边有几个走不散的知心朋友\n\n真正关心你的家人\n\n温暖的家\n\n这就是我向往的生活","source":"_posts/向往的生活.md","raw":"---\ntitle: 向往的生活\ntop_img: false\ndate: 2019-09-10\ncategories: \n- 生活琐碎\ntags:\n- 杂谈\n---\n\n\n身边有几个走不散的知心朋友\n\n真正关心你的家人\n\n温暖的家\n\n这就是我向往的生活","slug":"向往的生活","published":1,"updated":"2022-11-07T06:21:00.639Z","_id":"cla6bjxvt0002w077epv6f3ak","comments":1,"layout":"post","photos":[],"link":"","content":"<p>身边有几个走不散的知心朋友</p>\n<p>真正关心你的家人</p>\n<p>温暖的家</p>\n<p>这就是我向往的生活</p>\n","site":{"data":{}},"cover":"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7","excerpt":"","more":"<p>身边有几个走不散的知心朋友</p>\n<p>真正关心你的家人</p>\n<p>温暖的家</p>\n<p>这就是我向往的生活</p>\n"},{"title":"27","top_img":false,"date":"2021-11-15T16:00:00.000Z","cover":"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRCY1f_trlIDWZNFOxEKeywc0CNJifnn7fPOw&usqp=CAU","_content":"\n刚渡过了我的27岁生日\n\n回顾这几年  似乎过的还不错\n\n有坚持看书提升 也培养几个比较有意义的兴趣爱好\n\n工作上 有互相帮助的同事 工作轻松 工资尚可\n\n烟、槟榔这些不好的习惯也早戒了\n\n遗憾的是晨跑的确是没能坚持下(尽力了... 有想互相监督的可以找我 )\n\n\n身边的朋友也一直都在 \n\n有旧识 新识\n\n无需敷衍，无需讨好\n\n偶尔撸串 喝几杯 畅聊人生 \n\n真是再好不过了\n\n谢谢你们 \n\n---\n\n到了这个年纪 有个始终都绕不开的那便是情感这个话题 \n\n随着年龄的增长 身边结婚、有小孩的朋友是越来越多了  \n\n其实我真的是羡慕 , 羡慕他们的生活 当然身边也有婚后过的不是那么幸福的朋友啦\n\n就如《围城》褚慎明说英国有句古话:\n \n::: tip\n “ 结婚仿佛金漆的鸟笼，笼子外面的鸟想住进去，笼内的鸟想飞出来；所以结而离，离而结，没有了局。”\n:::\n \n渐渐地我也接受了相亲(以前的我肯定瞧不起相亲,   最终小丑竟是我自己! )\n\n遇见了各种各样的女生, 至于到现在都没个结果  根源肯定是我自己\n\n经历了几次用尽全力最终却得到背叛  热情消耗殆尽且放一边 更多的是丢失了自信心\n\n朋友也有介绍优秀的女生给我, 用他们的话说便是 她哪点不如她 人家还对你那么好\n\n每每我都是简单的一句 不喜欢 敷衍了事\n\n真的是不喜欢嘛, 真要形容的话 一句歌词再好不过了\n\n“得不到的永远在骚动,被偏爱的都有恃无恐”\n\n好像从来便是如此, 正因此伤害过那些真正对我好的人, 好在她们现在都过的很好啦！\n\n有时候想想这便是因果吧\n\n\n愿大家 \n无所畏惧漫漫人生路，进取高唱潇潇岁月歌。","source":"_posts/27.md","raw":"---\ntitle: 27\ntop_img: false\ndate: 2021-11-16\ncategories: \n- 生活琐碎\ntags:\n- 杂谈\ncover: https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRCY1f_trlIDWZNFOxEKeywc0CNJifnn7fPOw&usqp=CAU\n---\n\n刚渡过了我的27岁生日\n\n回顾这几年  似乎过的还不错\n\n有坚持看书提升 也培养几个比较有意义的兴趣爱好\n\n工作上 有互相帮助的同事 工作轻松 工资尚可\n\n烟、槟榔这些不好的习惯也早戒了\n\n遗憾的是晨跑的确是没能坚持下(尽力了... 有想互相监督的可以找我 )\n\n\n身边的朋友也一直都在 \n\n有旧识 新识\n\n无需敷衍，无需讨好\n\n偶尔撸串 喝几杯 畅聊人生 \n\n真是再好不过了\n\n谢谢你们 \n\n---\n\n到了这个年纪 有个始终都绕不开的那便是情感这个话题 \n\n随着年龄的增长 身边结婚、有小孩的朋友是越来越多了  \n\n其实我真的是羡慕 , 羡慕他们的生活 当然身边也有婚后过的不是那么幸福的朋友啦\n\n就如《围城》褚慎明说英国有句古话:\n \n::: tip\n “ 结婚仿佛金漆的鸟笼，笼子外面的鸟想住进去，笼内的鸟想飞出来；所以结而离，离而结，没有了局。”\n:::\n \n渐渐地我也接受了相亲(以前的我肯定瞧不起相亲,   最终小丑竟是我自己! )\n\n遇见了各种各样的女生, 至于到现在都没个结果  根源肯定是我自己\n\n经历了几次用尽全力最终却得到背叛  热情消耗殆尽且放一边 更多的是丢失了自信心\n\n朋友也有介绍优秀的女生给我, 用他们的话说便是 她哪点不如她 人家还对你那么好\n\n每每我都是简单的一句 不喜欢 敷衍了事\n\n真的是不喜欢嘛, 真要形容的话 一句歌词再好不过了\n\n“得不到的永远在骚动,被偏爱的都有恃无恐”\n\n好像从来便是如此, 正因此伤害过那些真正对我好的人, 好在她们现在都过的很好啦！\n\n有时候想想这便是因果吧\n\n\n愿大家 \n无所畏惧漫漫人生路，进取高唱潇潇岁月歌。","slug":"27","published":1,"updated":"2022-11-07T07:06:47.984Z","_id":"cla6che5f0000ys77fhxvfc1y","comments":1,"layout":"post","photos":[],"link":"","content":"<p>刚渡过了我的27岁生日</p>\n<p>回顾这几年  似乎过的还不错</p>\n<p>有坚持看书提升 也培养几个比较有意义的兴趣爱好</p>\n<p>工作上 有互相帮助的同事 工作轻松 工资尚可</p>\n<p>烟、槟榔这些不好的习惯也早戒了</p>\n<p>遗憾的是晨跑的确是没能坚持下(尽力了… 有想互相监督的可以找我 )</p>\n<p>身边的朋友也一直都在 </p>\n<p>有旧识 新识</p>\n<p>无需敷衍，无需讨好</p>\n<p>偶尔撸串 喝几杯 畅聊人生 </p>\n<p>真是再好不过了</p>\n<p>谢谢你们 </p>\n<hr>\n<p>到了这个年纪 有个始终都绕不开的那便是情感这个话题 </p>\n<p>随着年龄的增长 身边结婚、有小孩的朋友是越来越多了  </p>\n<p>其实我真的是羡慕 , 羡慕他们的生活 当然身边也有婚后过的不是那么幸福的朋友啦</p>\n<p>就如《围城》褚慎明说英国有句古话:</p>\n<p>::: tip<br> “ 结婚仿佛金漆的鸟笼，笼子外面的鸟想住进去，笼内的鸟想飞出来；所以结而离，离而结，没有了局。”<br>:::</p>\n<p>渐渐地我也接受了相亲(以前的我肯定瞧不起相亲,   最终小丑竟是我自己! )</p>\n<p>遇见了各种各样的女生, 至于到现在都没个结果  根源肯定是我自己</p>\n<p>经历了几次用尽全力最终却得到背叛  热情消耗殆尽且放一边 更多的是丢失了自信心</p>\n<p>朋友也有介绍优秀的女生给我, 用他们的话说便是 她哪点不如她 人家还对你那么好</p>\n<p>每每我都是简单的一句 不喜欢 敷衍了事</p>\n<p>真的是不喜欢嘛, 真要形容的话 一句歌词再好不过了</p>\n<p>“得不到的永远在骚动,被偏爱的都有恃无恐”</p>\n<p>好像从来便是如此, 正因此伤害过那些真正对我好的人, 好在她们现在都过的很好啦！</p>\n<p>有时候想想这便是因果吧</p>\n<p>愿大家<br>无所畏惧漫漫人生路，进取高唱潇潇岁月歌。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>刚渡过了我的27岁生日</p>\n<p>回顾这几年  似乎过的还不错</p>\n<p>有坚持看书提升 也培养几个比较有意义的兴趣爱好</p>\n<p>工作上 有互相帮助的同事 工作轻松 工资尚可</p>\n<p>烟、槟榔这些不好的习惯也早戒了</p>\n<p>遗憾的是晨跑的确是没能坚持下(尽力了… 有想互相监督的可以找我 )</p>\n<p>身边的朋友也一直都在 </p>\n<p>有旧识 新识</p>\n<p>无需敷衍，无需讨好</p>\n<p>偶尔撸串 喝几杯 畅聊人生 </p>\n<p>真是再好不过了</p>\n<p>谢谢你们 </p>\n<hr>\n<p>到了这个年纪 有个始终都绕不开的那便是情感这个话题 </p>\n<p>随着年龄的增长 身边结婚、有小孩的朋友是越来越多了  </p>\n<p>其实我真的是羡慕 , 羡慕他们的生活 当然身边也有婚后过的不是那么幸福的朋友啦</p>\n<p>就如《围城》褚慎明说英国有句古话:</p>\n<p>::: tip<br> “ 结婚仿佛金漆的鸟笼，笼子外面的鸟想住进去，笼内的鸟想飞出来；所以结而离，离而结，没有了局。”<br>:::</p>\n<p>渐渐地我也接受了相亲(以前的我肯定瞧不起相亲,   最终小丑竟是我自己! )</p>\n<p>遇见了各种各样的女生, 至于到现在都没个结果  根源肯定是我自己</p>\n<p>经历了几次用尽全力最终却得到背叛  热情消耗殆尽且放一边 更多的是丢失了自信心</p>\n<p>朋友也有介绍优秀的女生给我, 用他们的话说便是 她哪点不如她 人家还对你那么好</p>\n<p>每每我都是简单的一句 不喜欢 敷衍了事</p>\n<p>真的是不喜欢嘛, 真要形容的话 一句歌词再好不过了</p>\n<p>“得不到的永远在骚动,被偏爱的都有恃无恐”</p>\n<p>好像从来便是如此, 正因此伤害过那些真正对我好的人, 好在她们现在都过的很好啦！</p>\n<p>有时候想想这便是因果吧</p>\n<p>愿大家<br>无所畏惧漫漫人生路，进取高唱潇潇岁月歌。</p>\n"},{"title":"CSS 通过子元素设置父元素","top_img":false,"date":"2022-08-15T16:00:00.000Z","cover":"https://img0.baidu.com/it/u=2395867072,4290056404&fm=253&fmt=auto&app=120&f=JPEG?w=798&h=500","_content":"\n参考资料:\n\n[CSS 父元素如何通过判断子元素来设置样式](https://segmentfault.com/q/1010000000641252)\n\n[技术周刊 2021-05-21：Canvas 之春](https://zhuanlan.zhihu.com/p/374207985)\n\n## 背景\n某些特定场景下 我们希望通过子元素来判断从而修改父级属性。 \n除了JS控制之外是否有CSS实现这方面功能\n查了大量资料发现css现阶段没有实现这块\n\n原因如下:\n> 由于它违反了CSS目前的“不回溯”的原则，因此一直没有被纳入规范\n\n> 其实你从浏览器的角度来考虑这件事情，便不会有疑问了。假如浏览器支持父级或者前面兄弟元素选择器的话，就不得不在渲染到当前元素时，倒回去找到特定的元素，重新渲染。因为选择器是可以组合的，甚至还会造成很多其它元素也需要重新渲染（想象.someClass:parent div），这样带来的reflow和repaint会造成难以估量的性能问题，甚至计算盒模型的栈保不齐都要溢出。所以自然不会有类似的选择器出现了。\n\n\n## 现在\n\nChrome 意图实验性支持 CSS [:has()](https://developer.mozilla.org/en-US/docs/Web/CSS/:has) 选择器，可以用来选择父级元素。目前 Igalia 公司正在为 Chrome 实现该选择器，其团队成员 Brian Kardell 还发表了博文 Can I :has() 进行了详细介绍。\n``` html\n<style>\n.parent:has(.red) { color: red } /* 将匹配 .red 的父元素 .parent */\n.parent:has(.green) { color: green } /* 将匹配 .green 的父元素 .parent */\n</style>\n<div class=\"parent\"> <!-- color: red -->\n  <div class=\"red\"></div>\n</div>\n<div class=\"parent\"> <!-- color: green -->\n  <div class=\"green\"></div>\n</div>\n\n```\n\n![1](https://user-images.githubusercontent.com/70128222/194989165-f1ce3d30-d630-4e3d-a0ae-94381f9ca639.png)\n\n\n\n## 结论\n\n还是用js吧～\n","source":"_posts/CSS 通过子元素设置父元素.md","raw":"---\ntitle: CSS 通过子元素设置父元素\ntop_img: false\ndate: 2022-08-16\ncategories: \n- 前端\ntags:\n- CSS\ncover: https://img0.baidu.com/it/u=2395867072,4290056404&fm=253&fmt=auto&app=120&f=JPEG?w=798&h=500\n---\n\n参考资料:\n\n[CSS 父元素如何通过判断子元素来设置样式](https://segmentfault.com/q/1010000000641252)\n\n[技术周刊 2021-05-21：Canvas 之春](https://zhuanlan.zhihu.com/p/374207985)\n\n## 背景\n某些特定场景下 我们希望通过子元素来判断从而修改父级属性。 \n除了JS控制之外是否有CSS实现这方面功能\n查了大量资料发现css现阶段没有实现这块\n\n原因如下:\n> 由于它违反了CSS目前的“不回溯”的原则，因此一直没有被纳入规范\n\n> 其实你从浏览器的角度来考虑这件事情，便不会有疑问了。假如浏览器支持父级或者前面兄弟元素选择器的话，就不得不在渲染到当前元素时，倒回去找到特定的元素，重新渲染。因为选择器是可以组合的，甚至还会造成很多其它元素也需要重新渲染（想象.someClass:parent div），这样带来的reflow和repaint会造成难以估量的性能问题，甚至计算盒模型的栈保不齐都要溢出。所以自然不会有类似的选择器出现了。\n\n\n## 现在\n\nChrome 意图实验性支持 CSS [:has()](https://developer.mozilla.org/en-US/docs/Web/CSS/:has) 选择器，可以用来选择父级元素。目前 Igalia 公司正在为 Chrome 实现该选择器，其团队成员 Brian Kardell 还发表了博文 Can I :has() 进行了详细介绍。\n``` html\n<style>\n.parent:has(.red) { color: red } /* 将匹配 .red 的父元素 .parent */\n.parent:has(.green) { color: green } /* 将匹配 .green 的父元素 .parent */\n</style>\n<div class=\"parent\"> <!-- color: red -->\n  <div class=\"red\"></div>\n</div>\n<div class=\"parent\"> <!-- color: green -->\n  <div class=\"green\"></div>\n</div>\n\n```\n\n![1](https://user-images.githubusercontent.com/70128222/194989165-f1ce3d30-d630-4e3d-a0ae-94381f9ca639.png)\n\n\n\n## 结论\n\n还是用js吧～\n","slug":"CSS 通过子元素设置父元素","published":1,"updated":"2022-11-07T06:47:03.259Z","_id":"cla6che5k0001ys775vpe5ewu","comments":1,"layout":"post","photos":[],"link":"","content":"<p>参考资料:</p>\n<p><a href=\"https://segmentfault.com/q/1010000000641252\">CSS 父元素如何通过判断子元素来设置样式</a></p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/374207985\">技术周刊 2021-05-21：Canvas 之春</a></p>\n<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>某些特定场景下 我们希望通过子元素来判断从而修改父级属性。<br>除了JS控制之外是否有CSS实现这方面功能<br>查了大量资料发现css现阶段没有实现这块</p>\n<p>原因如下:</p>\n<blockquote>\n<p>由于它违反了CSS目前的“不回溯”的原则，因此一直没有被纳入规范</p>\n</blockquote>\n<blockquote>\n<p>其实你从浏览器的角度来考虑这件事情，便不会有疑问了。假如浏览器支持父级或者前面兄弟元素选择器的话，就不得不在渲染到当前元素时，倒回去找到特定的元素，重新渲染。因为选择器是可以组合的，甚至还会造成很多其它元素也需要重新渲染（想象.someClass:parent div），这样带来的reflow和repaint会造成难以估量的性能问题，甚至计算盒模型的栈保不齐都要溢出。所以自然不会有类似的选择器出现了。</p>\n</blockquote>\n<h2 id=\"现在\"><a href=\"#现在\" class=\"headerlink\" title=\"现在\"></a>现在</h2><p>Chrome 意图实验性支持 CSS <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/:has\">:has()</a> 选择器，可以用来选择父级元素。目前 Igalia 公司正在为 Chrome 实现该选择器，其团队成员 Brian Kardell 还发表了博文 Can I :has() 进行了详细介绍。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"selector-class\">.parent</span><span class=\"selector-pseudo\">:has</span>(<span class=\"selector-class\">.red</span>) &#123; <span class=\"attribute\">color</span>: red &#125; <span class=\"comment\">/* 将匹配 .red 的父元素 .parent */</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"selector-class\">.parent</span><span class=\"selector-pseudo\">:has</span>(<span class=\"selector-class\">.green</span>) &#123; <span class=\"attribute\">color</span>: green &#125; <span class=\"comment\">/* 将匹配 .green 的父元素 .parent */</span></span></span><br><span class=\"line\"><span class=\"language-css\"></span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;parent&quot;</span>&gt;</span> <span class=\"comment\">&lt;!-- color: red --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;red&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;parent&quot;</span>&gt;</span> <span class=\"comment\">&lt;!-- color: green --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;green&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://user-images.githubusercontent.com/70128222/194989165-f1ce3d30-d630-4e3d-a0ae-94381f9ca639.png\" alt=\"1\"></p>\n<h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h2><p>还是用js吧～</p>\n","site":{"data":{}},"excerpt":"","more":"<p>参考资料:</p>\n<p><a href=\"https://segmentfault.com/q/1010000000641252\">CSS 父元素如何通过判断子元素来设置样式</a></p>\n<p><a href=\"https://zhuanlan.zhihu.com/p/374207985\">技术周刊 2021-05-21：Canvas 之春</a></p>\n<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>某些特定场景下 我们希望通过子元素来判断从而修改父级属性。<br>除了JS控制之外是否有CSS实现这方面功能<br>查了大量资料发现css现阶段没有实现这块</p>\n<p>原因如下:</p>\n<blockquote>\n<p>由于它违反了CSS目前的“不回溯”的原则，因此一直没有被纳入规范</p>\n</blockquote>\n<blockquote>\n<p>其实你从浏览器的角度来考虑这件事情，便不会有疑问了。假如浏览器支持父级或者前面兄弟元素选择器的话，就不得不在渲染到当前元素时，倒回去找到特定的元素，重新渲染。因为选择器是可以组合的，甚至还会造成很多其它元素也需要重新渲染（想象.someClass:parent div），这样带来的reflow和repaint会造成难以估量的性能问题，甚至计算盒模型的栈保不齐都要溢出。所以自然不会有类似的选择器出现了。</p>\n</blockquote>\n<h2 id=\"现在\"><a href=\"#现在\" class=\"headerlink\" title=\"现在\"></a>现在</h2><p>Chrome 意图实验性支持 CSS <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/:has\">:has()</a> 选择器，可以用来选择父级元素。目前 Igalia 公司正在为 Chrome 实现该选择器，其团队成员 Brian Kardell 还发表了博文 Can I :has() 进行了详细介绍。</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">style</span>&gt;</span><span class=\"language-css\"></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"selector-class\">.parent</span><span class=\"selector-pseudo\">:has</span>(<span class=\"selector-class\">.red</span>) &#123; <span class=\"attribute\">color</span>: red &#125; <span class=\"comment\">/* 将匹配 .red 的父元素 .parent */</span></span></span><br><span class=\"line\"><span class=\"language-css\"><span class=\"selector-class\">.parent</span><span class=\"selector-pseudo\">:has</span>(<span class=\"selector-class\">.green</span>) &#123; <span class=\"attribute\">color</span>: green &#125; <span class=\"comment\">/* 将匹配 .green 的父元素 .parent */</span></span></span><br><span class=\"line\"><span class=\"language-css\"></span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;parent&quot;</span>&gt;</span> <span class=\"comment\">&lt;!-- color: red --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;red&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;parent&quot;</span>&gt;</span> <span class=\"comment\">&lt;!-- color: green --&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;green&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://user-images.githubusercontent.com/70128222/194989165-f1ce3d30-d630-4e3d-a0ae-94381f9ca639.png\" alt=\"1\"></p>\n<h2 id=\"结论\"><a href=\"#结论\" class=\"headerlink\" title=\"结论\"></a>结论</h2><p>还是用js吧～</p>\n"},{"title":"Electron自动更新or手动触发更新","top_img":false,"date":"2021-01-19T16:00:00.000Z","cover":"https://img0.baidu.com/it/u=1589470868,4145284120&fm=253&fmt=auto&app=138&f=PNG?w=720&h=241","_content":"\n## 背景\n\n我们用Electron开发了桌面应用, 项目同时也在不断更新迭代。我们希望只要发布了最新的版本，用户就能够收到更新提示从而进行升级。调研了市面上的实现方式后决定采取[electron-updater](https://www.npmjs.com/package/electron-updater)插件来实现更新功能。[electron-updater](https://www.npmjs.com/package/electron-updater)只需要简单的文件托管，不需要专用的服务器就能实现更新。\n\n## 开始\n\n我们先用脚手架新建一个空项目(vue)\n``` bash\nvue create electron-vue-demo // 新建项目\nvue add electron-builder // 安装electron v11.0.0\nnpm run electron:serve // 运行项目\nnpm i electron-updater // 安装electron-updater\n```\n\n## 配置\npublish 发布地址\n\n```json\n\"build\": {\n    \"productName\": \"demo\",\n    \"appId\": \"demo.fspace.com\",\n    \"directories\": {\n      \"output\": \"release\"\n    },\n    \"publish\": [\n      {\n        \"provider\": \"generic\",  // 服务器提供商 也可以是GitHub等等\n        \"url\": \"http://114.115.142.127:8989/download/\", // 更新文件存放位置\n        \"channel\": \"latest\",\n        \"useMultipleRangeRequest\": false\n      }\n    ],\n}\n```\n如果是vue-cli-plugin-electron-builder打包则会报错如下:\n<span style=\"display:block;color:red;\">\n    Question||'build' in the application package.json is not supported since 3.0\n</span>\n因为3.0后不支持json的方式, 需要移除package.json “build” \n\n<span style=\"display:block;color:green;\">vue.config.js </span>添加builderOptions\n后续需要在vue中使用ipcRenderer(主进程与渲染进程通信)\n所以需要设置 \n//  nodeIntegration: true\n\n``` json\nmodule.exports = {\n\t...\n  pluginOptions: {\n    electronBuilder: {\n    \tnodeIntegration: true, // ipcRenderer\n      builderOptions: {\n        productName: \"demo\",\n        appId: \"demo.fspace.com\",\n        directories: {\n          \"output\": \"release\"\n        },\n        publish: [\n          {\n            \"provider\": \"generic\",  // 服务器提供商 也可以是GitHub等等\n            \"url\": \"http://localhost:3006/\", // 更新文件存放位置\n            \"channel\": \"latest\",\n            \"useMultipleRangeRequest\": false\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n<span style=\"display:block;color:green;\">background.js </span>\n初始化 autoUpdater\n\n``` javascript\n'use strict'\n\nimport { app, protocol, BrowserWindow, ipcMain } from 'electron'\nimport { createProtocol } from 'vue-cli-plugin-electron-builder/lib'\nimport installExtension, { VUEJS_DEVTOOLS } from 'electron-devtools-installer'\nimport * as path from 'path';\nconst fs = require('fs');\nconst { autoUpdater } = require('electron-updater');\n\nconst isDevelopment = process.env.NODE_ENV !== 'production';\nconst DOWNLOAD_URL = 'http://localhost:3006/';\n\nvar package_json = require('../package.json');\nvar mainWindow = null;\n\n\n// Scheme must be registered before the app is ready\nprotocol.registerSchemesAsPrivileged([\n  { scheme: 'app', privileges: { secure: true, standard: true } }\n])\n\nasync function createWindow() {\n  // Create the browser window.\n  mainWindow = new BrowserWindow({\n    width: 800,\n    height: 600,\n    webPreferences: {\n      \n      // Use pluginOptions.nodeIntegration, leave this alone\n      // See nklayman.github.io/vue-cli-plugin-electron-builder/guide/security.html#node-integration for more info\n      nodeIntegration: process.env.ELECTRON_NODE_INTEGRATION\n    }\n  })\n\n  if (process.env.WEBPACK_DEV_SERVER_URL) {\n    // Load the url of the dev server if in development mode\n    await mainWindow.loadURL(process.env.WEBPACK_DEV_SERVER_URL)\n    if (!process.env.IS_TEST) mainWindow.webContents.openDevTools()\n  } else {\n    createProtocol('app')\n    // Load the index.html when not in development\n    mainWindow.loadURL('app://./index.html')\n  }\n}\n\n// Quit when all windows are closed.\napp.on('window-all-closed', () => {\n  // On macOS it is common for applications and their menu bar\n  // to stay active until the user quits explicitly with Cmd + Q\n  if (process.platform !== 'darwin') {\n    app.quit()\n  }\n})\n\napp.on('activate', () => {\n  // On macOS it's common to re-create a window in the app when the\n  // dock icon is clicked and there are no other windows open.\n  if (BrowserWindow.getAllWindows().length === 0) createWindow()\n})\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on('ready', async () => {\n  if (isDevelopment && !process.env.IS_TEST) {\n    // Install Vue Devtools\n    try {\n      await installExtension(VUEJS_DEVTOOLS)\n    } catch (e) {\n      console.error('Vue Devtools failed to install:', e.toString())\n    }\n  }\n  console.log('ready')\n  createWindow()\n  updateHandle();\n})\n\n// Exit cleanly on request from parent process in development mode.\nif (isDevelopment) {\n  if (process.platform === 'win32') {\n    process.on('message', (data) => {\n      if (data === 'graceful-exit') {\n        app.quit()\n      }\n    })\n  } else {\n    process.on('SIGTERM', () => {\n      app.quit()\n    })\n  }\n}\n\n\nfunction updateHandle() {\n  autoUpdater.currentVersion = package_json.version;\n\n  autoUpdater.setFeedURL(DOWNLOAD_URL);\n\n  // 取消自动更新\n  autoUpdater.autoDownload = false;\n  \n  autoUpdater.on('checking-for-update', (info) => {\n    // 开始检查是否有新版本\n    // 可以在这里提醒用户正在查找新版本\n    console.log('checking-for-update')\n  })\n\n  autoUpdater.on('update-available', (info) => {\n    // 检查到有新版本\n    // 提醒用户已经找到了新版本\n    console.log('检查到有新版本')\n  })\n  \n  autoUpdater.on('error', (err) => {\n    // 自动升级遇到错误\n  })\n  \n}\n```\n\n\n## 打包测试\n<span style=\"display:block;color:green;\">package.json</span>\n\n版本号 1.0.1\n``` json\n{\n  \"name\": \"electron-vue-demo\",\n  \"version\": \"1.0.1\",\n  ...\n}\n```\n执行打包\n\n``` shell\nvue-cli-service electron:build\n```\n\n打包后release目录 (当前为mac打包)\n\n``` md\n├── release\n│   ├── demo-1.0.1-mac.zip\n│   ├── demo-1.0.1.dmg \t\t\t\t\t // 安装文件\n│   ├── demo-1.0.1.dmg.blockmap // 用于差异更新, mac好像无效 \n│   ├── latest-mac.yml \t\t\t\t\t// 更新相关文件\n│   └── mac\n├── ...\n└── package.json\n```\n\n## 搭建静态服务\n\n这里使用koa koa-static 配置静态目录\n\n``` md\n├── server\n│   ├── public  // 存放更新文件\t\t\t\n│   └── server.js \t\n├── ...\n└── package.json\n```\n\n我们把demo-1.0.1-mac.zip / latest-mac.yml / 更新日志 放入更新目录public\n\n``` json\n{\n  \"version\": \"V1.0.1\",\n  \"content\": [\n  \"-🎉  v1.0.1版本盛大发布。\"\n  ]\n}\n```\n\n<span style=\"display:block;color:green;\">server.js</span>\n\n\n``` js\nconst Koa = require('koa');\nconst app = new Koa();\nconst path = require('path');\nconst serve = require('koa-static');\n \nconst main = serve(path.join(__dirname+'/public'));\napp.use(main);\n \napp.listen(3006,function(){\n  console.log(\"监听3006端口\")\n});\n```\n\n回到项目\n\n<span style=\"display:block;color:green;\">background.js</span>\n\n\n``` js\nimport { ipcMain } from 'electron'\n\n// ipcMain 监听渲染进程checkForUpdate 事件\nipcMain.on(\"checkForUpdate\",() => {\n  autoUpdater.currentVersion = package_json.version;\n  //执行更新检查\n  autoUpdater.checkForUpdates();\n})\n\nfunction updateHandle() {\n\t...\n  autoUpdater.on('update-available', (info) => {\n    // 检查到有新版本\n    // 提醒用户已经找到了新版本\n    console.log('检查到有新版本', info)\n  })\n  ...\n}\n```\n\n<span style=\"display:block;color:green;\">app.vue</span>\n\n``` vue\n<template>\n  <div id=\"app\">\n    <button @click=\"checkForUpdates\">检查更新</button>\n  </div>\n</template>\n<script>\nimport { ipcRenderer } from \"electron\";\nexport default {\n  name: 'App',\n  methods: {\n    checkForUpdates() {\n      // 通知主进程检查更新\n      ipcRenderer.send('checkForUpdate')\n    }\n  }\n}\n</script>\n\n<style>\n#app {\n  font-family: Avenir, Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  color: #2c3e50;\n  margin-top: 60px;\n}\n</style>\n```\n\n点击按钮, 控制台打印如下\n\n``` json\n检查到有新版本 {\n  version: '1.0.1',\n  files: [\n    {\n      url: 'demo-1.0.1-mac.zip',\n      sha512: 'PJeIr6HilOlNrcR8HEimQQuJHjEiK7x2PHhOGnmul5tTI2n0R7+6PP8S5j3+bwfZzSkjBWWWYnlR8WNoQ17YBQ==',\n      size: 77708593,\n      blockMapSize: 82077\n    },\n    {\n      url: 'demo-1.0.1.dmg',\n      sha512: 'i++/bWJ7pxIkShS+WehKkP8rLMjbKtHvFV/aLmDDj8lEqeyKP8cnVpSSlNNbqOwcqbxSzR5t07QMIUIVf0AMYw==',\n      size: 80015179\n    }\n  ],\n  path: 'demo-1.0.1-mac.zip',\n  sha512: 'PJeIr6HilOlNrcR8HEimQQuJHjEiK7x2PHhOGnmul5tTI2n0R7+6PP8S5j3+bwfZzSkjBWWWYnlR8WNoQ17YBQ==',\n  releaseDate: '2021-04-21T05:38:20.929Z'\n}\n```\n\nautoUpdater.downloadUpdate(); // 下载更新\nautoUpdater.quitAndInstall(); // 执行推出安装更新\n依次执行后实现了更新操作, 当然这对用户来说非常不友好，需要把更新流程交给用户去控制。\n\nautoUpdater给我们提供 download-progress(更新进度)、update-downloaded(更新完成) 监听。\n\n<span style=\"display:block;color:green;\">app.vue</span>\n\n``` vue\n<template>\n  <div id=\"app\">\n    <a-button @click=\"checkForUpdates\">检查更新</a-button>\n    <!-- 更新提示框 -->\n    <div class=\"main-container__upgrade-panel\" v-if=\"show\">\n      <div class=\"main-container__upgrade-panel-title\">\n        {{`发现新版本${versionInfo.version}`}}\n        <span @click=\"() => { show = !show }\"><a-tooltip title=\"最小化\" placement=\"top\"><a-icon type=\"down-circle\" /></a-tooltip></span>\n      </div>\n      <div class=\"main-container__upgrade-panel-body\">\n        <div class=\"main-container__pd1t\">\n          更新日志:\n          </div>\n          <div v-for=\"(item, index) in versionInfo.content\" :key=\"index\">{{item}}</div>\n      </div>\n      <div class=\"main-container__upgrade-panel-footer\">\n        <div style=\"width: 305px;\">\n          <a-progress\n            :stroke-color=\"{\n              from: '#108ee9',\n              to: '#87d068',\n            }\"\n            :percent=\"progress.percent\"\n            status=\"active\"\n          />\n        </div>\n        <a-button style=\"margin-right: 10px;\" v-if=\"canInstall\" type=\"primary\" @click=\"() => icpSend('quitAndInstall')\">安装</a-button>\n\n        <a-button style=\"margin-right: 10px;\" v-else type=\"primary\" :loading=\"loading\"  @click=\"() => { loading = true, icpSend('downloadUpdate') }\"> <a-icon v-if=\"!loading\" type=\"down-square\" /> 更新</a-button>\n\n        <a-button :disabled=\"progress.percent > 0\" type=\"dashed\" @click=\"() => { show = !show }\">下次再说</a-button>\n\n      </div>\n    </div>\n    \n  </div>\n</template>\n<script>\nimport { ipcRenderer } from \"electron\";\nexport default {\n  name: 'App',\n  data() {\n    return {\n      DOWNLOAD_URL: 'http://localhost:3006/',\n      canInstall: false,\n      show: false,\n      progress: {\n        bytesPerSecond: 0,\n        delta: 0,\n        percent: 0,\n        total: 0,\n        transferred: 0\n      },\n      loading: false,\n      versionInfo: {\n        version: '',\n        content: [\n          '123',\n          '456'\n        ]\n      }\n    }\n  },\n  created() {\n    // 版本有更新时提示\n    ipcRenderer.on(\"updateAvailable\", async (event, info) => {\n      const verInfo = await this.getVersionInfo(info);\n      if (verInfo) {\n        try {\n          this.versionInfo.version = JSON.parse(verInfo).version;\n          this.versionInfo.content = JSON.parse(verInfo).content;\n        } catch (e) {\n          console.log(e)\n        }\n        this.show = true;\n      }\n\n    });\n    // 下载进度条\n    ipcRenderer.on(\"downloadProgress\", (event, progressObj) => {\n      progressObj.percent = Number(progressObj.percent.toFixed(1));\n      this.progress = {\n        ...progressObj\n      };\n    });\n\n    ipcRenderer.on(\"isUpdateNow\", () => {\n      this.canInstall = true;\n      this.show = true;\n    });\n  },\n  methods: {\n    async getVersionInfo(info) {\n      return new Promise((resolve) => {\n        let xhr = new XMLHttpRequest();\n        xhr.open('get', this.DOWNLOAD_URL + info.version + '.json', true);\n        xhr.send(null);\n        xhr.onreadystatechange = function () {\n          \n          if (xhr.readyState == 4) {\n            if (xhr.status == 200) {\n              \n              resolve(xhr.responseText)\n            } else {\n              resolve(null)\n            }\n          }\n        };\n\n      });\n    },\n    icpSend(name) {\n      ipcRenderer.send(name);\n    },\n    checkForUpdates() {\n      ipcRenderer.send('checkForUpdate')\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n#app {\n  font-family: Avenir, Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  color: #2c3e50;\n  margin-top: 60px;\n}\n\n.main-container {\n  width: 100%;\n  position: relative;\n  // display: flex;\n  background: #f7f7f7;\n\n  &__drag {\n    position: absolute;\n    width: calc(100% - 100px);\n    height: 25px;\n    -webkit-app-region: drag;\n    .overlay {\n      pointer-events: none;\n    }\n  }\n\n  &__controls {\n    position: absolute;\n    right: 0;\n    -webkit-app-region: no-drag;\n    top: 0;\n    z-index: 200;\n    border-radius: 0 0 3px 3px;\n    padding: 0;\n    background: #bfbfbf21;\n    :hover {\n      color: white;\n      background: gray;\n    }\n    :nth-child(3):hover{\n      background-color: red;\n    }\n\n    &-item {\n      display: inline-block;\n      padding: 5px 10px;\n      color: #ccc;\n      font-size: 12px;\n      -webkit-app-region: no-drag;\n    }\n  }\n\n  &__upgrade-panel {\n    position: fixed;\n    z-index: 9999;\n    right: 10px;\n    bottom: 25px;\n    width: 340px;\n    background-color: #34373c;\n    color: white;\n    border-radius: 3px;\n    font-size: 12px;\n    box-shadow: 0px 0px 5px 5px rgba(133,133,133,0.25);\n\n    ::-webkit-scrollbar {\n      display: none; /* Chrome Safari */\n    }\n\n    &-title {\n      padding: 10px 15px;\n      width: 100%;\n      height: 40px;\n      border-bottom: 1px solid white;\n\n      span {\n        position: absolute;\n        font-size: 14px;\n        right: 10px;\n      }\n\n      span:hover {\n        color:#FFFFFF;\n        background-color:#6dd214;\n        text-shadow:none;\n      }\n    }\n\n    &-body {\n      overflow-y: auto;\n      padding: 10px 15px;\n      max-height: 100px;\n    }\n    &-footer {\n      padding-left: 10px;\n      padding-bottom: 10px;\n\n      a-button {\n        margin-right: 15px;\n      }\n    }\n  }\n\n  &__pd1t {\n    padding-top: 5px;\n  }\n}\n\n.ant-progress-text {\n  color: white !important;\n}\n</style>\n\n```\n\n<span style=\"display:block;color:green;\">background.js</span>\n\n``` js\n'use strict'\n\nimport { app, protocol, BrowserWindow, ipcMain } from 'electron'\nimport { createProtocol } from 'vue-cli-plugin-electron-builder/lib'\nimport installExtension, { VUEJS_DEVTOOLS } from 'electron-devtools-installer'\nconst fs = require('fs');\nconst { autoUpdater } = require('electron-updater');\n\nconst isDevelopment = process.env.NODE_ENV !== 'production';\nconst DOWNLOAD_URL = 'http://localhost:3006/';\n\nvar package_json = require('../package.json');\nvar mainWindow = null;\n\n\n// Scheme must be registered before the app is ready\nprotocol.registerSchemesAsPrivileged([\n  { scheme: 'app', privileges: { secure: true, standard: true } }\n])\n\nasync function createWindow() {\n  // Create the browser window.\n  mainWindow = new BrowserWindow({\n    width: 800,\n    height: 600,\n    webPreferences: {\n      \n      // Use pluginOptions.nodeIntegration, leave this alone\n      // See nklayman.github.io/vue-cli-plugin-electron-builder/guide/security.html#node-integration for more info\n      nodeIntegration: process.env.ELECTRON_NODE_INTEGRATION\n    }\n  })\n\n  if (process.env.WEBPACK_DEV_SERVER_URL) {\n    // Load the url of the dev server if in development mode\n    await mainWindow.loadURL(process.env.WEBPACK_DEV_SERVER_URL)\n    if (!process.env.IS_TEST) mainWindow.webContents.openDevTools()\n  } else {\n    createProtocol('app')\n    // Load the index.html when not in development\n    mainWindow.loadURL('app://./index.html')\n  }\n}\n\n// Quit when all windows are closed.\napp.on('window-all-closed', () => {\n  // On macOS it is common for applications and their menu bar\n  // to stay active until the user quits explicitly with Cmd + Q\n  if (process.platform !== 'darwin') {\n    app.quit()\n  }\n})\n\napp.on('activate', () => {\n  // On macOS it's common to re-create a window in the app when the\n  // dock icon is clicked and there are no other windows open.\n  if (BrowserWindow.getAllWindows().length === 0) createWindow()\n})\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on('ready', async () => {\n  if (isDevelopment && !process.env.IS_TEST) {\n    // Install Vue Devtools\n    try {\n      await installExtension(VUEJS_DEVTOOLS)\n    } catch (e) {\n      console.error('Vue Devtools failed to install:', e.toString())\n    }\n  }\n  console.log('ready')\n  createWindow()\n  updateHandle();\n})\n\n// Exit cleanly on request from parent process in development mode.\nif (isDevelopment) {\n  if (process.platform === 'win32') {\n    process.on('message', (data) => {\n      if (data === 'graceful-exit') {\n        app.quit()\n      }\n    })\n  } else {\n    process.on('SIGTERM', () => {\n      app.quit()\n    })\n  }\n}\n\n\nconst deleteFile = (path) => {\n  var files = [];\n  if( fs.existsSync(path) ) {\n      files = fs.readdirSync(path);\n      files.forEach(function(file){\n          var curPath = path + \"/\" + file;\n          if(fs.statSync(curPath).isDirectory()) {\n              deleteFile(curPath);\n          } else {\n              fs.unlinkSync(curPath);\n          }\n      });\n      fs.rmdirSync(path);\n  }\n};\n\nfunction updateHandle() {\n  autoUpdater.currentVersion = package_json.version;\n\n  autoUpdater.setFeedURL(DOWNLOAD_URL);\n\n  // 取消自动更新\n  autoUpdater.autoDownload = false;\n  \n  autoUpdater.on('checking-for-update', (info) => {\n    // 开始检查是否有新版本\n    // 可以在这里提醒用户正在查找新版本\n  })\n\n  autoUpdater.on('update-available', (info) => {\n    // 检查到有新版本\n    // 提醒用户已经找到了新版本\n    console.log(info)\n    mainWindow.webContents.send('updateAvailable', info)\n  })\n  \n  autoUpdater.on('update-not-available', (info) => {\n    // 检查到无新版本\n    // 提醒用户当前版本已经是最新版，无需更新\n  })\n\n  autoUpdater.on('download-progress', function (progressObj) {\n    // 更新进度条\n    mainWindow.webContents.send('downloadProgress', progressObj)\n  })\n  \n  autoUpdater.on('error', (err) => {\n    // 自动升级遇到错误\n  })\n  \n  autoUpdater.on('update-downloaded', (ev, releaseNotes, releaseName) => {\n    // 自动升级下载完成\n    // 可以询问用户是否重启应用更新，用户如果同意就可以执行 autoUpdater.quitAndInstall()\n    mainWindow.webContents.send('isUpdateNow')\n  })\n}\n\nipcMain.on(\"checkForUpdate\",() => {\n  console.log(autoUpdater.currentVersion)\n  autoUpdater.currentVersion = package_json.version;\n  //执行自动更新检查\n  autoUpdater.checkForUpdates();\n})\n\nipcMain.on(\"downloadUpdate\",() => {\n  try {\n    // 更新前删除本地更新包\n    deleteFile(autoUpdater.app.baseCachePath)\n  }catch {\n    \n  }\n  //执行自动更新检查\n  autoUpdater.downloadUpdate();\n})\n\nipcMain.on(\"quitAndInstall\",() => {\n  //执行自动更新检查\n  autoUpdater.quitAndInstall();\n})\n```\n\n## 最终效果\n\n![preview](https://user-images.githubusercontent.com/70128222/194988621-0040f2df-fa6c-45b7-adfe-98fe6a639bc9.gif)\n","source":"_posts/Electron自动更新or手动触发更新.md","raw":"---\ntitle: Electron自动更新or手动触发更新\ntop_img: false\ndate: 2021-01-20\ncategories: \n- 前端\ntags:\n- Electron\ncover: https://img0.baidu.com/it/u=1589470868,4145284120&fm=253&fmt=auto&app=138&f=PNG?w=720&h=241\n---\n\n## 背景\n\n我们用Electron开发了桌面应用, 项目同时也在不断更新迭代。我们希望只要发布了最新的版本，用户就能够收到更新提示从而进行升级。调研了市面上的实现方式后决定采取[electron-updater](https://www.npmjs.com/package/electron-updater)插件来实现更新功能。[electron-updater](https://www.npmjs.com/package/electron-updater)只需要简单的文件托管，不需要专用的服务器就能实现更新。\n\n## 开始\n\n我们先用脚手架新建一个空项目(vue)\n``` bash\nvue create electron-vue-demo // 新建项目\nvue add electron-builder // 安装electron v11.0.0\nnpm run electron:serve // 运行项目\nnpm i electron-updater // 安装electron-updater\n```\n\n## 配置\npublish 发布地址\n\n```json\n\"build\": {\n    \"productName\": \"demo\",\n    \"appId\": \"demo.fspace.com\",\n    \"directories\": {\n      \"output\": \"release\"\n    },\n    \"publish\": [\n      {\n        \"provider\": \"generic\",  // 服务器提供商 也可以是GitHub等等\n        \"url\": \"http://114.115.142.127:8989/download/\", // 更新文件存放位置\n        \"channel\": \"latest\",\n        \"useMultipleRangeRequest\": false\n      }\n    ],\n}\n```\n如果是vue-cli-plugin-electron-builder打包则会报错如下:\n<span style=\"display:block;color:red;\">\n    Question||'build' in the application package.json is not supported since 3.0\n</span>\n因为3.0后不支持json的方式, 需要移除package.json “build” \n\n<span style=\"display:block;color:green;\">vue.config.js </span>添加builderOptions\n后续需要在vue中使用ipcRenderer(主进程与渲染进程通信)\n所以需要设置 \n//  nodeIntegration: true\n\n``` json\nmodule.exports = {\n\t...\n  pluginOptions: {\n    electronBuilder: {\n    \tnodeIntegration: true, // ipcRenderer\n      builderOptions: {\n        productName: \"demo\",\n        appId: \"demo.fspace.com\",\n        directories: {\n          \"output\": \"release\"\n        },\n        publish: [\n          {\n            \"provider\": \"generic\",  // 服务器提供商 也可以是GitHub等等\n            \"url\": \"http://localhost:3006/\", // 更新文件存放位置\n            \"channel\": \"latest\",\n            \"useMultipleRangeRequest\": false\n          }\n        ]\n      }\n    }\n  }\n}\n```\n\n<span style=\"display:block;color:green;\">background.js </span>\n初始化 autoUpdater\n\n``` javascript\n'use strict'\n\nimport { app, protocol, BrowserWindow, ipcMain } from 'electron'\nimport { createProtocol } from 'vue-cli-plugin-electron-builder/lib'\nimport installExtension, { VUEJS_DEVTOOLS } from 'electron-devtools-installer'\nimport * as path from 'path';\nconst fs = require('fs');\nconst { autoUpdater } = require('electron-updater');\n\nconst isDevelopment = process.env.NODE_ENV !== 'production';\nconst DOWNLOAD_URL = 'http://localhost:3006/';\n\nvar package_json = require('../package.json');\nvar mainWindow = null;\n\n\n// Scheme must be registered before the app is ready\nprotocol.registerSchemesAsPrivileged([\n  { scheme: 'app', privileges: { secure: true, standard: true } }\n])\n\nasync function createWindow() {\n  // Create the browser window.\n  mainWindow = new BrowserWindow({\n    width: 800,\n    height: 600,\n    webPreferences: {\n      \n      // Use pluginOptions.nodeIntegration, leave this alone\n      // See nklayman.github.io/vue-cli-plugin-electron-builder/guide/security.html#node-integration for more info\n      nodeIntegration: process.env.ELECTRON_NODE_INTEGRATION\n    }\n  })\n\n  if (process.env.WEBPACK_DEV_SERVER_URL) {\n    // Load the url of the dev server if in development mode\n    await mainWindow.loadURL(process.env.WEBPACK_DEV_SERVER_URL)\n    if (!process.env.IS_TEST) mainWindow.webContents.openDevTools()\n  } else {\n    createProtocol('app')\n    // Load the index.html when not in development\n    mainWindow.loadURL('app://./index.html')\n  }\n}\n\n// Quit when all windows are closed.\napp.on('window-all-closed', () => {\n  // On macOS it is common for applications and their menu bar\n  // to stay active until the user quits explicitly with Cmd + Q\n  if (process.platform !== 'darwin') {\n    app.quit()\n  }\n})\n\napp.on('activate', () => {\n  // On macOS it's common to re-create a window in the app when the\n  // dock icon is clicked and there are no other windows open.\n  if (BrowserWindow.getAllWindows().length === 0) createWindow()\n})\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on('ready', async () => {\n  if (isDevelopment && !process.env.IS_TEST) {\n    // Install Vue Devtools\n    try {\n      await installExtension(VUEJS_DEVTOOLS)\n    } catch (e) {\n      console.error('Vue Devtools failed to install:', e.toString())\n    }\n  }\n  console.log('ready')\n  createWindow()\n  updateHandle();\n})\n\n// Exit cleanly on request from parent process in development mode.\nif (isDevelopment) {\n  if (process.platform === 'win32') {\n    process.on('message', (data) => {\n      if (data === 'graceful-exit') {\n        app.quit()\n      }\n    })\n  } else {\n    process.on('SIGTERM', () => {\n      app.quit()\n    })\n  }\n}\n\n\nfunction updateHandle() {\n  autoUpdater.currentVersion = package_json.version;\n\n  autoUpdater.setFeedURL(DOWNLOAD_URL);\n\n  // 取消自动更新\n  autoUpdater.autoDownload = false;\n  \n  autoUpdater.on('checking-for-update', (info) => {\n    // 开始检查是否有新版本\n    // 可以在这里提醒用户正在查找新版本\n    console.log('checking-for-update')\n  })\n\n  autoUpdater.on('update-available', (info) => {\n    // 检查到有新版本\n    // 提醒用户已经找到了新版本\n    console.log('检查到有新版本')\n  })\n  \n  autoUpdater.on('error', (err) => {\n    // 自动升级遇到错误\n  })\n  \n}\n```\n\n\n## 打包测试\n<span style=\"display:block;color:green;\">package.json</span>\n\n版本号 1.0.1\n``` json\n{\n  \"name\": \"electron-vue-demo\",\n  \"version\": \"1.0.1\",\n  ...\n}\n```\n执行打包\n\n``` shell\nvue-cli-service electron:build\n```\n\n打包后release目录 (当前为mac打包)\n\n``` md\n├── release\n│   ├── demo-1.0.1-mac.zip\n│   ├── demo-1.0.1.dmg \t\t\t\t\t // 安装文件\n│   ├── demo-1.0.1.dmg.blockmap // 用于差异更新, mac好像无效 \n│   ├── latest-mac.yml \t\t\t\t\t// 更新相关文件\n│   └── mac\n├── ...\n└── package.json\n```\n\n## 搭建静态服务\n\n这里使用koa koa-static 配置静态目录\n\n``` md\n├── server\n│   ├── public  // 存放更新文件\t\t\t\n│   └── server.js \t\n├── ...\n└── package.json\n```\n\n我们把demo-1.0.1-mac.zip / latest-mac.yml / 更新日志 放入更新目录public\n\n``` json\n{\n  \"version\": \"V1.0.1\",\n  \"content\": [\n  \"-🎉  v1.0.1版本盛大发布。\"\n  ]\n}\n```\n\n<span style=\"display:block;color:green;\">server.js</span>\n\n\n``` js\nconst Koa = require('koa');\nconst app = new Koa();\nconst path = require('path');\nconst serve = require('koa-static');\n \nconst main = serve(path.join(__dirname+'/public'));\napp.use(main);\n \napp.listen(3006,function(){\n  console.log(\"监听3006端口\")\n});\n```\n\n回到项目\n\n<span style=\"display:block;color:green;\">background.js</span>\n\n\n``` js\nimport { ipcMain } from 'electron'\n\n// ipcMain 监听渲染进程checkForUpdate 事件\nipcMain.on(\"checkForUpdate\",() => {\n  autoUpdater.currentVersion = package_json.version;\n  //执行更新检查\n  autoUpdater.checkForUpdates();\n})\n\nfunction updateHandle() {\n\t...\n  autoUpdater.on('update-available', (info) => {\n    // 检查到有新版本\n    // 提醒用户已经找到了新版本\n    console.log('检查到有新版本', info)\n  })\n  ...\n}\n```\n\n<span style=\"display:block;color:green;\">app.vue</span>\n\n``` vue\n<template>\n  <div id=\"app\">\n    <button @click=\"checkForUpdates\">检查更新</button>\n  </div>\n</template>\n<script>\nimport { ipcRenderer } from \"electron\";\nexport default {\n  name: 'App',\n  methods: {\n    checkForUpdates() {\n      // 通知主进程检查更新\n      ipcRenderer.send('checkForUpdate')\n    }\n  }\n}\n</script>\n\n<style>\n#app {\n  font-family: Avenir, Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  color: #2c3e50;\n  margin-top: 60px;\n}\n</style>\n```\n\n点击按钮, 控制台打印如下\n\n``` json\n检查到有新版本 {\n  version: '1.0.1',\n  files: [\n    {\n      url: 'demo-1.0.1-mac.zip',\n      sha512: 'PJeIr6HilOlNrcR8HEimQQuJHjEiK7x2PHhOGnmul5tTI2n0R7+6PP8S5j3+bwfZzSkjBWWWYnlR8WNoQ17YBQ==',\n      size: 77708593,\n      blockMapSize: 82077\n    },\n    {\n      url: 'demo-1.0.1.dmg',\n      sha512: 'i++/bWJ7pxIkShS+WehKkP8rLMjbKtHvFV/aLmDDj8lEqeyKP8cnVpSSlNNbqOwcqbxSzR5t07QMIUIVf0AMYw==',\n      size: 80015179\n    }\n  ],\n  path: 'demo-1.0.1-mac.zip',\n  sha512: 'PJeIr6HilOlNrcR8HEimQQuJHjEiK7x2PHhOGnmul5tTI2n0R7+6PP8S5j3+bwfZzSkjBWWWYnlR8WNoQ17YBQ==',\n  releaseDate: '2021-04-21T05:38:20.929Z'\n}\n```\n\nautoUpdater.downloadUpdate(); // 下载更新\nautoUpdater.quitAndInstall(); // 执行推出安装更新\n依次执行后实现了更新操作, 当然这对用户来说非常不友好，需要把更新流程交给用户去控制。\n\nautoUpdater给我们提供 download-progress(更新进度)、update-downloaded(更新完成) 监听。\n\n<span style=\"display:block;color:green;\">app.vue</span>\n\n``` vue\n<template>\n  <div id=\"app\">\n    <a-button @click=\"checkForUpdates\">检查更新</a-button>\n    <!-- 更新提示框 -->\n    <div class=\"main-container__upgrade-panel\" v-if=\"show\">\n      <div class=\"main-container__upgrade-panel-title\">\n        {{`发现新版本${versionInfo.version}`}}\n        <span @click=\"() => { show = !show }\"><a-tooltip title=\"最小化\" placement=\"top\"><a-icon type=\"down-circle\" /></a-tooltip></span>\n      </div>\n      <div class=\"main-container__upgrade-panel-body\">\n        <div class=\"main-container__pd1t\">\n          更新日志:\n          </div>\n          <div v-for=\"(item, index) in versionInfo.content\" :key=\"index\">{{item}}</div>\n      </div>\n      <div class=\"main-container__upgrade-panel-footer\">\n        <div style=\"width: 305px;\">\n          <a-progress\n            :stroke-color=\"{\n              from: '#108ee9',\n              to: '#87d068',\n            }\"\n            :percent=\"progress.percent\"\n            status=\"active\"\n          />\n        </div>\n        <a-button style=\"margin-right: 10px;\" v-if=\"canInstall\" type=\"primary\" @click=\"() => icpSend('quitAndInstall')\">安装</a-button>\n\n        <a-button style=\"margin-right: 10px;\" v-else type=\"primary\" :loading=\"loading\"  @click=\"() => { loading = true, icpSend('downloadUpdate') }\"> <a-icon v-if=\"!loading\" type=\"down-square\" /> 更新</a-button>\n\n        <a-button :disabled=\"progress.percent > 0\" type=\"dashed\" @click=\"() => { show = !show }\">下次再说</a-button>\n\n      </div>\n    </div>\n    \n  </div>\n</template>\n<script>\nimport { ipcRenderer } from \"electron\";\nexport default {\n  name: 'App',\n  data() {\n    return {\n      DOWNLOAD_URL: 'http://localhost:3006/',\n      canInstall: false,\n      show: false,\n      progress: {\n        bytesPerSecond: 0,\n        delta: 0,\n        percent: 0,\n        total: 0,\n        transferred: 0\n      },\n      loading: false,\n      versionInfo: {\n        version: '',\n        content: [\n          '123',\n          '456'\n        ]\n      }\n    }\n  },\n  created() {\n    // 版本有更新时提示\n    ipcRenderer.on(\"updateAvailable\", async (event, info) => {\n      const verInfo = await this.getVersionInfo(info);\n      if (verInfo) {\n        try {\n          this.versionInfo.version = JSON.parse(verInfo).version;\n          this.versionInfo.content = JSON.parse(verInfo).content;\n        } catch (e) {\n          console.log(e)\n        }\n        this.show = true;\n      }\n\n    });\n    // 下载进度条\n    ipcRenderer.on(\"downloadProgress\", (event, progressObj) => {\n      progressObj.percent = Number(progressObj.percent.toFixed(1));\n      this.progress = {\n        ...progressObj\n      };\n    });\n\n    ipcRenderer.on(\"isUpdateNow\", () => {\n      this.canInstall = true;\n      this.show = true;\n    });\n  },\n  methods: {\n    async getVersionInfo(info) {\n      return new Promise((resolve) => {\n        let xhr = new XMLHttpRequest();\n        xhr.open('get', this.DOWNLOAD_URL + info.version + '.json', true);\n        xhr.send(null);\n        xhr.onreadystatechange = function () {\n          \n          if (xhr.readyState == 4) {\n            if (xhr.status == 200) {\n              \n              resolve(xhr.responseText)\n            } else {\n              resolve(null)\n            }\n          }\n        };\n\n      });\n    },\n    icpSend(name) {\n      ipcRenderer.send(name);\n    },\n    checkForUpdates() {\n      ipcRenderer.send('checkForUpdate')\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\n#app {\n  font-family: Avenir, Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  color: #2c3e50;\n  margin-top: 60px;\n}\n\n.main-container {\n  width: 100%;\n  position: relative;\n  // display: flex;\n  background: #f7f7f7;\n\n  &__drag {\n    position: absolute;\n    width: calc(100% - 100px);\n    height: 25px;\n    -webkit-app-region: drag;\n    .overlay {\n      pointer-events: none;\n    }\n  }\n\n  &__controls {\n    position: absolute;\n    right: 0;\n    -webkit-app-region: no-drag;\n    top: 0;\n    z-index: 200;\n    border-radius: 0 0 3px 3px;\n    padding: 0;\n    background: #bfbfbf21;\n    :hover {\n      color: white;\n      background: gray;\n    }\n    :nth-child(3):hover{\n      background-color: red;\n    }\n\n    &-item {\n      display: inline-block;\n      padding: 5px 10px;\n      color: #ccc;\n      font-size: 12px;\n      -webkit-app-region: no-drag;\n    }\n  }\n\n  &__upgrade-panel {\n    position: fixed;\n    z-index: 9999;\n    right: 10px;\n    bottom: 25px;\n    width: 340px;\n    background-color: #34373c;\n    color: white;\n    border-radius: 3px;\n    font-size: 12px;\n    box-shadow: 0px 0px 5px 5px rgba(133,133,133,0.25);\n\n    ::-webkit-scrollbar {\n      display: none; /* Chrome Safari */\n    }\n\n    &-title {\n      padding: 10px 15px;\n      width: 100%;\n      height: 40px;\n      border-bottom: 1px solid white;\n\n      span {\n        position: absolute;\n        font-size: 14px;\n        right: 10px;\n      }\n\n      span:hover {\n        color:#FFFFFF;\n        background-color:#6dd214;\n        text-shadow:none;\n      }\n    }\n\n    &-body {\n      overflow-y: auto;\n      padding: 10px 15px;\n      max-height: 100px;\n    }\n    &-footer {\n      padding-left: 10px;\n      padding-bottom: 10px;\n\n      a-button {\n        margin-right: 15px;\n      }\n    }\n  }\n\n  &__pd1t {\n    padding-top: 5px;\n  }\n}\n\n.ant-progress-text {\n  color: white !important;\n}\n</style>\n\n```\n\n<span style=\"display:block;color:green;\">background.js</span>\n\n``` js\n'use strict'\n\nimport { app, protocol, BrowserWindow, ipcMain } from 'electron'\nimport { createProtocol } from 'vue-cli-plugin-electron-builder/lib'\nimport installExtension, { VUEJS_DEVTOOLS } from 'electron-devtools-installer'\nconst fs = require('fs');\nconst { autoUpdater } = require('electron-updater');\n\nconst isDevelopment = process.env.NODE_ENV !== 'production';\nconst DOWNLOAD_URL = 'http://localhost:3006/';\n\nvar package_json = require('../package.json');\nvar mainWindow = null;\n\n\n// Scheme must be registered before the app is ready\nprotocol.registerSchemesAsPrivileged([\n  { scheme: 'app', privileges: { secure: true, standard: true } }\n])\n\nasync function createWindow() {\n  // Create the browser window.\n  mainWindow = new BrowserWindow({\n    width: 800,\n    height: 600,\n    webPreferences: {\n      \n      // Use pluginOptions.nodeIntegration, leave this alone\n      // See nklayman.github.io/vue-cli-plugin-electron-builder/guide/security.html#node-integration for more info\n      nodeIntegration: process.env.ELECTRON_NODE_INTEGRATION\n    }\n  })\n\n  if (process.env.WEBPACK_DEV_SERVER_URL) {\n    // Load the url of the dev server if in development mode\n    await mainWindow.loadURL(process.env.WEBPACK_DEV_SERVER_URL)\n    if (!process.env.IS_TEST) mainWindow.webContents.openDevTools()\n  } else {\n    createProtocol('app')\n    // Load the index.html when not in development\n    mainWindow.loadURL('app://./index.html')\n  }\n}\n\n// Quit when all windows are closed.\napp.on('window-all-closed', () => {\n  // On macOS it is common for applications and their menu bar\n  // to stay active until the user quits explicitly with Cmd + Q\n  if (process.platform !== 'darwin') {\n    app.quit()\n  }\n})\n\napp.on('activate', () => {\n  // On macOS it's common to re-create a window in the app when the\n  // dock icon is clicked and there are no other windows open.\n  if (BrowserWindow.getAllWindows().length === 0) createWindow()\n})\n\n// This method will be called when Electron has finished\n// initialization and is ready to create browser windows.\n// Some APIs can only be used after this event occurs.\napp.on('ready', async () => {\n  if (isDevelopment && !process.env.IS_TEST) {\n    // Install Vue Devtools\n    try {\n      await installExtension(VUEJS_DEVTOOLS)\n    } catch (e) {\n      console.error('Vue Devtools failed to install:', e.toString())\n    }\n  }\n  console.log('ready')\n  createWindow()\n  updateHandle();\n})\n\n// Exit cleanly on request from parent process in development mode.\nif (isDevelopment) {\n  if (process.platform === 'win32') {\n    process.on('message', (data) => {\n      if (data === 'graceful-exit') {\n        app.quit()\n      }\n    })\n  } else {\n    process.on('SIGTERM', () => {\n      app.quit()\n    })\n  }\n}\n\n\nconst deleteFile = (path) => {\n  var files = [];\n  if( fs.existsSync(path) ) {\n      files = fs.readdirSync(path);\n      files.forEach(function(file){\n          var curPath = path + \"/\" + file;\n          if(fs.statSync(curPath).isDirectory()) {\n              deleteFile(curPath);\n          } else {\n              fs.unlinkSync(curPath);\n          }\n      });\n      fs.rmdirSync(path);\n  }\n};\n\nfunction updateHandle() {\n  autoUpdater.currentVersion = package_json.version;\n\n  autoUpdater.setFeedURL(DOWNLOAD_URL);\n\n  // 取消自动更新\n  autoUpdater.autoDownload = false;\n  \n  autoUpdater.on('checking-for-update', (info) => {\n    // 开始检查是否有新版本\n    // 可以在这里提醒用户正在查找新版本\n  })\n\n  autoUpdater.on('update-available', (info) => {\n    // 检查到有新版本\n    // 提醒用户已经找到了新版本\n    console.log(info)\n    mainWindow.webContents.send('updateAvailable', info)\n  })\n  \n  autoUpdater.on('update-not-available', (info) => {\n    // 检查到无新版本\n    // 提醒用户当前版本已经是最新版，无需更新\n  })\n\n  autoUpdater.on('download-progress', function (progressObj) {\n    // 更新进度条\n    mainWindow.webContents.send('downloadProgress', progressObj)\n  })\n  \n  autoUpdater.on('error', (err) => {\n    // 自动升级遇到错误\n  })\n  \n  autoUpdater.on('update-downloaded', (ev, releaseNotes, releaseName) => {\n    // 自动升级下载完成\n    // 可以询问用户是否重启应用更新，用户如果同意就可以执行 autoUpdater.quitAndInstall()\n    mainWindow.webContents.send('isUpdateNow')\n  })\n}\n\nipcMain.on(\"checkForUpdate\",() => {\n  console.log(autoUpdater.currentVersion)\n  autoUpdater.currentVersion = package_json.version;\n  //执行自动更新检查\n  autoUpdater.checkForUpdates();\n})\n\nipcMain.on(\"downloadUpdate\",() => {\n  try {\n    // 更新前删除本地更新包\n    deleteFile(autoUpdater.app.baseCachePath)\n  }catch {\n    \n  }\n  //执行自动更新检查\n  autoUpdater.downloadUpdate();\n})\n\nipcMain.on(\"quitAndInstall\",() => {\n  //执行自动更新检查\n  autoUpdater.quitAndInstall();\n})\n```\n\n## 最终效果\n\n![preview](https://user-images.githubusercontent.com/70128222/194988621-0040f2df-fa6c-45b7-adfe-98fe6a639bc9.gif)\n","slug":"Electron自动更新or手动触发更新","published":1,"updated":"2022-11-07T06:47:31.862Z","_id":"cla6che5m0002ys77bkto2tmx","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>我们用Electron开发了桌面应用, 项目同时也在不断更新迭代。我们希望只要发布了最新的版本，用户就能够收到更新提示从而进行升级。调研了市面上的实现方式后决定采取<a href=\"https://www.npmjs.com/package/electron-updater\">electron-updater</a>插件来实现更新功能。<a href=\"https://www.npmjs.com/package/electron-updater\">electron-updater</a>只需要简单的文件托管，不需要专用的服务器就能实现更新。</p>\n<h2 id=\"开始\"><a href=\"#开始\" class=\"headerlink\" title=\"开始\"></a>开始</h2><p>我们先用脚手架新建一个空项目(vue)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue create electron-vue-demo // 新建项目</span><br><span class=\"line\">vue add electron-builder // 安装electron v11.0.0</span><br><span class=\"line\">npm run electron:serve // 运行项目</span><br><span class=\"line\">npm i electron-updater // 安装electron-updater</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>publish 发布地址</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;build&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;productName&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;demo&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;appId&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;demo.fspace.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;directories&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;output&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;release&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;publish&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;provider&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;generic&quot;</span><span class=\"punctuation\">,</span>  <span class=\"comment\">// 服务器提供商 也可以是GitHub等等</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;url&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http://114.115.142.127:8989/download/&quot;</span><span class=\"punctuation\">,</span> <span class=\"comment\">// 更新文件存放位置</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;channel&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;latest&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;useMultipleRangeRequest&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>如果是vue-cli-plugin-electron-builder打包则会报错如下:<br><span style=\"display:block;color:red;\"><br>    Question||’build’ in the application package.json is not supported since 3.0<br></span><br>因为3.0后不支持json的方式, 需要移除package.json “build” </p>\n<p><span style=\"display:block;color:green;\">vue.config.js </span>添加builderOptions<br>后续需要在vue中使用ipcRenderer(主进程与渲染进程通信)<br>所以需要设置<br>//  nodeIntegration: true</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports = <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">\t...</span><br><span class=\"line\">  pluginOptions<span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    electronBuilder<span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    \tnodeIntegration<span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span> <span class=\"comment\">// ipcRenderer</span></span><br><span class=\"line\">      builderOptions<span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        productName<span class=\"punctuation\">:</span> <span class=\"string\">&quot;demo&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        appId<span class=\"punctuation\">:</span> <span class=\"string\">&quot;demo.fspace.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        directories<span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;output&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;release&quot;</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        publish<span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">          <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;provider&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;generic&quot;</span><span class=\"punctuation\">,</span>  <span class=\"comment\">// 服务器提供商 也可以是GitHub等等</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;url&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http://localhost:3006/&quot;</span><span class=\"punctuation\">,</span> <span class=\"comment\">// 更新文件存放位置</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;channel&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;latest&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;useMultipleRangeRequest&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span></span><br><span class=\"line\">          <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">        <span class=\"punctuation\">]</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><span style=\"display:block;color:green;\">background.js </span><br>初始化 autoUpdater</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&#x27;use strict&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; app, protocol, <span class=\"title class_\">BrowserWindow</span>, ipcMain &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createProtocol &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue-cli-plugin-electron-builder/lib&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> installExtension, &#123; <span class=\"variable constant_\">VUEJS_DEVTOOLS</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron-devtools-installer&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> path <span class=\"keyword\">from</span> <span class=\"string\">&#x27;path&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; autoUpdater &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;electron-updater&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> isDevelopment = process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> !== <span class=\"string\">&#x27;production&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">DOWNLOAD_URL</span> = <span class=\"string\">&#x27;http://localhost:3006/&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> package_json = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../package.json&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> mainWindow = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Scheme must be registered before the app is ready</span></span><br><span class=\"line\">protocol.<span class=\"title function_\">registerSchemesAsPrivileged</span>([</span><br><span class=\"line\">  &#123; <span class=\"attr\">scheme</span>: <span class=\"string\">&#x27;app&#x27;</span>, <span class=\"attr\">privileges</span>: &#123; <span class=\"attr\">secure</span>: <span class=\"literal\">true</span>, <span class=\"attr\">standard</span>: <span class=\"literal\">true</span> &#125; &#125;</span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">createWindow</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// Create the browser window.</span></span><br><span class=\"line\">  mainWindow = <span class=\"keyword\">new</span> <span class=\"title class_\">BrowserWindow</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">width</span>: <span class=\"number\">800</span>,</span><br><span class=\"line\">    <span class=\"attr\">height</span>: <span class=\"number\">600</span>,</span><br><span class=\"line\">    <span class=\"attr\">webPreferences</span>: &#123;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">// Use pluginOptions.nodeIntegration, leave this alone</span></span><br><span class=\"line\">      <span class=\"comment\">// See nklayman.github.io/vue-cli-plugin-electron-builder/guide/security.html#node-integration for more info</span></span><br><span class=\"line\">      <span class=\"attr\">nodeIntegration</span>: process.<span class=\"property\">env</span>.<span class=\"property\">ELECTRON_NODE_INTEGRATION</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Load the url of the dev server if in development mode</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> mainWindow.<span class=\"title function_\">loadURL</span>(process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) mainWindow.<span class=\"property\">webContents</span>.<span class=\"title function_\">openDevTools</span>()</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">createProtocol</span>(<span class=\"string\">&#x27;app&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\">// Load the index.html when not in development</span></span><br><span class=\"line\">    mainWindow.<span class=\"title function_\">loadURL</span>(<span class=\"string\">&#x27;app://./index.html&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Quit when all windows are closed.</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;window-all-closed&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// On macOS it is common for applications and their menu bar</span></span><br><span class=\"line\">  <span class=\"comment\">// to stay active until the user quits explicitly with Cmd + Q</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> !== <span class=\"string\">&#x27;darwin&#x27;</span>) &#123;</span><br><span class=\"line\">    app.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;activate&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// On macOS it&#x27;s common to re-create a window in the app when the</span></span><br><span class=\"line\">  <span class=\"comment\">// dock icon is clicked and there are no other windows open.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"title class_\">BrowserWindow</span>.<span class=\"title function_\">getAllWindows</span>().<span class=\"property\">length</span> === <span class=\"number\">0</span>) <span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This method will be called when Electron has finished</span></span><br><span class=\"line\"><span class=\"comment\">// initialization and is ready to create browser windows.</span></span><br><span class=\"line\"><span class=\"comment\">// Some APIs can only be used after this event occurs.</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;ready&#x27;</span>, <span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (isDevelopment &amp;&amp; !process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Install Vue Devtools</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">await</span> <span class=\"title function_\">installExtension</span>(<span class=\"variable constant_\">VUEJS_DEVTOOLS</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;Vue Devtools failed to install:&#x27;</span>, e.<span class=\"title function_\">toString</span>())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;ready&#x27;</span>)</span><br><span class=\"line\">  <span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">  <span class=\"title function_\">updateHandle</span>();</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Exit cleanly on request from parent process in development mode.</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (isDevelopment) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> === <span class=\"string\">&#x27;win32&#x27;</span>) &#123;</span><br><span class=\"line\">    process.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (data === <span class=\"string\">&#x27;graceful-exit&#x27;</span>) &#123;</span><br><span class=\"line\">        app.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    process.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;SIGTERM&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      app.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">updateHandle</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  autoUpdater.<span class=\"property\">currentVersion</span> = package_json.<span class=\"property\">version</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">setFeedURL</span>(<span class=\"variable constant_\">DOWNLOAD_URL</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 取消自动更新</span></span><br><span class=\"line\">  autoUpdater.<span class=\"property\">autoDownload</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;checking-for-update&#x27;</span>, <span class=\"function\">(<span class=\"params\">info</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 开始检查是否有新版本</span></span><br><span class=\"line\">    <span class=\"comment\">// 可以在这里提醒用户正在查找新版本</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;checking-for-update&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-available&#x27;</span>, <span class=\"function\">(<span class=\"params\">info</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 检查到有新版本</span></span><br><span class=\"line\">    <span class=\"comment\">// 提醒用户已经找到了新版本</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;检查到有新版本&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  </span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;error&#x27;</span>, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 自动升级遇到错误</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"打包测试\"><a href=\"#打包测试\" class=\"headerlink\" title=\"打包测试\"></a>打包测试</h2><p><span style=\"display:block;color:green;\">package.json</span></p>\n<p>版本号 1.0.1</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;electron-vue-demo&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.0.1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>执行打包</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue-cli-service electron:build</span><br></pre></td></tr></table></figure>\n\n<p>打包后release目录 (当前为mac打包)</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── release</span><br><span class=\"line\">│   ├── demo-1.0.1-mac.zip</span><br><span class=\"line\">│   ├── demo-1.0.1.dmg \t\t\t\t\t // 安装文件</span><br><span class=\"line\">│   ├── demo-1.0.1.dmg.blockmap // 用于差异更新, mac好像无效 </span><br><span class=\"line\">│   ├── latest-mac.yml \t\t\t\t\t// 更新相关文件</span><br><span class=\"line\">│   └── mac</span><br><span class=\"line\">├── ...</span><br><span class=\"line\">└── package.json</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"搭建静态服务\"><a href=\"#搭建静态服务\" class=\"headerlink\" title=\"搭建静态服务\"></a>搭建静态服务</h2><p>这里使用koa koa-static 配置静态目录</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── server</span><br><span class=\"line\">│   ├── public  // 存放更新文件\t\t\t</span><br><span class=\"line\">│   └── server.js \t</span><br><span class=\"line\">├── ...</span><br><span class=\"line\">└── package.json</span><br></pre></td></tr></table></figure>\n\n<p>我们把demo-1.0.1-mac.zip / latest-mac.yml / 更新日志 放入更新目录public</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;V1.0.1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;content&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">  <span class=\"string\">&quot;-🎉  v1.0.1版本盛大发布。&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><span style=\"display:block;color:green;\">server.js</span></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> serve = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-static&#x27;</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">const</span> main = <span class=\"title function_\">serve</span>(path.<span class=\"title function_\">join</span>(__dirname+<span class=\"string\">&#x27;/public&#x27;</span>));</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(main);</span><br><span class=\"line\"> </span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3006</span>,<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;监听3006端口&quot;</span>)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>回到项目</p>\n<p><span style=\"display:block;color:green;\">background.js</span></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; ipcMain &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ipcMain 监听渲染进程checkForUpdate 事件</span></span><br><span class=\"line\">ipcMain.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;checkForUpdate&quot;</span>,<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  autoUpdater.<span class=\"property\">currentVersion</span> = package_json.<span class=\"property\">version</span>;</span><br><span class=\"line\">  <span class=\"comment\">//执行更新检查</span></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">checkForUpdates</span>();</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">updateHandle</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t...</span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-available&#x27;</span>, <span class=\"function\">(<span class=\"params\">info</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 检查到有新版本</span></span><br><span class=\"line\">    <span class=\"comment\">// 提醒用户已经找到了新版本</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;检查到有新版本&#x27;</span>, info)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><span style=\"display:block;color:green;\">app.vue</span></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div id=&quot;app&quot;&gt;</span><br><span class=\"line\">    &lt;button @click=&quot;checkForUpdates&quot;&gt;检查更新&lt;/button&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">import &#123; ipcRenderer &#125; from &quot;electron&quot;;</span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">  name: &#x27;App&#x27;,</span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">    checkForUpdates() &#123;</span><br><span class=\"line\">      // 通知主进程检查更新</span><br><span class=\"line\">      ipcRenderer.send(&#x27;checkForUpdate&#x27;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">#app &#123;</span><br><span class=\"line\">  font-family: Avenir, Helvetica, Arial, sans-serif;</span><br><span class=\"line\">  -webkit-font-smoothing: antialiased;</span><br><span class=\"line\">  -moz-osx-font-smoothing: grayscale;</span><br><span class=\"line\">  text-align: center;</span><br><span class=\"line\">  color: #2c3e50;</span><br><span class=\"line\">  margin-top: 60px;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br></pre></td></tr></table></figure>\n\n<p>点击按钮, 控制台打印如下</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">检查到有新版本 <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  version<span class=\"punctuation\">:</span> &#x27;<span class=\"number\">1.0</span><span class=\"number\">.1</span>&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">  files<span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      url<span class=\"punctuation\">:</span> &#x27;demo<span class=\"number\">-1.0</span><span class=\"number\">.1</span>-mac.zip&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">      sha512<span class=\"punctuation\">:</span> &#x27;PJeIr6HilOlNrcR8HEimQQuJHjEiK7x2PHhOGnmul5tTI2n0R7+<span class=\"number\">6</span>PP8S5j3+bwfZzSkjBWWWYnlR8WNoQ17YBQ==&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">      size<span class=\"punctuation\">:</span> <span class=\"number\">77708593</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      blockMapSize<span class=\"punctuation\">:</span> <span class=\"number\">82077</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      url<span class=\"punctuation\">:</span> &#x27;demo<span class=\"number\">-1.0</span><span class=\"number\">.1</span>.dmg&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">      sha512<span class=\"punctuation\">:</span> &#x27;i++/bWJ7pxIkShS+WehKkP8rLMjbKtHvFV/aLmDDj8lEqeyKP8cnVpSSlNNbqOwcqbxSzR5t07QMIUIVf0AMYw==&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">      size<span class=\"punctuation\">:</span> <span class=\"number\">80015179</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  path<span class=\"punctuation\">:</span> &#x27;demo<span class=\"number\">-1.0</span><span class=\"number\">.1</span>-mac.zip&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">  sha512<span class=\"punctuation\">:</span> &#x27;PJeIr6HilOlNrcR8HEimQQuJHjEiK7x2PHhOGnmul5tTI2n0R7+<span class=\"number\">6</span>PP8S5j3+bwfZzSkjBWWWYnlR8WNoQ17YBQ==&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">  releaseDate<span class=\"punctuation\">:</span> &#x27;<span class=\"number\">2021</span><span class=\"number\">-04</span><span class=\"number\">-21</span>T05<span class=\"punctuation\">:</span><span class=\"number\">38</span><span class=\"punctuation\">:</span><span class=\"number\">20.929</span>Z&#x27;</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>autoUpdater.downloadUpdate(); // 下载更新<br>autoUpdater.quitAndInstall(); // 执行推出安装更新<br>依次执行后实现了更新操作, 当然这对用户来说非常不友好，需要把更新流程交给用户去控制。</p>\n<p>autoUpdater给我们提供 download-progress(更新进度)、update-downloaded(更新完成) 监听。</p>\n<p><span style=\"display:block;color:green;\">app.vue</span></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div id=&quot;app&quot;&gt;</span><br><span class=\"line\">    &lt;a-button @click=&quot;checkForUpdates&quot;&gt;检查更新&lt;/a-button&gt;</span><br><span class=\"line\">    &lt;!-- 更新提示框 --&gt;</span><br><span class=\"line\">    &lt;div class=&quot;main-container__upgrade-panel&quot; v-if=&quot;show&quot;&gt;</span><br><span class=\"line\">      &lt;div class=&quot;main-container__upgrade-panel-title&quot;&gt;</span><br><span class=\"line\">        &#123;&#123;`发现新版本$&#123;versionInfo.version&#125;`&#125;&#125;</span><br><span class=\"line\">        &lt;span @click=&quot;() =&gt; &#123; show = !show &#125;&quot;&gt;&lt;a-tooltip title=&quot;最小化&quot; placement=&quot;top&quot;&gt;&lt;a-icon type=&quot;down-circle&quot; /&gt;&lt;/a-tooltip&gt;&lt;/span&gt;</span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">      &lt;div class=&quot;main-container__upgrade-panel-body&quot;&gt;</span><br><span class=\"line\">        &lt;div class=&quot;main-container__pd1t&quot;&gt;</span><br><span class=\"line\">          更新日志:</span><br><span class=\"line\">          &lt;/div&gt;</span><br><span class=\"line\">          &lt;div v-for=&quot;(item, index) in versionInfo.content&quot; :key=&quot;index&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/div&gt;</span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">      &lt;div class=&quot;main-container__upgrade-panel-footer&quot;&gt;</span><br><span class=\"line\">        &lt;div style=&quot;width: 305px;&quot;&gt;</span><br><span class=\"line\">          &lt;a-progress</span><br><span class=\"line\">            :stroke-color=&quot;&#123;</span><br><span class=\"line\">              from: &#x27;#108ee9&#x27;,</span><br><span class=\"line\">              to: &#x27;#87d068&#x27;,</span><br><span class=\"line\">            &#125;&quot;</span><br><span class=\"line\">            :percent=&quot;progress.percent&quot;</span><br><span class=\"line\">            status=&quot;active&quot;</span><br><span class=\"line\">          /&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">        &lt;a-button style=&quot;margin-right: 10px;&quot; v-if=&quot;canInstall&quot; type=&quot;primary&quot; @click=&quot;() =&gt; icpSend(&#x27;quitAndInstall&#x27;)&quot;&gt;安装&lt;/a-button&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;a-button style=&quot;margin-right: 10px;&quot; v-else type=&quot;primary&quot; :loading=&quot;loading&quot;  @click=&quot;() =&gt; &#123; loading = true, icpSend(&#x27;downloadUpdate&#x27;) &#125;&quot;&gt; &lt;a-icon v-if=&quot;!loading&quot; type=&quot;down-square&quot; /&gt; 更新&lt;/a-button&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;a-button :disabled=&quot;progress.percent &gt; 0&quot; type=&quot;dashed&quot; @click=&quot;() =&gt; &#123; show = !show &#125;&quot;&gt;下次再说&lt;/a-button&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">import &#123; ipcRenderer &#125; from &quot;electron&quot;;</span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">  name: &#x27;App&#x27;,</span><br><span class=\"line\">  data() &#123;</span><br><span class=\"line\">    return &#123;</span><br><span class=\"line\">      DOWNLOAD_URL: &#x27;http://localhost:3006/&#x27;,</span><br><span class=\"line\">      canInstall: false,</span><br><span class=\"line\">      show: false,</span><br><span class=\"line\">      progress: &#123;</span><br><span class=\"line\">        bytesPerSecond: 0,</span><br><span class=\"line\">        delta: 0,</span><br><span class=\"line\">        percent: 0,</span><br><span class=\"line\">        total: 0,</span><br><span class=\"line\">        transferred: 0</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      loading: false,</span><br><span class=\"line\">      versionInfo: &#123;</span><br><span class=\"line\">        version: &#x27;&#x27;,</span><br><span class=\"line\">        content: [</span><br><span class=\"line\">          &#x27;123&#x27;,</span><br><span class=\"line\">          &#x27;456&#x27;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  created() &#123;</span><br><span class=\"line\">    // 版本有更新时提示</span><br><span class=\"line\">    ipcRenderer.on(&quot;updateAvailable&quot;, async (event, info) =&gt; &#123;</span><br><span class=\"line\">      const verInfo = await this.getVersionInfo(info);</span><br><span class=\"line\">      if (verInfo) &#123;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">          this.versionInfo.version = JSON.parse(verInfo).version;</span><br><span class=\"line\">          this.versionInfo.content = JSON.parse(verInfo).content;</span><br><span class=\"line\">        &#125; catch (e) &#123;</span><br><span class=\"line\">          console.log(e)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        this.show = true;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    // 下载进度条</span><br><span class=\"line\">    ipcRenderer.on(&quot;downloadProgress&quot;, (event, progressObj) =&gt; &#123;</span><br><span class=\"line\">      progressObj.percent = Number(progressObj.percent.toFixed(1));</span><br><span class=\"line\">      this.progress = &#123;</span><br><span class=\"line\">        ...progressObj</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    ipcRenderer.on(&quot;isUpdateNow&quot;, () =&gt; &#123;</span><br><span class=\"line\">      this.canInstall = true;</span><br><span class=\"line\">      this.show = true;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">    async getVersionInfo(info) &#123;</span><br><span class=\"line\">      return new Promise((resolve) =&gt; &#123;</span><br><span class=\"line\">        let xhr = new XMLHttpRequest();</span><br><span class=\"line\">        xhr.open(&#x27;get&#x27;, this.DOWNLOAD_URL + info.version + &#x27;.json&#x27;, true);</span><br><span class=\"line\">        xhr.send(null);</span><br><span class=\"line\">        xhr.onreadystatechange = function () &#123;</span><br><span class=\"line\">          </span><br><span class=\"line\">          if (xhr.readyState == 4) &#123;</span><br><span class=\"line\">            if (xhr.status == 200) &#123;</span><br><span class=\"line\">              </span><br><span class=\"line\">              resolve(xhr.responseText)</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">              resolve(null)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    icpSend(name) &#123;</span><br><span class=\"line\">      ipcRenderer.send(name);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    checkForUpdates() &#123;</span><br><span class=\"line\">      ipcRenderer.send(&#x27;checkForUpdate&#x27;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class=\"line\">#app &#123;</span><br><span class=\"line\">  font-family: Avenir, Helvetica, Arial, sans-serif;</span><br><span class=\"line\">  -webkit-font-smoothing: antialiased;</span><br><span class=\"line\">  -moz-osx-font-smoothing: grayscale;</span><br><span class=\"line\">  color: #2c3e50;</span><br><span class=\"line\">  margin-top: 60px;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.main-container &#123;</span><br><span class=\"line\">  width: 100%;</span><br><span class=\"line\">  position: relative;</span><br><span class=\"line\">  // display: flex;</span><br><span class=\"line\">  background: #f7f7f7;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;__drag &#123;</span><br><span class=\"line\">    position: absolute;</span><br><span class=\"line\">    width: calc(100% - 100px);</span><br><span class=\"line\">    height: 25px;</span><br><span class=\"line\">    -webkit-app-region: drag;</span><br><span class=\"line\">    .overlay &#123;</span><br><span class=\"line\">      pointer-events: none;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;__controls &#123;</span><br><span class=\"line\">    position: absolute;</span><br><span class=\"line\">    right: 0;</span><br><span class=\"line\">    -webkit-app-region: no-drag;</span><br><span class=\"line\">    top: 0;</span><br><span class=\"line\">    z-index: 200;</span><br><span class=\"line\">    border-radius: 0 0 3px 3px;</span><br><span class=\"line\">    padding: 0;</span><br><span class=\"line\">    background: #bfbfbf21;</span><br><span class=\"line\">    :hover &#123;</span><br><span class=\"line\">      color: white;</span><br><span class=\"line\">      background: gray;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    :nth-child(3):hover&#123;</span><br><span class=\"line\">      background-color: red;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;-item &#123;</span><br><span class=\"line\">      display: inline-block;</span><br><span class=\"line\">      padding: 5px 10px;</span><br><span class=\"line\">      color: #ccc;</span><br><span class=\"line\">      font-size: 12px;</span><br><span class=\"line\">      -webkit-app-region: no-drag;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;__upgrade-panel &#123;</span><br><span class=\"line\">    position: fixed;</span><br><span class=\"line\">    z-index: 9999;</span><br><span class=\"line\">    right: 10px;</span><br><span class=\"line\">    bottom: 25px;</span><br><span class=\"line\">    width: 340px;</span><br><span class=\"line\">    background-color: #34373c;</span><br><span class=\"line\">    color: white;</span><br><span class=\"line\">    border-radius: 3px;</span><br><span class=\"line\">    font-size: 12px;</span><br><span class=\"line\">    box-shadow: 0px 0px 5px 5px rgba(133,133,133,0.25);</span><br><span class=\"line\"></span><br><span class=\"line\">    ::-webkit-scrollbar &#123;</span><br><span class=\"line\">      display: none; /* Chrome Safari */</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;-title &#123;</span><br><span class=\"line\">      padding: 10px 15px;</span><br><span class=\"line\">      width: 100%;</span><br><span class=\"line\">      height: 40px;</span><br><span class=\"line\">      border-bottom: 1px solid white;</span><br><span class=\"line\"></span><br><span class=\"line\">      span &#123;</span><br><span class=\"line\">        position: absolute;</span><br><span class=\"line\">        font-size: 14px;</span><br><span class=\"line\">        right: 10px;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      span:hover &#123;</span><br><span class=\"line\">        color:#FFFFFF;</span><br><span class=\"line\">        background-color:#6dd214;</span><br><span class=\"line\">        text-shadow:none;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;-body &#123;</span><br><span class=\"line\">      overflow-y: auto;</span><br><span class=\"line\">      padding: 10px 15px;</span><br><span class=\"line\">      max-height: 100px;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &amp;-footer &#123;</span><br><span class=\"line\">      padding-left: 10px;</span><br><span class=\"line\">      padding-bottom: 10px;</span><br><span class=\"line\"></span><br><span class=\"line\">      a-button &#123;</span><br><span class=\"line\">        margin-right: 15px;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;__pd1t &#123;</span><br><span class=\"line\">    padding-top: 5px;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.ant-progress-text &#123;</span><br><span class=\"line\">  color: white !important;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><span style=\"display:block;color:green;\">background.js</span></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&#x27;use strict&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; app, protocol, <span class=\"title class_\">BrowserWindow</span>, ipcMain &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createProtocol &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue-cli-plugin-electron-builder/lib&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> installExtension, &#123; <span class=\"variable constant_\">VUEJS_DEVTOOLS</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron-devtools-installer&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; autoUpdater &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;electron-updater&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> isDevelopment = process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> !== <span class=\"string\">&#x27;production&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">DOWNLOAD_URL</span> = <span class=\"string\">&#x27;http://localhost:3006/&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> package_json = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../package.json&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> mainWindow = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Scheme must be registered before the app is ready</span></span><br><span class=\"line\">protocol.<span class=\"title function_\">registerSchemesAsPrivileged</span>([</span><br><span class=\"line\">  &#123; <span class=\"attr\">scheme</span>: <span class=\"string\">&#x27;app&#x27;</span>, <span class=\"attr\">privileges</span>: &#123; <span class=\"attr\">secure</span>: <span class=\"literal\">true</span>, <span class=\"attr\">standard</span>: <span class=\"literal\">true</span> &#125; &#125;</span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">createWindow</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// Create the browser window.</span></span><br><span class=\"line\">  mainWindow = <span class=\"keyword\">new</span> <span class=\"title class_\">BrowserWindow</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">width</span>: <span class=\"number\">800</span>,</span><br><span class=\"line\">    <span class=\"attr\">height</span>: <span class=\"number\">600</span>,</span><br><span class=\"line\">    <span class=\"attr\">webPreferences</span>: &#123;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">// Use pluginOptions.nodeIntegration, leave this alone</span></span><br><span class=\"line\">      <span class=\"comment\">// See nklayman.github.io/vue-cli-plugin-electron-builder/guide/security.html#node-integration for more info</span></span><br><span class=\"line\">      <span class=\"attr\">nodeIntegration</span>: process.<span class=\"property\">env</span>.<span class=\"property\">ELECTRON_NODE_INTEGRATION</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Load the url of the dev server if in development mode</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> mainWindow.<span class=\"title function_\">loadURL</span>(process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) mainWindow.<span class=\"property\">webContents</span>.<span class=\"title function_\">openDevTools</span>()</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">createProtocol</span>(<span class=\"string\">&#x27;app&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\">// Load the index.html when not in development</span></span><br><span class=\"line\">    mainWindow.<span class=\"title function_\">loadURL</span>(<span class=\"string\">&#x27;app://./index.html&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Quit when all windows are closed.</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;window-all-closed&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// On macOS it is common for applications and their menu bar</span></span><br><span class=\"line\">  <span class=\"comment\">// to stay active until the user quits explicitly with Cmd + Q</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> !== <span class=\"string\">&#x27;darwin&#x27;</span>) &#123;</span><br><span class=\"line\">    app.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;activate&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// On macOS it&#x27;s common to re-create a window in the app when the</span></span><br><span class=\"line\">  <span class=\"comment\">// dock icon is clicked and there are no other windows open.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"title class_\">BrowserWindow</span>.<span class=\"title function_\">getAllWindows</span>().<span class=\"property\">length</span> === <span class=\"number\">0</span>) <span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This method will be called when Electron has finished</span></span><br><span class=\"line\"><span class=\"comment\">// initialization and is ready to create browser windows.</span></span><br><span class=\"line\"><span class=\"comment\">// Some APIs can only be used after this event occurs.</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;ready&#x27;</span>, <span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (isDevelopment &amp;&amp; !process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Install Vue Devtools</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">await</span> <span class=\"title function_\">installExtension</span>(<span class=\"variable constant_\">VUEJS_DEVTOOLS</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;Vue Devtools failed to install:&#x27;</span>, e.<span class=\"title function_\">toString</span>())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;ready&#x27;</span>)</span><br><span class=\"line\">  <span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">  <span class=\"title function_\">updateHandle</span>();</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Exit cleanly on request from parent process in development mode.</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (isDevelopment) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> === <span class=\"string\">&#x27;win32&#x27;</span>) &#123;</span><br><span class=\"line\">    process.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (data === <span class=\"string\">&#x27;graceful-exit&#x27;</span>) &#123;</span><br><span class=\"line\">        app.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    process.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;SIGTERM&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      app.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">deleteFile</span> = (<span class=\"params\">path</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> files = [];</span><br><span class=\"line\">  <span class=\"keyword\">if</span>( fs.<span class=\"title function_\">existsSync</span>(path) ) &#123;</span><br><span class=\"line\">      files = fs.<span class=\"title function_\">readdirSync</span>(path);</span><br><span class=\"line\">      files.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span>(<span class=\"params\">file</span>)&#123;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> curPath = path + <span class=\"string\">&quot;/&quot;</span> + file;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(fs.<span class=\"title function_\">statSync</span>(curPath).<span class=\"title function_\">isDirectory</span>()) &#123;</span><br><span class=\"line\">              <span class=\"title function_\">deleteFile</span>(curPath);</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">              fs.<span class=\"title function_\">unlinkSync</span>(curPath);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      fs.<span class=\"title function_\">rmdirSync</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">updateHandle</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  autoUpdater.<span class=\"property\">currentVersion</span> = package_json.<span class=\"property\">version</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">setFeedURL</span>(<span class=\"variable constant_\">DOWNLOAD_URL</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 取消自动更新</span></span><br><span class=\"line\">  autoUpdater.<span class=\"property\">autoDownload</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;checking-for-update&#x27;</span>, <span class=\"function\">(<span class=\"params\">info</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 开始检查是否有新版本</span></span><br><span class=\"line\">    <span class=\"comment\">// 可以在这里提醒用户正在查找新版本</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-available&#x27;</span>, <span class=\"function\">(<span class=\"params\">info</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 检查到有新版本</span></span><br><span class=\"line\">    <span class=\"comment\">// 提醒用户已经找到了新版本</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(info)</span><br><span class=\"line\">    mainWindow.<span class=\"property\">webContents</span>.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;updateAvailable&#x27;</span>, info)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  </span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-not-available&#x27;</span>, <span class=\"function\">(<span class=\"params\">info</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 检查到无新版本</span></span><br><span class=\"line\">    <span class=\"comment\">// 提醒用户当前版本已经是最新版，无需更新</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;download-progress&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">progressObj</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 更新进度条</span></span><br><span class=\"line\">    mainWindow.<span class=\"property\">webContents</span>.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;downloadProgress&#x27;</span>, progressObj)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  </span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;error&#x27;</span>, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 自动升级遇到错误</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  </span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-downloaded&#x27;</span>, <span class=\"function\">(<span class=\"params\">ev, releaseNotes, releaseName</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 自动升级下载完成</span></span><br><span class=\"line\">    <span class=\"comment\">// 可以询问用户是否重启应用更新，用户如果同意就可以执行 autoUpdater.quitAndInstall()</span></span><br><span class=\"line\">    mainWindow.<span class=\"property\">webContents</span>.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;isUpdateNow&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">ipcMain.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;checkForUpdate&quot;</span>,<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(autoUpdater.<span class=\"property\">currentVersion</span>)</span><br><span class=\"line\">  autoUpdater.<span class=\"property\">currentVersion</span> = package_json.<span class=\"property\">version</span>;</span><br><span class=\"line\">  <span class=\"comment\">//执行自动更新检查</span></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">checkForUpdates</span>();</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">ipcMain.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;downloadUpdate&quot;</span>,<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 更新前删除本地更新包</span></span><br><span class=\"line\">    <span class=\"title function_\">deleteFile</span>(autoUpdater.<span class=\"property\">app</span>.<span class=\"property\">baseCachePath</span>)</span><br><span class=\"line\">  &#125;<span class=\"keyword\">catch</span> &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//执行自动更新检查</span></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">downloadUpdate</span>();</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">ipcMain.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;quitAndInstall&quot;</span>,<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">//执行自动更新检查</span></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">quitAndInstall</span>();</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h2><p><img src=\"https://user-images.githubusercontent.com/70128222/194988621-0040f2df-fa6c-45b7-adfe-98fe6a639bc9.gif\" alt=\"preview\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>我们用Electron开发了桌面应用, 项目同时也在不断更新迭代。我们希望只要发布了最新的版本，用户就能够收到更新提示从而进行升级。调研了市面上的实现方式后决定采取<a href=\"https://www.npmjs.com/package/electron-updater\">electron-updater</a>插件来实现更新功能。<a href=\"https://www.npmjs.com/package/electron-updater\">electron-updater</a>只需要简单的文件托管，不需要专用的服务器就能实现更新。</p>\n<h2 id=\"开始\"><a href=\"#开始\" class=\"headerlink\" title=\"开始\"></a>开始</h2><p>我们先用脚手架新建一个空项目(vue)</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue create electron-vue-demo // 新建项目</span><br><span class=\"line\">vue add electron-builder // 安装electron v11.0.0</span><br><span class=\"line\">npm run electron:serve // 运行项目</span><br><span class=\"line\">npm i electron-updater // 安装electron-updater</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>publish 发布地址</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;build&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;productName&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;demo&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;appId&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;demo.fspace.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;directories&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      <span class=\"attr\">&quot;output&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;release&quot;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"attr\">&quot;publish&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;provider&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;generic&quot;</span><span class=\"punctuation\">,</span>  <span class=\"comment\">// 服务器提供商 也可以是GitHub等等</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;url&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http://114.115.142.127:8989/download/&quot;</span><span class=\"punctuation\">,</span> <span class=\"comment\">// 更新文件存放位置</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;channel&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;latest&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        <span class=\"attr\">&quot;useMultipleRangeRequest&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>如果是vue-cli-plugin-electron-builder打包则会报错如下:<br><span style=\"display:block;color:red;\"><br>    Question||’build’ in the application package.json is not supported since 3.0<br></span><br>因为3.0后不支持json的方式, 需要移除package.json “build” </p>\n<p><span style=\"display:block;color:green;\">vue.config.js </span>添加builderOptions<br>后续需要在vue中使用ipcRenderer(主进程与渲染进程通信)<br>所以需要设置<br>//  nodeIntegration: true</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">module.exports = <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">\t...</span><br><span class=\"line\">  pluginOptions<span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    electronBuilder<span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">    \tnodeIntegration<span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">true</span></span><span class=\"punctuation\">,</span> <span class=\"comment\">// ipcRenderer</span></span><br><span class=\"line\">      builderOptions<span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">        productName<span class=\"punctuation\">:</span> <span class=\"string\">&quot;demo&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        appId<span class=\"punctuation\">:</span> <span class=\"string\">&quot;demo.fspace.com&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        directories<span class=\"punctuation\">:</span> <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">          <span class=\"attr\">&quot;output&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;release&quot;</span></span><br><span class=\"line\">        <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">        publish<span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">          <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;provider&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;generic&quot;</span><span class=\"punctuation\">,</span>  <span class=\"comment\">// 服务器提供商 也可以是GitHub等等</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;url&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;http://localhost:3006/&quot;</span><span class=\"punctuation\">,</span> <span class=\"comment\">// 更新文件存放位置</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;channel&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;latest&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">            <span class=\"attr\">&quot;useMultipleRangeRequest&quot;</span><span class=\"punctuation\">:</span> <span class=\"literal\"><span class=\"keyword\">false</span></span></span><br><span class=\"line\">          <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">        <span class=\"punctuation\">]</span></span><br><span class=\"line\">      <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><span style=\"display:block;color:green;\">background.js </span><br>初始化 autoUpdater</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&#x27;use strict&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; app, protocol, <span class=\"title class_\">BrowserWindow</span>, ipcMain &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createProtocol &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue-cli-plugin-electron-builder/lib&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> installExtension, &#123; <span class=\"variable constant_\">VUEJS_DEVTOOLS</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron-devtools-installer&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> * <span class=\"keyword\">as</span> path <span class=\"keyword\">from</span> <span class=\"string\">&#x27;path&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; autoUpdater &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;electron-updater&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> isDevelopment = process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> !== <span class=\"string\">&#x27;production&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">DOWNLOAD_URL</span> = <span class=\"string\">&#x27;http://localhost:3006/&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> package_json = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../package.json&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> mainWindow = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Scheme must be registered before the app is ready</span></span><br><span class=\"line\">protocol.<span class=\"title function_\">registerSchemesAsPrivileged</span>([</span><br><span class=\"line\">  &#123; <span class=\"attr\">scheme</span>: <span class=\"string\">&#x27;app&#x27;</span>, <span class=\"attr\">privileges</span>: &#123; <span class=\"attr\">secure</span>: <span class=\"literal\">true</span>, <span class=\"attr\">standard</span>: <span class=\"literal\">true</span> &#125; &#125;</span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">createWindow</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// Create the browser window.</span></span><br><span class=\"line\">  mainWindow = <span class=\"keyword\">new</span> <span class=\"title class_\">BrowserWindow</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">width</span>: <span class=\"number\">800</span>,</span><br><span class=\"line\">    <span class=\"attr\">height</span>: <span class=\"number\">600</span>,</span><br><span class=\"line\">    <span class=\"attr\">webPreferences</span>: &#123;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">// Use pluginOptions.nodeIntegration, leave this alone</span></span><br><span class=\"line\">      <span class=\"comment\">// See nklayman.github.io/vue-cli-plugin-electron-builder/guide/security.html#node-integration for more info</span></span><br><span class=\"line\">      <span class=\"attr\">nodeIntegration</span>: process.<span class=\"property\">env</span>.<span class=\"property\">ELECTRON_NODE_INTEGRATION</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Load the url of the dev server if in development mode</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> mainWindow.<span class=\"title function_\">loadURL</span>(process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) mainWindow.<span class=\"property\">webContents</span>.<span class=\"title function_\">openDevTools</span>()</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">createProtocol</span>(<span class=\"string\">&#x27;app&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\">// Load the index.html when not in development</span></span><br><span class=\"line\">    mainWindow.<span class=\"title function_\">loadURL</span>(<span class=\"string\">&#x27;app://./index.html&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Quit when all windows are closed.</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;window-all-closed&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// On macOS it is common for applications and their menu bar</span></span><br><span class=\"line\">  <span class=\"comment\">// to stay active until the user quits explicitly with Cmd + Q</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> !== <span class=\"string\">&#x27;darwin&#x27;</span>) &#123;</span><br><span class=\"line\">    app.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;activate&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// On macOS it&#x27;s common to re-create a window in the app when the</span></span><br><span class=\"line\">  <span class=\"comment\">// dock icon is clicked and there are no other windows open.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"title class_\">BrowserWindow</span>.<span class=\"title function_\">getAllWindows</span>().<span class=\"property\">length</span> === <span class=\"number\">0</span>) <span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This method will be called when Electron has finished</span></span><br><span class=\"line\"><span class=\"comment\">// initialization and is ready to create browser windows.</span></span><br><span class=\"line\"><span class=\"comment\">// Some APIs can only be used after this event occurs.</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;ready&#x27;</span>, <span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (isDevelopment &amp;&amp; !process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Install Vue Devtools</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">await</span> <span class=\"title function_\">installExtension</span>(<span class=\"variable constant_\">VUEJS_DEVTOOLS</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;Vue Devtools failed to install:&#x27;</span>, e.<span class=\"title function_\">toString</span>())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;ready&#x27;</span>)</span><br><span class=\"line\">  <span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">  <span class=\"title function_\">updateHandle</span>();</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Exit cleanly on request from parent process in development mode.</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (isDevelopment) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> === <span class=\"string\">&#x27;win32&#x27;</span>) &#123;</span><br><span class=\"line\">    process.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (data === <span class=\"string\">&#x27;graceful-exit&#x27;</span>) &#123;</span><br><span class=\"line\">        app.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    process.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;SIGTERM&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      app.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">updateHandle</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  autoUpdater.<span class=\"property\">currentVersion</span> = package_json.<span class=\"property\">version</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">setFeedURL</span>(<span class=\"variable constant_\">DOWNLOAD_URL</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 取消自动更新</span></span><br><span class=\"line\">  autoUpdater.<span class=\"property\">autoDownload</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;checking-for-update&#x27;</span>, <span class=\"function\">(<span class=\"params\">info</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 开始检查是否有新版本</span></span><br><span class=\"line\">    <span class=\"comment\">// 可以在这里提醒用户正在查找新版本</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;checking-for-update&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-available&#x27;</span>, <span class=\"function\">(<span class=\"params\">info</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 检查到有新版本</span></span><br><span class=\"line\">    <span class=\"comment\">// 提醒用户已经找到了新版本</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;检查到有新版本&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  </span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;error&#x27;</span>, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 自动升级遇到错误</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n\n<h2 id=\"打包测试\"><a href=\"#打包测试\" class=\"headerlink\" title=\"打包测试\"></a>打包测试</h2><p><span style=\"display:block;color:green;\">package.json</span></p>\n<p>版本号 1.0.1</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;name&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;electron-vue-demo&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;1.0.1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  ...</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>执行打包</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue-cli-service electron:build</span><br></pre></td></tr></table></figure>\n\n<p>打包后release目录 (当前为mac打包)</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── release</span><br><span class=\"line\">│   ├── demo-1.0.1-mac.zip</span><br><span class=\"line\">│   ├── demo-1.0.1.dmg \t\t\t\t\t // 安装文件</span><br><span class=\"line\">│   ├── demo-1.0.1.dmg.blockmap // 用于差异更新, mac好像无效 </span><br><span class=\"line\">│   ├── latest-mac.yml \t\t\t\t\t// 更新相关文件</span><br><span class=\"line\">│   └── mac</span><br><span class=\"line\">├── ...</span><br><span class=\"line\">└── package.json</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"搭建静态服务\"><a href=\"#搭建静态服务\" class=\"headerlink\" title=\"搭建静态服务\"></a>搭建静态服务</h2><p>这里使用koa koa-static 配置静态目录</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── server</span><br><span class=\"line\">│   ├── public  // 存放更新文件\t\t\t</span><br><span class=\"line\">│   └── server.js \t</span><br><span class=\"line\">├── ...</span><br><span class=\"line\">└── package.json</span><br></pre></td></tr></table></figure>\n\n<p>我们把demo-1.0.1-mac.zip / latest-mac.yml / 更新日志 放入更新目录public</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;version&quot;</span><span class=\"punctuation\">:</span> <span class=\"string\">&quot;V1.0.1&quot;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  <span class=\"attr\">&quot;content&quot;</span><span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">  <span class=\"string\">&quot;-🎉  v1.0.1版本盛大发布。&quot;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span></span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p><span style=\"display:block;color:green;\">server.js</span></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title class_\">Koa</span> = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"keyword\">new</span> <span class=\"title class_\">Koa</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> path = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> serve = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;koa-static&#x27;</span>);</span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"keyword\">const</span> main = <span class=\"title function_\">serve</span>(path.<span class=\"title function_\">join</span>(__dirname+<span class=\"string\">&#x27;/public&#x27;</span>));</span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(main);</span><br><span class=\"line\"> </span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3006</span>,<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&quot;监听3006端口&quot;</span>)</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>回到项目</p>\n<p><span style=\"display:block;color:green;\">background.js</span></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; ipcMain &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// ipcMain 监听渲染进程checkForUpdate 事件</span></span><br><span class=\"line\">ipcMain.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;checkForUpdate&quot;</span>,<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  autoUpdater.<span class=\"property\">currentVersion</span> = package_json.<span class=\"property\">version</span>;</span><br><span class=\"line\">  <span class=\"comment\">//执行更新检查</span></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">checkForUpdates</span>();</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">updateHandle</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">\t...</span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-available&#x27;</span>, <span class=\"function\">(<span class=\"params\">info</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 检查到有新版本</span></span><br><span class=\"line\">    <span class=\"comment\">// 提醒用户已经找到了新版本</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;检查到有新版本&#x27;</span>, info)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><span style=\"display:block;color:green;\">app.vue</span></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div id=&quot;app&quot;&gt;</span><br><span class=\"line\">    &lt;button @click=&quot;checkForUpdates&quot;&gt;检查更新&lt;/button&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">import &#123; ipcRenderer &#125; from &quot;electron&quot;;</span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">  name: &#x27;App&#x27;,</span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">    checkForUpdates() &#123;</span><br><span class=\"line\">      // 通知主进程检查更新</span><br><span class=\"line\">      ipcRenderer.send(&#x27;checkForUpdate&#x27;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;style&gt;</span><br><span class=\"line\">#app &#123;</span><br><span class=\"line\">  font-family: Avenir, Helvetica, Arial, sans-serif;</span><br><span class=\"line\">  -webkit-font-smoothing: antialiased;</span><br><span class=\"line\">  -moz-osx-font-smoothing: grayscale;</span><br><span class=\"line\">  text-align: center;</span><br><span class=\"line\">  color: #2c3e50;</span><br><span class=\"line\">  margin-top: 60px;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br></pre></td></tr></table></figure>\n\n<p>点击按钮, 控制台打印如下</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">检查到有新版本 <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">  version<span class=\"punctuation\">:</span> &#x27;<span class=\"number\">1.0</span><span class=\"number\">.1</span>&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">  files<span class=\"punctuation\">:</span> <span class=\"punctuation\">[</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      url<span class=\"punctuation\">:</span> &#x27;demo<span class=\"number\">-1.0</span><span class=\"number\">.1</span>-mac.zip&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">      sha512<span class=\"punctuation\">:</span> &#x27;PJeIr6HilOlNrcR8HEimQQuJHjEiK7x2PHhOGnmul5tTI2n0R7+<span class=\"number\">6</span>PP8S5j3+bwfZzSkjBWWWYnlR8WNoQ17YBQ==&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">      size<span class=\"punctuation\">:</span> <span class=\"number\">77708593</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">      blockMapSize<span class=\"punctuation\">:</span> <span class=\"number\">82077</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#123;</span></span><br><span class=\"line\">      url<span class=\"punctuation\">:</span> &#x27;demo<span class=\"number\">-1.0</span><span class=\"number\">.1</span>.dmg&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">      sha512<span class=\"punctuation\">:</span> &#x27;i++/bWJ7pxIkShS+WehKkP8rLMjbKtHvFV/aLmDDj8lEqeyKP8cnVpSSlNNbqOwcqbxSzR5t07QMIUIVf0AMYw==&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">      size<span class=\"punctuation\">:</span> <span class=\"number\">80015179</span></span><br><span class=\"line\">    <span class=\"punctuation\">&#125;</span></span><br><span class=\"line\">  <span class=\"punctuation\">]</span><span class=\"punctuation\">,</span></span><br><span class=\"line\">  path<span class=\"punctuation\">:</span> &#x27;demo<span class=\"number\">-1.0</span><span class=\"number\">.1</span>-mac.zip&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">  sha512<span class=\"punctuation\">:</span> &#x27;PJeIr6HilOlNrcR8HEimQQuJHjEiK7x2PHhOGnmul5tTI2n0R7+<span class=\"number\">6</span>PP8S5j3+bwfZzSkjBWWWYnlR8WNoQ17YBQ==&#x27;<span class=\"punctuation\">,</span></span><br><span class=\"line\">  releaseDate<span class=\"punctuation\">:</span> &#x27;<span class=\"number\">2021</span><span class=\"number\">-04</span><span class=\"number\">-21</span>T05<span class=\"punctuation\">:</span><span class=\"number\">38</span><span class=\"punctuation\">:</span><span class=\"number\">20.929</span>Z&#x27;</span><br><span class=\"line\"><span class=\"punctuation\">&#125;</span></span><br></pre></td></tr></table></figure>\n\n<p>autoUpdater.downloadUpdate(); // 下载更新<br>autoUpdater.quitAndInstall(); // 执行推出安装更新<br>依次执行后实现了更新操作, 当然这对用户来说非常不友好，需要把更新流程交给用户去控制。</p>\n<p>autoUpdater给我们提供 download-progress(更新进度)、update-downloaded(更新完成) 监听。</p>\n<p><span style=\"display:block;color:green;\">app.vue</span></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div id=&quot;app&quot;&gt;</span><br><span class=\"line\">    &lt;a-button @click=&quot;checkForUpdates&quot;&gt;检查更新&lt;/a-button&gt;</span><br><span class=\"line\">    &lt;!-- 更新提示框 --&gt;</span><br><span class=\"line\">    &lt;div class=&quot;main-container__upgrade-panel&quot; v-if=&quot;show&quot;&gt;</span><br><span class=\"line\">      &lt;div class=&quot;main-container__upgrade-panel-title&quot;&gt;</span><br><span class=\"line\">        &#123;&#123;`发现新版本$&#123;versionInfo.version&#125;`&#125;&#125;</span><br><span class=\"line\">        &lt;span @click=&quot;() =&gt; &#123; show = !show &#125;&quot;&gt;&lt;a-tooltip title=&quot;最小化&quot; placement=&quot;top&quot;&gt;&lt;a-icon type=&quot;down-circle&quot; /&gt;&lt;/a-tooltip&gt;&lt;/span&gt;</span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">      &lt;div class=&quot;main-container__upgrade-panel-body&quot;&gt;</span><br><span class=\"line\">        &lt;div class=&quot;main-container__pd1t&quot;&gt;</span><br><span class=\"line\">          更新日志:</span><br><span class=\"line\">          &lt;/div&gt;</span><br><span class=\"line\">          &lt;div v-for=&quot;(item, index) in versionInfo.content&quot; :key=&quot;index&quot;&gt;&#123;&#123;item&#125;&#125;&lt;/div&gt;</span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">      &lt;div class=&quot;main-container__upgrade-panel-footer&quot;&gt;</span><br><span class=\"line\">        &lt;div style=&quot;width: 305px;&quot;&gt;</span><br><span class=\"line\">          &lt;a-progress</span><br><span class=\"line\">            :stroke-color=&quot;&#123;</span><br><span class=\"line\">              from: &#x27;#108ee9&#x27;,</span><br><span class=\"line\">              to: &#x27;#87d068&#x27;,</span><br><span class=\"line\">            &#125;&quot;</span><br><span class=\"line\">            :percent=&quot;progress.percent&quot;</span><br><span class=\"line\">            status=&quot;active&quot;</span><br><span class=\"line\">          /&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">        &lt;a-button style=&quot;margin-right: 10px;&quot; v-if=&quot;canInstall&quot; type=&quot;primary&quot; @click=&quot;() =&gt; icpSend(&#x27;quitAndInstall&#x27;)&quot;&gt;安装&lt;/a-button&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;a-button style=&quot;margin-right: 10px;&quot; v-else type=&quot;primary&quot; :loading=&quot;loading&quot;  @click=&quot;() =&gt; &#123; loading = true, icpSend(&#x27;downloadUpdate&#x27;) &#125;&quot;&gt; &lt;a-icon v-if=&quot;!loading&quot; type=&quot;down-square&quot; /&gt; 更新&lt;/a-button&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">        &lt;a-button :disabled=&quot;progress.percent &gt; 0&quot; type=&quot;dashed&quot; @click=&quot;() =&gt; &#123; show = !show &#125;&quot;&gt;下次再说&lt;/a-button&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">      &lt;/div&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">import &#123; ipcRenderer &#125; from &quot;electron&quot;;</span><br><span class=\"line\">export default &#123;</span><br><span class=\"line\">  name: &#x27;App&#x27;,</span><br><span class=\"line\">  data() &#123;</span><br><span class=\"line\">    return &#123;</span><br><span class=\"line\">      DOWNLOAD_URL: &#x27;http://localhost:3006/&#x27;,</span><br><span class=\"line\">      canInstall: false,</span><br><span class=\"line\">      show: false,</span><br><span class=\"line\">      progress: &#123;</span><br><span class=\"line\">        bytesPerSecond: 0,</span><br><span class=\"line\">        delta: 0,</span><br><span class=\"line\">        percent: 0,</span><br><span class=\"line\">        total: 0,</span><br><span class=\"line\">        transferred: 0</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      loading: false,</span><br><span class=\"line\">      versionInfo: &#123;</span><br><span class=\"line\">        version: &#x27;&#x27;,</span><br><span class=\"line\">        content: [</span><br><span class=\"line\">          &#x27;123&#x27;,</span><br><span class=\"line\">          &#x27;456&#x27;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  created() &#123;</span><br><span class=\"line\">    // 版本有更新时提示</span><br><span class=\"line\">    ipcRenderer.on(&quot;updateAvailable&quot;, async (event, info) =&gt; &#123;</span><br><span class=\"line\">      const verInfo = await this.getVersionInfo(info);</span><br><span class=\"line\">      if (verInfo) &#123;</span><br><span class=\"line\">        try &#123;</span><br><span class=\"line\">          this.versionInfo.version = JSON.parse(verInfo).version;</span><br><span class=\"line\">          this.versionInfo.content = JSON.parse(verInfo).content;</span><br><span class=\"line\">        &#125; catch (e) &#123;</span><br><span class=\"line\">          console.log(e)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        this.show = true;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    // 下载进度条</span><br><span class=\"line\">    ipcRenderer.on(&quot;downloadProgress&quot;, (event, progressObj) =&gt; &#123;</span><br><span class=\"line\">      progressObj.percent = Number(progressObj.percent.toFixed(1));</span><br><span class=\"line\">      this.progress = &#123;</span><br><span class=\"line\">        ...progressObj</span><br><span class=\"line\">      &#125;;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    ipcRenderer.on(&quot;isUpdateNow&quot;, () =&gt; &#123;</span><br><span class=\"line\">      this.canInstall = true;</span><br><span class=\"line\">      this.show = true;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">    async getVersionInfo(info) &#123;</span><br><span class=\"line\">      return new Promise((resolve) =&gt; &#123;</span><br><span class=\"line\">        let xhr = new XMLHttpRequest();</span><br><span class=\"line\">        xhr.open(&#x27;get&#x27;, this.DOWNLOAD_URL + info.version + &#x27;.json&#x27;, true);</span><br><span class=\"line\">        xhr.send(null);</span><br><span class=\"line\">        xhr.onreadystatechange = function () &#123;</span><br><span class=\"line\">          </span><br><span class=\"line\">          if (xhr.readyState == 4) &#123;</span><br><span class=\"line\">            if (xhr.status == 200) &#123;</span><br><span class=\"line\">              </span><br><span class=\"line\">              resolve(xhr.responseText)</span><br><span class=\"line\">            &#125; else &#123;</span><br><span class=\"line\">              resolve(null)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    icpSend(name) &#123;</span><br><span class=\"line\">      ipcRenderer.send(name);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    checkForUpdates() &#123;</span><br><span class=\"line\">      ipcRenderer.send(&#x27;checkForUpdate&#x27;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;style lang=&quot;scss&quot;&gt;</span><br><span class=\"line\">#app &#123;</span><br><span class=\"line\">  font-family: Avenir, Helvetica, Arial, sans-serif;</span><br><span class=\"line\">  -webkit-font-smoothing: antialiased;</span><br><span class=\"line\">  -moz-osx-font-smoothing: grayscale;</span><br><span class=\"line\">  color: #2c3e50;</span><br><span class=\"line\">  margin-top: 60px;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.main-container &#123;</span><br><span class=\"line\">  width: 100%;</span><br><span class=\"line\">  position: relative;</span><br><span class=\"line\">  // display: flex;</span><br><span class=\"line\">  background: #f7f7f7;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;__drag &#123;</span><br><span class=\"line\">    position: absolute;</span><br><span class=\"line\">    width: calc(100% - 100px);</span><br><span class=\"line\">    height: 25px;</span><br><span class=\"line\">    -webkit-app-region: drag;</span><br><span class=\"line\">    .overlay &#123;</span><br><span class=\"line\">      pointer-events: none;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;__controls &#123;</span><br><span class=\"line\">    position: absolute;</span><br><span class=\"line\">    right: 0;</span><br><span class=\"line\">    -webkit-app-region: no-drag;</span><br><span class=\"line\">    top: 0;</span><br><span class=\"line\">    z-index: 200;</span><br><span class=\"line\">    border-radius: 0 0 3px 3px;</span><br><span class=\"line\">    padding: 0;</span><br><span class=\"line\">    background: #bfbfbf21;</span><br><span class=\"line\">    :hover &#123;</span><br><span class=\"line\">      color: white;</span><br><span class=\"line\">      background: gray;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    :nth-child(3):hover&#123;</span><br><span class=\"line\">      background-color: red;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;-item &#123;</span><br><span class=\"line\">      display: inline-block;</span><br><span class=\"line\">      padding: 5px 10px;</span><br><span class=\"line\">      color: #ccc;</span><br><span class=\"line\">      font-size: 12px;</span><br><span class=\"line\">      -webkit-app-region: no-drag;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;__upgrade-panel &#123;</span><br><span class=\"line\">    position: fixed;</span><br><span class=\"line\">    z-index: 9999;</span><br><span class=\"line\">    right: 10px;</span><br><span class=\"line\">    bottom: 25px;</span><br><span class=\"line\">    width: 340px;</span><br><span class=\"line\">    background-color: #34373c;</span><br><span class=\"line\">    color: white;</span><br><span class=\"line\">    border-radius: 3px;</span><br><span class=\"line\">    font-size: 12px;</span><br><span class=\"line\">    box-shadow: 0px 0px 5px 5px rgba(133,133,133,0.25);</span><br><span class=\"line\"></span><br><span class=\"line\">    ::-webkit-scrollbar &#123;</span><br><span class=\"line\">      display: none; /* Chrome Safari */</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;-title &#123;</span><br><span class=\"line\">      padding: 10px 15px;</span><br><span class=\"line\">      width: 100%;</span><br><span class=\"line\">      height: 40px;</span><br><span class=\"line\">      border-bottom: 1px solid white;</span><br><span class=\"line\"></span><br><span class=\"line\">      span &#123;</span><br><span class=\"line\">        position: absolute;</span><br><span class=\"line\">        font-size: 14px;</span><br><span class=\"line\">        right: 10px;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">      span:hover &#123;</span><br><span class=\"line\">        color:#FFFFFF;</span><br><span class=\"line\">        background-color:#6dd214;</span><br><span class=\"line\">        text-shadow:none;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;-body &#123;</span><br><span class=\"line\">      overflow-y: auto;</span><br><span class=\"line\">      padding: 10px 15px;</span><br><span class=\"line\">      max-height: 100px;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &amp;-footer &#123;</span><br><span class=\"line\">      padding-left: 10px;</span><br><span class=\"line\">      padding-bottom: 10px;</span><br><span class=\"line\"></span><br><span class=\"line\">      a-button &#123;</span><br><span class=\"line\">        margin-right: 15px;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  &amp;__pd1t &#123;</span><br><span class=\"line\">    padding-top: 5px;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">.ant-progress-text &#123;</span><br><span class=\"line\">  color: white !important;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p><span style=\"display:block;color:green;\">background.js</span></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&#x27;use strict&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; app, protocol, <span class=\"title class_\">BrowserWindow</span>, ipcMain &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> &#123; createProtocol &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;vue-cli-plugin-electron-builder/lib&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">import</span> installExtension, &#123; <span class=\"variable constant_\">VUEJS_DEVTOOLS</span> &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;electron-devtools-installer&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> fs = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;fs&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; autoUpdater &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;electron-updater&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> isDevelopment = process.<span class=\"property\">env</span>.<span class=\"property\">NODE_ENV</span> !== <span class=\"string\">&#x27;production&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"variable constant_\">DOWNLOAD_URL</span> = <span class=\"string\">&#x27;http://localhost:3006/&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> package_json = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;../package.json&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> mainWindow = <span class=\"literal\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Scheme must be registered before the app is ready</span></span><br><span class=\"line\">protocol.<span class=\"title function_\">registerSchemesAsPrivileged</span>([</span><br><span class=\"line\">  &#123; <span class=\"attr\">scheme</span>: <span class=\"string\">&#x27;app&#x27;</span>, <span class=\"attr\">privileges</span>: &#123; <span class=\"attr\">secure</span>: <span class=\"literal\">true</span>, <span class=\"attr\">standard</span>: <span class=\"literal\">true</span> &#125; &#125;</span><br><span class=\"line\">])</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">async</span> <span class=\"keyword\">function</span> <span class=\"title function_\">createWindow</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  <span class=\"comment\">// Create the browser window.</span></span><br><span class=\"line\">  mainWindow = <span class=\"keyword\">new</span> <span class=\"title class_\">BrowserWindow</span>(&#123;</span><br><span class=\"line\">    <span class=\"attr\">width</span>: <span class=\"number\">800</span>,</span><br><span class=\"line\">    <span class=\"attr\">height</span>: <span class=\"number\">600</span>,</span><br><span class=\"line\">    <span class=\"attr\">webPreferences</span>: &#123;</span><br><span class=\"line\">      </span><br><span class=\"line\">      <span class=\"comment\">// Use pluginOptions.nodeIntegration, leave this alone</span></span><br><span class=\"line\">      <span class=\"comment\">// See nklayman.github.io/vue-cli-plugin-electron-builder/guide/security.html#node-integration for more info</span></span><br><span class=\"line\">      <span class=\"attr\">nodeIntegration</span>: process.<span class=\"property\">env</span>.<span class=\"property\">ELECTRON_NODE_INTEGRATION</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Load the url of the dev server if in development mode</span></span><br><span class=\"line\">    <span class=\"keyword\">await</span> mainWindow.<span class=\"title function_\">loadURL</span>(process.<span class=\"property\">env</span>.<span class=\"property\">WEBPACK_DEV_SERVER_URL</span>)</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) mainWindow.<span class=\"property\">webContents</span>.<span class=\"title function_\">openDevTools</span>()</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_\">createProtocol</span>(<span class=\"string\">&#x27;app&#x27;</span>)</span><br><span class=\"line\">    <span class=\"comment\">// Load the index.html when not in development</span></span><br><span class=\"line\">    mainWindow.<span class=\"title function_\">loadURL</span>(<span class=\"string\">&#x27;app://./index.html&#x27;</span>)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Quit when all windows are closed.</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;window-all-closed&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// On macOS it is common for applications and their menu bar</span></span><br><span class=\"line\">  <span class=\"comment\">// to stay active until the user quits explicitly with Cmd + Q</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> !== <span class=\"string\">&#x27;darwin&#x27;</span>) &#123;</span><br><span class=\"line\">    app.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;activate&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// On macOS it&#x27;s common to re-create a window in the app when the</span></span><br><span class=\"line\">  <span class=\"comment\">// dock icon is clicked and there are no other windows open.</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (<span class=\"title class_\">BrowserWindow</span>.<span class=\"title function_\">getAllWindows</span>().<span class=\"property\">length</span> === <span class=\"number\">0</span>) <span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// This method will be called when Electron has finished</span></span><br><span class=\"line\"><span class=\"comment\">// initialization and is ready to create browser windows.</span></span><br><span class=\"line\"><span class=\"comment\">// Some APIs can only be used after this event occurs.</span></span><br><span class=\"line\">app.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;ready&#x27;</span>, <span class=\"keyword\">async</span> () =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (isDevelopment &amp;&amp; !process.<span class=\"property\">env</span>.<span class=\"property\">IS_TEST</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Install Vue Devtools</span></span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">await</span> <span class=\"title function_\">installExtension</span>(<span class=\"variable constant_\">VUEJS_DEVTOOLS</span>)</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">console</span>.<span class=\"title function_\">error</span>(<span class=\"string\">&#x27;Vue Devtools failed to install:&#x27;</span>, e.<span class=\"title function_\">toString</span>())</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;ready&#x27;</span>)</span><br><span class=\"line\">  <span class=\"title function_\">createWindow</span>()</span><br><span class=\"line\">  <span class=\"title function_\">updateHandle</span>();</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Exit cleanly on request from parent process in development mode.</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (isDevelopment) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (process.<span class=\"property\">platform</span> === <span class=\"string\">&#x27;win32&#x27;</span>) &#123;</span><br><span class=\"line\">    process.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;message&#x27;</span>, <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (data === <span class=\"string\">&#x27;graceful-exit&#x27;</span>) &#123;</span><br><span class=\"line\">        app.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    process.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;SIGTERM&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">      app.<span class=\"title function_\">quit</span>()</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">deleteFile</span> = (<span class=\"params\">path</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> files = [];</span><br><span class=\"line\">  <span class=\"keyword\">if</span>( fs.<span class=\"title function_\">existsSync</span>(path) ) &#123;</span><br><span class=\"line\">      files = fs.<span class=\"title function_\">readdirSync</span>(path);</span><br><span class=\"line\">      files.<span class=\"title function_\">forEach</span>(<span class=\"keyword\">function</span>(<span class=\"params\">file</span>)&#123;</span><br><span class=\"line\">          <span class=\"keyword\">var</span> curPath = path + <span class=\"string\">&quot;/&quot;</span> + file;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(fs.<span class=\"title function_\">statSync</span>(curPath).<span class=\"title function_\">isDirectory</span>()) &#123;</span><br><span class=\"line\">              <span class=\"title function_\">deleteFile</span>(curPath);</span><br><span class=\"line\">          &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">              fs.<span class=\"title function_\">unlinkSync</span>(curPath);</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">      fs.<span class=\"title function_\">rmdirSync</span>(path);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">function</span> <span class=\"title function_\">updateHandle</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">  autoUpdater.<span class=\"property\">currentVersion</span> = package_json.<span class=\"property\">version</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">setFeedURL</span>(<span class=\"variable constant_\">DOWNLOAD_URL</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 取消自动更新</span></span><br><span class=\"line\">  autoUpdater.<span class=\"property\">autoDownload</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\">  </span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;checking-for-update&#x27;</span>, <span class=\"function\">(<span class=\"params\">info</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 开始检查是否有新版本</span></span><br><span class=\"line\">    <span class=\"comment\">// 可以在这里提醒用户正在查找新版本</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-available&#x27;</span>, <span class=\"function\">(<span class=\"params\">info</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 检查到有新版本</span></span><br><span class=\"line\">    <span class=\"comment\">// 提醒用户已经找到了新版本</span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(info)</span><br><span class=\"line\">    mainWindow.<span class=\"property\">webContents</span>.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;updateAvailable&#x27;</span>, info)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  </span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-not-available&#x27;</span>, <span class=\"function\">(<span class=\"params\">info</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 检查到无新版本</span></span><br><span class=\"line\">    <span class=\"comment\">// 提醒用户当前版本已经是最新版，无需更新</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;download-progress&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">progressObj</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 更新进度条</span></span><br><span class=\"line\">    mainWindow.<span class=\"property\">webContents</span>.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;downloadProgress&#x27;</span>, progressObj)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  </span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;error&#x27;</span>, <span class=\"function\">(<span class=\"params\">err</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 自动升级遇到错误</span></span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  </span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">on</span>(<span class=\"string\">&#x27;update-downloaded&#x27;</span>, <span class=\"function\">(<span class=\"params\">ev, releaseNotes, releaseName</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 自动升级下载完成</span></span><br><span class=\"line\">    <span class=\"comment\">// 可以询问用户是否重启应用更新，用户如果同意就可以执行 autoUpdater.quitAndInstall()</span></span><br><span class=\"line\">    mainWindow.<span class=\"property\">webContents</span>.<span class=\"title function_\">send</span>(<span class=\"string\">&#x27;isUpdateNow&#x27;</span>)</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">ipcMain.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;checkForUpdate&quot;</span>,<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(autoUpdater.<span class=\"property\">currentVersion</span>)</span><br><span class=\"line\">  autoUpdater.<span class=\"property\">currentVersion</span> = package_json.<span class=\"property\">version</span>;</span><br><span class=\"line\">  <span class=\"comment\">//执行自动更新检查</span></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">checkForUpdates</span>();</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">ipcMain.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;downloadUpdate&quot;</span>,<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 更新前删除本地更新包</span></span><br><span class=\"line\">    <span class=\"title function_\">deleteFile</span>(autoUpdater.<span class=\"property\">app</span>.<span class=\"property\">baseCachePath</span>)</span><br><span class=\"line\">  &#125;<span class=\"keyword\">catch</span> &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//执行自动更新检查</span></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">downloadUpdate</span>();</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">ipcMain.<span class=\"title function_\">on</span>(<span class=\"string\">&quot;quitAndInstall&quot;</span>,<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">//执行自动更新检查</span></span><br><span class=\"line\">  autoUpdater.<span class=\"title function_\">quitAndInstall</span>();</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"最终效果\"><a href=\"#最终效果\" class=\"headerlink\" title=\"最终效果\"></a>最终效果</h2><p><img src=\"https://user-images.githubusercontent.com/70128222/194988621-0040f2df-fa6c-45b7-adfe-98fe6a639bc9.gif\" alt=\"preview\"></p>\n"},{"title":"Luckysheet 初体验","top_img":false,"date":"2022-09-09T16:00:00.000Z","cover":"https://mengshukeji.gitee.io/luckysheetdocs/img/LuckysheetDemo.gif","_content":"\n## 介绍\n[Luckysheet](https://github.com/mengshukeji/Luckysheet) ，一款纯前端类似excel的在线表格，功能强大、配置简单、完全开源。\n\n## 开始\n\n### 下载vue示例\n``` sh\ngit clone https://github.com/hjwforever/luckysheet-vue3-vite.git\n// 安装依赖\nnpm install \n// 启动\nnpm run dev\n```\n\n运行后如下:\n![1](https://user-images.githubusercontent.com/70128222/194989058-d0a282cb-965e-439d-92c1-cf7b1411b3ae.jpg)\n\n\n\n文件目录:\n\n``` md\n├── src\n│   └── assets\n|   └── components\n|       └── LuckySheet.vue \n├── ...\n└── package.json\n```\n\n打开 LuckySheet.vue \n\n为了看起来更简洁 移除暂时用不到的方法\n\n``` vue\n<template>\n  <div id=\"luckysheet\"></div>\n</template>\n\n<script setup>\nimport {onMounted } from 'vue'\n\nonMounted(() => {\n  // 创建luckysheet 表格\n  luckysheet.create({\n    container: 'luckysheet'\n  })\n})\n</script>\n\n<style  scoped>\n#luckysheet {\n  margin: 0px;\n  padding: 0px;\n  position: absolute;\n  width: 100%;\n  left: 0px;\n  top: 30px;\n  bottom: 0px;\n}\n</style>\n\n```\n\n### 下载源码\n\n版本: \"2.1.13\"\n``` sh\ngit clone https://github.com/mengshukeji/Luckysheet.git\n// 安装依赖\nnpm install \n// 启动\nnpm run dev\n```\n\n``` md\n├── docs // vuepress 文档\n├── src\n|   |── assets\n|   |── controllers\n|   |── css\n|   |── data\n|   └── ...\n├── config.js // 表格配置文件\n├── core.js // 入口\n├── index.html \n├── index.js\n└── package.json\n```\n\n\n","source":"_posts/Luckysheet 初体验.md","raw":"---\ntitle: Luckysheet 初体验\ntop_img: false\ndate: 2022-09-10\ncategories: \n- 前端\ntags:\n- Luckysheet\ncover: https://mengshukeji.gitee.io/luckysheetdocs/img/LuckysheetDemo.gif\n---\n\n## 介绍\n[Luckysheet](https://github.com/mengshukeji/Luckysheet) ，一款纯前端类似excel的在线表格，功能强大、配置简单、完全开源。\n\n## 开始\n\n### 下载vue示例\n``` sh\ngit clone https://github.com/hjwforever/luckysheet-vue3-vite.git\n// 安装依赖\nnpm install \n// 启动\nnpm run dev\n```\n\n运行后如下:\n![1](https://user-images.githubusercontent.com/70128222/194989058-d0a282cb-965e-439d-92c1-cf7b1411b3ae.jpg)\n\n\n\n文件目录:\n\n``` md\n├── src\n│   └── assets\n|   └── components\n|       └── LuckySheet.vue \n├── ...\n└── package.json\n```\n\n打开 LuckySheet.vue \n\n为了看起来更简洁 移除暂时用不到的方法\n\n``` vue\n<template>\n  <div id=\"luckysheet\"></div>\n</template>\n\n<script setup>\nimport {onMounted } from 'vue'\n\nonMounted(() => {\n  // 创建luckysheet 表格\n  luckysheet.create({\n    container: 'luckysheet'\n  })\n})\n</script>\n\n<style  scoped>\n#luckysheet {\n  margin: 0px;\n  padding: 0px;\n  position: absolute;\n  width: 100%;\n  left: 0px;\n  top: 30px;\n  bottom: 0px;\n}\n</style>\n\n```\n\n### 下载源码\n\n版本: \"2.1.13\"\n``` sh\ngit clone https://github.com/mengshukeji/Luckysheet.git\n// 安装依赖\nnpm install \n// 启动\nnpm run dev\n```\n\n``` md\n├── docs // vuepress 文档\n├── src\n|   |── assets\n|   |── controllers\n|   |── css\n|   |── data\n|   └── ...\n├── config.js // 表格配置文件\n├── core.js // 入口\n├── index.html \n├── index.js\n└── package.json\n```\n\n\n","slug":"Luckysheet 初体验","published":1,"updated":"2022-11-07T06:29:47.422Z","_id":"cla6che5m0003ys77407qb6pv","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p><a href=\"https://github.com/mengshukeji/Luckysheet\">Luckysheet</a> ，一款纯前端类似excel的在线表格，功能强大、配置简单、完全开源。</p>\n<h2 id=\"开始\"><a href=\"#开始\" class=\"headerlink\" title=\"开始\"></a>开始</h2><h3 id=\"下载vue示例\"><a href=\"#下载vue示例\" class=\"headerlink\" title=\"下载vue示例\"></a>下载vue示例</h3><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/hjwforever/luckysheet-vue3-vite.git</span><br><span class=\"line\">// 安装依赖</span><br><span class=\"line\">npm install </span><br><span class=\"line\">// 启动</span><br><span class=\"line\">npm run dev</span><br></pre></td></tr></table></figure>\n\n<p>运行后如下:<br><img src=\"https://user-images.githubusercontent.com/70128222/194989058-d0a282cb-965e-439d-92c1-cf7b1411b3ae.jpg\" alt=\"1\"></p>\n<p>文件目录:</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── src</span><br><span class=\"line\">│   └── assets</span><br><span class=\"line\">|   └── components</span><br><span class=\"line\">|       └── LuckySheet.vue </span><br><span class=\"line\">├── ...</span><br><span class=\"line\">└── package.json</span><br></pre></td></tr></table></figure>\n\n<p>打开 LuckySheet.vue </p>\n<p>为了看起来更简洁 移除暂时用不到的方法</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div id=&quot;luckysheet&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script setup&gt;</span><br><span class=\"line\">import &#123;onMounted &#125; from &#x27;vue&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">onMounted(() =&gt; &#123;</span><br><span class=\"line\">  // 创建luckysheet 表格</span><br><span class=\"line\">  luckysheet.create(&#123;</span><br><span class=\"line\">    container: &#x27;luckysheet&#x27;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;style  scoped&gt;</span><br><span class=\"line\">#luckysheet &#123;</span><br><span class=\"line\">  margin: 0px;</span><br><span class=\"line\">  padding: 0px;</span><br><span class=\"line\">  position: absolute;</span><br><span class=\"line\">  width: 100%;</span><br><span class=\"line\">  left: 0px;</span><br><span class=\"line\">  top: 30px;</span><br><span class=\"line\">  bottom: 0px;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载源码\"><a href=\"#下载源码\" class=\"headerlink\" title=\"下载源码\"></a>下载源码</h3><p>版本: “2.1.13”</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/mengshukeji/Luckysheet.git</span><br><span class=\"line\">// 安装依赖</span><br><span class=\"line\">npm install </span><br><span class=\"line\">// 启动</span><br><span class=\"line\">npm run dev</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── docs // vuepress 文档</span><br><span class=\"line\">├── src</span><br><span class=\"line\">|   |── assets</span><br><span class=\"line\">|   |── controllers</span><br><span class=\"line\">|   |── css</span><br><span class=\"line\">|   |── data</span><br><span class=\"line\">|   └── ...</span><br><span class=\"line\">├── config.js // 表格配置文件</span><br><span class=\"line\">├── core.js // 入口</span><br><span class=\"line\">├── index.html </span><br><span class=\"line\">├── index.js</span><br><span class=\"line\">└── package.json</span><br></pre></td></tr></table></figure>\n\n\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p><a href=\"https://github.com/mengshukeji/Luckysheet\">Luckysheet</a> ，一款纯前端类似excel的在线表格，功能强大、配置简单、完全开源。</p>\n<h2 id=\"开始\"><a href=\"#开始\" class=\"headerlink\" title=\"开始\"></a>开始</h2><h3 id=\"下载vue示例\"><a href=\"#下载vue示例\" class=\"headerlink\" title=\"下载vue示例\"></a>下载vue示例</h3><figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/hjwforever/luckysheet-vue3-vite.git</span><br><span class=\"line\">// 安装依赖</span><br><span class=\"line\">npm install </span><br><span class=\"line\">// 启动</span><br><span class=\"line\">npm run dev</span><br></pre></td></tr></table></figure>\n\n<p>运行后如下:<br><img src=\"https://user-images.githubusercontent.com/70128222/194989058-d0a282cb-965e-439d-92c1-cf7b1411b3ae.jpg\" alt=\"1\"></p>\n<p>文件目录:</p>\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── src</span><br><span class=\"line\">│   └── assets</span><br><span class=\"line\">|   └── components</span><br><span class=\"line\">|       └── LuckySheet.vue </span><br><span class=\"line\">├── ...</span><br><span class=\"line\">└── package.json</span><br></pre></td></tr></table></figure>\n\n<p>打开 LuckySheet.vue </p>\n<p>为了看起来更简洁 移除暂时用不到的方法</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;template&gt;</span><br><span class=\"line\">  &lt;div id=&quot;luckysheet&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">&lt;/template&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script setup&gt;</span><br><span class=\"line\">import &#123;onMounted &#125; from &#x27;vue&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">onMounted(() =&gt; &#123;</span><br><span class=\"line\">  // 创建luckysheet 表格</span><br><span class=\"line\">  luckysheet.create(&#123;</span><br><span class=\"line\">    container: &#x27;luckysheet&#x27;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;style  scoped&gt;</span><br><span class=\"line\">#luckysheet &#123;</span><br><span class=\"line\">  margin: 0px;</span><br><span class=\"line\">  padding: 0px;</span><br><span class=\"line\">  position: absolute;</span><br><span class=\"line\">  width: 100%;</span><br><span class=\"line\">  left: 0px;</span><br><span class=\"line\">  top: 30px;</span><br><span class=\"line\">  bottom: 0px;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/style&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"下载源码\"><a href=\"#下载源码\" class=\"headerlink\" title=\"下载源码\"></a>下载源码</h3><p>版本: “2.1.13”</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/mengshukeji/Luckysheet.git</span><br><span class=\"line\">// 安装依赖</span><br><span class=\"line\">npm install </span><br><span class=\"line\">// 启动</span><br><span class=\"line\">npm run dev</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight md\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">├── docs // vuepress 文档</span><br><span class=\"line\">├── src</span><br><span class=\"line\">|   |── assets</span><br><span class=\"line\">|   |── controllers</span><br><span class=\"line\">|   |── css</span><br><span class=\"line\">|   |── data</span><br><span class=\"line\">|   └── ...</span><br><span class=\"line\">├── config.js // 表格配置文件</span><br><span class=\"line\">├── core.js // 入口</span><br><span class=\"line\">├── index.html </span><br><span class=\"line\">├── index.js</span><br><span class=\"line\">└── package.json</span><br></pre></td></tr></table></figure>\n\n\n"},{"title":"Flutter Andoird 返回键退出友好处理","top_img":false,"date":"2022-06-04T16:00:00.000Z","cover":"https://img1.baidu.com/it/u=1855083458,281793390&fm=253&fmt=auto&app=138&f=JPEG?w=989&h=500","_content":"\n## 背景\nAndroid手机会有虚拟按键, 或者实体按键。 用户点击返回按键或误触时 如果刚打开或者路由栈没有更多页面则会退出应用\n直接退出应用的话 用户体验就太差了, 所以大多数的做法是在一定时间内再按返回才进行退出操作 \n\n## 解决\n在Flutter中我们可以通过 [WillPopScope](https://api.flutter.dev/flutter/widgets/WillPopScope-class.html) 来实现返回按钮拦截\n\n``` dart\nconst WillPopScope({\n  ...\n  required WillPopCallback onWillPop,\n  required Widget child\n})\n```\n\nonWillPop是回调函数, 当用户点击返回按钮时调用\n\n``` dart\nimport 'package:flutter/material.dart';\nimport 'package:get/get.dart';\n\nclass WillPopTest extends StatefulWidget {\n  @override\n  State<StatefulWidget> createState() => WillPopTestState();\n}\n\nclass WillPopTestState extends State<WillPopTest> {\n  DateTime? _lastClickTime; //上次点击时间\n\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return GetMaterialApp(\n      home: Scaffold(\n        body: WillPopScope(\n            onWillPop: () async {\n              if (_lastClickTime == null ||\n                  DateTime.now().difference(_lastClickTime!) >\n                      Duration(seconds: 1)) {\n                _lastClickTime = DateTime.now();\n                Get.snackbar('提示', '再按一次退出',\n                    margin: EdgeInsets.only(bottom: 10),\n                    snackPosition: SnackPosition.BOTTOM);\n                return false;\n              }\n              return true;\n            },\n            child: Container(\n              child: Center(\n                child: Text('点击两次返回退出app'),\n              ),\n            )),\n      ),\n    );\n  }\n}\n```\n\n![1](https://user-images.githubusercontent.com/70128222/194988803-41fe32b5-35c0-418d-9f55-e0f2a00320cb.gif)\n","source":"_posts/Flutter Andoird 返回键退出友好处理.md","raw":"---\ntitle: Flutter Andoird 返回键退出友好处理\ntop_img: false\ndate: 2022-06-05\ncategories: \n- 前端\ntags:\n- Flutter\ncover: https://img1.baidu.com/it/u=1855083458,281793390&fm=253&fmt=auto&app=138&f=JPEG?w=989&h=500\n---\n\n## 背景\nAndroid手机会有虚拟按键, 或者实体按键。 用户点击返回按键或误触时 如果刚打开或者路由栈没有更多页面则会退出应用\n直接退出应用的话 用户体验就太差了, 所以大多数的做法是在一定时间内再按返回才进行退出操作 \n\n## 解决\n在Flutter中我们可以通过 [WillPopScope](https://api.flutter.dev/flutter/widgets/WillPopScope-class.html) 来实现返回按钮拦截\n\n``` dart\nconst WillPopScope({\n  ...\n  required WillPopCallback onWillPop,\n  required Widget child\n})\n```\n\nonWillPop是回调函数, 当用户点击返回按钮时调用\n\n``` dart\nimport 'package:flutter/material.dart';\nimport 'package:get/get.dart';\n\nclass WillPopTest extends StatefulWidget {\n  @override\n  State<StatefulWidget> createState() => WillPopTestState();\n}\n\nclass WillPopTestState extends State<WillPopTest> {\n  DateTime? _lastClickTime; //上次点击时间\n\n  @override\n  Widget build(BuildContext context) {\n    // TODO: implement build\n    return GetMaterialApp(\n      home: Scaffold(\n        body: WillPopScope(\n            onWillPop: () async {\n              if (_lastClickTime == null ||\n                  DateTime.now().difference(_lastClickTime!) >\n                      Duration(seconds: 1)) {\n                _lastClickTime = DateTime.now();\n                Get.snackbar('提示', '再按一次退出',\n                    margin: EdgeInsets.only(bottom: 10),\n                    snackPosition: SnackPosition.BOTTOM);\n                return false;\n              }\n              return true;\n            },\n            child: Container(\n              child: Center(\n                child: Text('点击两次返回退出app'),\n              ),\n            )),\n      ),\n    );\n  }\n}\n```\n\n![1](https://user-images.githubusercontent.com/70128222/194988803-41fe32b5-35c0-418d-9f55-e0f2a00320cb.gif)\n","slug":"Flutter Andoird 返回键退出友好处理","published":1,"updated":"2022-11-07T06:34:44.613Z","_id":"cla6che5n0004ys77h95gao5t","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>Android手机会有虚拟按键, 或者实体按键。 用户点击返回按键或误触时 如果刚打开或者路由栈没有更多页面则会退出应用<br>直接退出应用的话 用户体验就太差了, 所以大多数的做法是在一定时间内再按返回才进行退出操作 </p>\n<h2 id=\"解决\"><a href=\"#解决\" class=\"headerlink\" title=\"解决\"></a>解决</h2><p>在Flutter中我们可以通过 <a href=\"https://api.flutter.dev/flutter/widgets/WillPopScope-class.html\">WillPopScope</a> 来实现返回按钮拦截</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> WillPopScope(&#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"keyword\">required</span> WillPopCallback onWillPop,</span><br><span class=\"line\">  <span class=\"keyword\">required</span> Widget child</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>onWillPop是回调函数, 当用户点击返回按钮时调用</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:get/get.dart&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WillPopTest</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;StatefulWidget&gt; createState() =&gt; WillPopTestState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WillPopTestState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">WillPopTest</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">DateTime?</span> _lastClickTime; <span class=\"comment\">//上次点击时间</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> GetMaterialApp(</span><br><span class=\"line\">      home: Scaffold(</span><br><span class=\"line\">        body: WillPopScope(</span><br><span class=\"line\">            onWillPop: () <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (_lastClickTime == <span class=\"keyword\">null</span> ||</span><br><span class=\"line\">                  <span class=\"built_in\">DateTime</span>.now().difference(_lastClickTime!) &gt;</span><br><span class=\"line\">                      <span class=\"built_in\">Duration</span>(seconds: <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                _lastClickTime = <span class=\"built_in\">DateTime</span>.now();</span><br><span class=\"line\">                Get.snackbar(<span class=\"string\">&#x27;提示&#x27;</span>, <span class=\"string\">&#x27;再按一次退出&#x27;</span>,</span><br><span class=\"line\">                    margin: EdgeInsets.only(bottom: <span class=\"number\">10</span>),</span><br><span class=\"line\">                    snackPosition: SnackPosition.BOTTOM);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            child: Container(</span><br><span class=\"line\">              child: Center(</span><br><span class=\"line\">                child: Text(<span class=\"string\">&#x27;点击两次返回退出app&#x27;</span>),</span><br><span class=\"line\">              ),</span><br><span class=\"line\">            )),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://user-images.githubusercontent.com/70128222/194988803-41fe32b5-35c0-418d-9f55-e0f2a00320cb.gif\" alt=\"1\"></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>Android手机会有虚拟按键, 或者实体按键。 用户点击返回按键或误触时 如果刚打开或者路由栈没有更多页面则会退出应用<br>直接退出应用的话 用户体验就太差了, 所以大多数的做法是在一定时间内再按返回才进行退出操作 </p>\n<h2 id=\"解决\"><a href=\"#解决\" class=\"headerlink\" title=\"解决\"></a>解决</h2><p>在Flutter中我们可以通过 <a href=\"https://api.flutter.dev/flutter/widgets/WillPopScope-class.html\">WillPopScope</a> 来实现返回按钮拦截</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> WillPopScope(&#123;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">  <span class=\"keyword\">required</span> WillPopCallback onWillPop,</span><br><span class=\"line\">  <span class=\"keyword\">required</span> Widget child</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>onWillPop是回调函数, 当用户点击返回按钮时调用</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:get/get.dart&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WillPopTest</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;StatefulWidget&gt; createState() =&gt; WillPopTestState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">WillPopTestState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">WillPopTest</span>&gt; </span>&#123;</span><br><span class=\"line\">  <span class=\"built_in\">DateTime?</span> _lastClickTime; <span class=\"comment\">//上次点击时间</span></span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// <span class=\"doctag\">TODO:</span> implement build</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> GetMaterialApp(</span><br><span class=\"line\">      home: Scaffold(</span><br><span class=\"line\">        body: WillPopScope(</span><br><span class=\"line\">            onWillPop: () <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">              <span class=\"keyword\">if</span> (_lastClickTime == <span class=\"keyword\">null</span> ||</span><br><span class=\"line\">                  <span class=\"built_in\">DateTime</span>.now().difference(_lastClickTime!) &gt;</span><br><span class=\"line\">                      <span class=\"built_in\">Duration</span>(seconds: <span class=\"number\">1</span>)) &#123;</span><br><span class=\"line\">                _lastClickTime = <span class=\"built_in\">DateTime</span>.now();</span><br><span class=\"line\">                Get.snackbar(<span class=\"string\">&#x27;提示&#x27;</span>, <span class=\"string\">&#x27;再按一次退出&#x27;</span>,</span><br><span class=\"line\">                    margin: EdgeInsets.only(bottom: <span class=\"number\">10</span>),</span><br><span class=\"line\">                    snackPosition: SnackPosition.BOTTOM);</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">              <span class=\"keyword\">return</span> <span class=\"keyword\">true</span>;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            child: Container(</span><br><span class=\"line\">              child: Center(</span><br><span class=\"line\">                child: Text(<span class=\"string\">&#x27;点击两次返回退出app&#x27;</span>),</span><br><span class=\"line\">              ),</span><br><span class=\"line\">            )),</span><br><span class=\"line\">      ),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://user-images.githubusercontent.com/70128222/194988803-41fe32b5-35c0-418d-9f55-e0f2a00320cb.gif\" alt=\"1\"></p>\n"},{"title":"使用Lottie 让动画更简单","top_img":false,"date":"2022-08-09T16:00:00.000Z","cover":"https://user-images.githubusercontent.com/70128222/194988917-dc95c10c-a1b2-4dfb-b322-af1d8671e0de.png","_content":"\n## 介绍\n\n[Lottie](https://lottiefiles.com/what-is-lottie) 是Airbnb推出Library 它可将After Effects动画经由[Bodymovi](http://aescripts.com/bodymovin/)扩展插件输入成一个JSON动画文件格式, 适用于 Web、iOS、Android、Windows、QT、Tizen 和其他平台。\n![lottie_1](https://user-images.githubusercontent.com/70128222/194988904-25329ba5-3361-4007-9851-1d572d17efbd.gif)\n\n\n## 使用\n\n如果你有After Effects动画, 可通过AE插件[Bodymovi](http://aescripts.com/bodymovin/) 生成JSON动画\n\n没有After Effects动画可以让设计来制作, 或者学习制作~\n\n当然也可以使用 [Lottie Files](https://lottiefiles.com/featured) 提供的免费动画\n\n![lottie_2](https://user-images.githubusercontent.com/70128222/194988917-dc95c10c-a1b2-4dfb-b322-af1d8671e0de.png)\n\n\n接着从[Lottie Files](https://lottiefiles.com/featured)下载一个动画任意动画\n\n### Flutter中使用\n1. lottie json 放入项目assets 目录下\n2. 安装 [lottie](https://pub.dev/packages/lottie/install)\n``` yaml\ndependencies:\n  lottie: ^1.3.0 \n```\n3. 使用\n``` dart\nimport 'package:flutter/material.dart';\nimport 'package:lottie/lottie.dart';\n\nvoid main() => runApp(const MyApp());\n\nclass MyApp extends StatelessWidget {\n  const MyApp({Key? key}) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      home: Scaffold(\n          body: Center(\n        child: Container(child: Lottie.asset('assets/lottie/animation.json')),\n      )),\n    );\n  }\n}\n\n```\n![lottie_3](https://user-images.githubusercontent.com/70128222/194988932-9bc79a97-f588-4bde-b4d0-b3e321c33e84.gif)\n\n\n我们可以使用[AnimationController](https://doc.flutterchina.club/tutorials/animation/#animationcontroller) 控制动画\n\n- forward() 启动\n- stop() 停止\n- reverse() 反向播放 \n\n``` dart\nimport 'package:flutter/material.dart';\nimport 'package:lottie/lottie.dart';\n\nvoid main() => runApp(LottieScreen());\n\nclass LottieScreen extends StatefulWidget {\n  LottieScreen({Key? key}) : super(key: key);\n  @override\n  State<StatefulWidget> createState() => _LottieScreenState();\n}\n\nclass _LottieScreenState extends State<LottieScreen>\n    with SingleTickerProviderStateMixin {\n  late AnimationController lottieController;\n\n  @override\n  void initState() {\n    super.initState();\n\n    lottieController = AnimationController(\n      vsync: this,\n    );\n\n    lottieController.addStatusListener((status) async {\n      if (status == AnimationStatus.completed) {\n        lottieController.reset();\n      }\n    });\n  }\n\n  @override\n  void dispose() {\n    lottieController.dispose();\n    super.dispose();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      home: Scaffold(\n          body: Center(\n        child: Column(children: [\n          Lottie.asset(\"assets/lottie/animation.json\",\n              repeat: false,\n              controller: lottieController, onLoaded: (composition) {\n            lottieController.duration = composition.duration;\n            lottieController.forward();\n          }),\n          const SizedBox(\n            height: 24,\n          ),\n          Row(\n            mainAxisAlignment: MainAxisAlignment.center,\n            children: [\n              RaisedButton(\n                onPressed: () {\n                  lottieController.forward();\n                },\n                child: Text(\"启动\"),\n              ),\n              RaisedButton(\n                onPressed: () {\n                  lottieController.stop();\n                },\n                child: Text(\"停止\"),\n              ),\n              RaisedButton(\n                onPressed: () {\n                  lottieController.reverse();\n                },\n                child: Text(\"反向播放\"),\n              ),\n            ],\n          )\n        ]),\n      )),\n    );\n  }\n}\n\n```\n![lottie_4](https://user-images.githubusercontent.com/70128222/194988949-b71849ca-26b7-4b0c-bcd2-b7e13471e25e.gif)\n\n\n### Vue中使用\n\n\n","source":"_posts/使用Lottie 让动画更简单.md","raw":"---\ntitle: 使用Lottie 让动画更简单\ntop_img: false\ndate: 2022-08-10\ncategories: \n- 前端\ntags:\n- 动画\ncover: https://user-images.githubusercontent.com/70128222/194988917-dc95c10c-a1b2-4dfb-b322-af1d8671e0de.png\n---\n\n## 介绍\n\n[Lottie](https://lottiefiles.com/what-is-lottie) 是Airbnb推出Library 它可将After Effects动画经由[Bodymovi](http://aescripts.com/bodymovin/)扩展插件输入成一个JSON动画文件格式, 适用于 Web、iOS、Android、Windows、QT、Tizen 和其他平台。\n![lottie_1](https://user-images.githubusercontent.com/70128222/194988904-25329ba5-3361-4007-9851-1d572d17efbd.gif)\n\n\n## 使用\n\n如果你有After Effects动画, 可通过AE插件[Bodymovi](http://aescripts.com/bodymovin/) 生成JSON动画\n\n没有After Effects动画可以让设计来制作, 或者学习制作~\n\n当然也可以使用 [Lottie Files](https://lottiefiles.com/featured) 提供的免费动画\n\n![lottie_2](https://user-images.githubusercontent.com/70128222/194988917-dc95c10c-a1b2-4dfb-b322-af1d8671e0de.png)\n\n\n接着从[Lottie Files](https://lottiefiles.com/featured)下载一个动画任意动画\n\n### Flutter中使用\n1. lottie json 放入项目assets 目录下\n2. 安装 [lottie](https://pub.dev/packages/lottie/install)\n``` yaml\ndependencies:\n  lottie: ^1.3.0 \n```\n3. 使用\n``` dart\nimport 'package:flutter/material.dart';\nimport 'package:lottie/lottie.dart';\n\nvoid main() => runApp(const MyApp());\n\nclass MyApp extends StatelessWidget {\n  const MyApp({Key? key}) : super(key: key);\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      home: Scaffold(\n          body: Center(\n        child: Container(child: Lottie.asset('assets/lottie/animation.json')),\n      )),\n    );\n  }\n}\n\n```\n![lottie_3](https://user-images.githubusercontent.com/70128222/194988932-9bc79a97-f588-4bde-b4d0-b3e321c33e84.gif)\n\n\n我们可以使用[AnimationController](https://doc.flutterchina.club/tutorials/animation/#animationcontroller) 控制动画\n\n- forward() 启动\n- stop() 停止\n- reverse() 反向播放 \n\n``` dart\nimport 'package:flutter/material.dart';\nimport 'package:lottie/lottie.dart';\n\nvoid main() => runApp(LottieScreen());\n\nclass LottieScreen extends StatefulWidget {\n  LottieScreen({Key? key}) : super(key: key);\n  @override\n  State<StatefulWidget> createState() => _LottieScreenState();\n}\n\nclass _LottieScreenState extends State<LottieScreen>\n    with SingleTickerProviderStateMixin {\n  late AnimationController lottieController;\n\n  @override\n  void initState() {\n    super.initState();\n\n    lottieController = AnimationController(\n      vsync: this,\n    );\n\n    lottieController.addStatusListener((status) async {\n      if (status == AnimationStatus.completed) {\n        lottieController.reset();\n      }\n    });\n  }\n\n  @override\n  void dispose() {\n    lottieController.dispose();\n    super.dispose();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return MaterialApp(\n      home: Scaffold(\n          body: Center(\n        child: Column(children: [\n          Lottie.asset(\"assets/lottie/animation.json\",\n              repeat: false,\n              controller: lottieController, onLoaded: (composition) {\n            lottieController.duration = composition.duration;\n            lottieController.forward();\n          }),\n          const SizedBox(\n            height: 24,\n          ),\n          Row(\n            mainAxisAlignment: MainAxisAlignment.center,\n            children: [\n              RaisedButton(\n                onPressed: () {\n                  lottieController.forward();\n                },\n                child: Text(\"启动\"),\n              ),\n              RaisedButton(\n                onPressed: () {\n                  lottieController.stop();\n                },\n                child: Text(\"停止\"),\n              ),\n              RaisedButton(\n                onPressed: () {\n                  lottieController.reverse();\n                },\n                child: Text(\"反向播放\"),\n              ),\n            ],\n          )\n        ]),\n      )),\n    );\n  }\n}\n\n```\n![lottie_4](https://user-images.githubusercontent.com/70128222/194988949-b71849ca-26b7-4b0c-bcd2-b7e13471e25e.gif)\n\n\n### Vue中使用\n\n\n","slug":"使用Lottie 让动画更简单","published":1,"updated":"2022-11-07T06:30:35.313Z","_id":"cla6che5n0005ys7736ybbmw7","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p><a href=\"https://lottiefiles.com/what-is-lottie\">Lottie</a> 是Airbnb推出Library 它可将After Effects动画经由<a href=\"http://aescripts.com/bodymovin/\">Bodymovi</a>扩展插件输入成一个JSON动画文件格式, 适用于 Web、iOS、Android、Windows、QT、Tizen 和其他平台。<br><img src=\"https://user-images.githubusercontent.com/70128222/194988904-25329ba5-3361-4007-9851-1d572d17efbd.gif\" alt=\"lottie_1\"></p>\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>如果你有After Effects动画, 可通过AE插件<a href=\"http://aescripts.com/bodymovin/\">Bodymovi</a> 生成JSON动画</p>\n<p>没有After Effects动画可以让设计来制作, 或者学习制作~</p>\n<p>当然也可以使用 <a href=\"https://lottiefiles.com/featured\">Lottie Files</a> 提供的免费动画</p>\n<p><img src=\"https://user-images.githubusercontent.com/70128222/194988917-dc95c10c-a1b2-4dfb-b322-af1d8671e0de.png\" alt=\"lottie_2\"></p>\n<p>接着从<a href=\"https://lottiefiles.com/featured\">Lottie Files</a>下载一个动画任意动画</p>\n<h3 id=\"Flutter中使用\"><a href=\"#Flutter中使用\" class=\"headerlink\" title=\"Flutter中使用\"></a>Flutter中使用</h3><ol>\n<li>lottie json 放入项目assets 目录下</li>\n<li>安装 <a href=\"https://pub.dev/packages/lottie/install\">lottie</a><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dependencies:</span></span><br><span class=\"line\">  <span class=\"attr\">lottie:</span> <span class=\"string\">^1.3.0</span> </span><br></pre></td></tr></table></figure></li>\n<li>使用<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:lottie/lottie.dart&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> main() =&gt; runApp(<span class=\"keyword\">const</span> MyApp());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> MyApp(&#123;Key? key&#125;) : <span class=\"keyword\">super</span>(key: key);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MaterialApp(</span><br><span class=\"line\">      home: Scaffold(</span><br><span class=\"line\">          body: Center(</span><br><span class=\"line\">        child: Container(child: Lottie.asset(<span class=\"string\">&#x27;assets/lottie/animation.json&#x27;</span>)),</span><br><span class=\"line\">      )),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<img src=\"https://user-images.githubusercontent.com/70128222/194988932-9bc79a97-f588-4bde-b4d0-b3e321c33e84.gif\" alt=\"lottie_3\"></li>\n</ol>\n<p>我们可以使用<a href=\"https://doc.flutterchina.club/tutorials/animation/#animationcontroller\">AnimationController</a> 控制动画</p>\n<ul>\n<li>forward() 启动</li>\n<li>stop() 停止</li>\n<li>reverse() 反向播放 </li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:lottie/lottie.dart&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> main() =&gt; runApp(LottieScreen());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LottieScreen</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  LottieScreen(&#123;Key? key&#125;) : <span class=\"keyword\">super</span>(key: key);</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;StatefulWidget&gt; createState() =&gt; _LottieScreenState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_LottieScreenState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">LottieScreen</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    <span class=\"title\">with</span> <span class=\"title\">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">late</span> AnimationController lottieController;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> initState() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.initState();</span><br><span class=\"line\"></span><br><span class=\"line\">    lottieController = AnimationController(</span><br><span class=\"line\">      vsync: <span class=\"keyword\">this</span>,</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    lottieController.addStatusListener((status) <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (status == AnimationStatus.completed) &#123;</span><br><span class=\"line\">        lottieController.reset();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> dispose() &#123;</span><br><span class=\"line\">    lottieController.dispose();</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.dispose();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MaterialApp(</span><br><span class=\"line\">      home: Scaffold(</span><br><span class=\"line\">          body: Center(</span><br><span class=\"line\">        child: Column(children: [</span><br><span class=\"line\">          Lottie.asset(<span class=\"string\">&quot;assets/lottie/animation.json&quot;</span>,</span><br><span class=\"line\">              repeat: <span class=\"keyword\">false</span>,</span><br><span class=\"line\">              controller: lottieController, onLoaded: (composition) &#123;</span><br><span class=\"line\">            lottieController.duration = composition.duration;</span><br><span class=\"line\">            lottieController.forward();</span><br><span class=\"line\">          &#125;),</span><br><span class=\"line\">          <span class=\"keyword\">const</span> SizedBox(</span><br><span class=\"line\">            height: <span class=\"number\">24</span>,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Row(</span><br><span class=\"line\">            mainAxisAlignment: MainAxisAlignment.center,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              RaisedButton(</span><br><span class=\"line\">                onPressed: () &#123;</span><br><span class=\"line\">                  lottieController.forward();</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                child: Text(<span class=\"string\">&quot;启动&quot;</span>),</span><br><span class=\"line\">              ),</span><br><span class=\"line\">              RaisedButton(</span><br><span class=\"line\">                onPressed: () &#123;</span><br><span class=\"line\">                  lottieController.stop();</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                child: Text(<span class=\"string\">&quot;停止&quot;</span>),</span><br><span class=\"line\">              ),</span><br><span class=\"line\">              RaisedButton(</span><br><span class=\"line\">                onPressed: () &#123;</span><br><span class=\"line\">                  lottieController.reverse();</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                child: Text(<span class=\"string\">&quot;反向播放&quot;</span>),</span><br><span class=\"line\">              ),</span><br><span class=\"line\">            ],</span><br><span class=\"line\">          )</span><br><span class=\"line\">        ]),</span><br><span class=\"line\">      )),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://user-images.githubusercontent.com/70128222/194988949-b71849ca-26b7-4b0c-bcd2-b7e13471e25e.gif\" alt=\"lottie_4\"></p>\n<h3 id=\"Vue中使用\"><a href=\"#Vue中使用\" class=\"headerlink\" title=\"Vue中使用\"></a>Vue中使用</h3>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"介绍\"><a href=\"#介绍\" class=\"headerlink\" title=\"介绍\"></a>介绍</h2><p><a href=\"https://lottiefiles.com/what-is-lottie\">Lottie</a> 是Airbnb推出Library 它可将After Effects动画经由<a href=\"http://aescripts.com/bodymovin/\">Bodymovi</a>扩展插件输入成一个JSON动画文件格式, 适用于 Web、iOS、Android、Windows、QT、Tizen 和其他平台。<br><img src=\"https://user-images.githubusercontent.com/70128222/194988904-25329ba5-3361-4007-9851-1d572d17efbd.gif\" alt=\"lottie_1\"></p>\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>如果你有After Effects动画, 可通过AE插件<a href=\"http://aescripts.com/bodymovin/\">Bodymovi</a> 生成JSON动画</p>\n<p>没有After Effects动画可以让设计来制作, 或者学习制作~</p>\n<p>当然也可以使用 <a href=\"https://lottiefiles.com/featured\">Lottie Files</a> 提供的免费动画</p>\n<p><img src=\"https://user-images.githubusercontent.com/70128222/194988917-dc95c10c-a1b2-4dfb-b322-af1d8671e0de.png\" alt=\"lottie_2\"></p>\n<p>接着从<a href=\"https://lottiefiles.com/featured\">Lottie Files</a>下载一个动画任意动画</p>\n<h3 id=\"Flutter中使用\"><a href=\"#Flutter中使用\" class=\"headerlink\" title=\"Flutter中使用\"></a>Flutter中使用</h3><ol>\n<li>lottie json 放入项目assets 目录下</li>\n<li>安装 <a href=\"https://pub.dev/packages/lottie/install\">lottie</a><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dependencies:</span></span><br><span class=\"line\">  <span class=\"attr\">lottie:</span> <span class=\"string\">^1.3.0</span> </span><br></pre></td></tr></table></figure></li>\n<li>使用<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:lottie/lottie.dart&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> main() =&gt; runApp(<span class=\"keyword\">const</span> MyApp());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MyApp</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatelessWidget</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> MyApp(&#123;Key? key&#125;) : <span class=\"keyword\">super</span>(key: key);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MaterialApp(</span><br><span class=\"line\">      home: Scaffold(</span><br><span class=\"line\">          body: Center(</span><br><span class=\"line\">        child: Container(child: Lottie.asset(<span class=\"string\">&#x27;assets/lottie/animation.json&#x27;</span>)),</span><br><span class=\"line\">      )),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<img src=\"https://user-images.githubusercontent.com/70128222/194988932-9bc79a97-f588-4bde-b4d0-b3e321c33e84.gif\" alt=\"lottie_3\"></li>\n</ol>\n<p>我们可以使用<a href=\"https://doc.flutterchina.club/tutorials/animation/#animationcontroller\">AnimationController</a> 控制动画</p>\n<ul>\n<li>forward() 启动</li>\n<li>stop() 停止</li>\n<li>reverse() 反向播放 </li>\n</ul>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:flutter/material.dart&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;package:lottie/lottie.dart&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> main() =&gt; runApp(LottieScreen());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">LottieScreen</span> <span class=\"keyword\">extends</span> <span class=\"title\">StatefulWidget</span> </span>&#123;</span><br><span class=\"line\">  LottieScreen(&#123;Key? key&#125;) : <span class=\"keyword\">super</span>(key: key);</span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  State&lt;StatefulWidget&gt; createState() =&gt; _LottieScreenState();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">_LottieScreenState</span> <span class=\"keyword\">extends</span> <span class=\"title\">State</span>&lt;<span class=\"title\">LottieScreen</span>&gt;</span></span><br><span class=\"line\"><span class=\"class\">    <span class=\"title\">with</span> <span class=\"title\">SingleTickerProviderStateMixin</span> </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">late</span> AnimationController lottieController;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> initState() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.initState();</span><br><span class=\"line\"></span><br><span class=\"line\">    lottieController = AnimationController(</span><br><span class=\"line\">      vsync: <span class=\"keyword\">this</span>,</span><br><span class=\"line\">    );</span><br><span class=\"line\"></span><br><span class=\"line\">    lottieController.addStatusListener((status) <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">if</span> (status == AnimationStatus.completed) &#123;</span><br><span class=\"line\">        lottieController.reset();</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  <span class=\"keyword\">void</span> dispose() &#123;</span><br><span class=\"line\">    lottieController.dispose();</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.dispose();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"meta\">@override</span></span><br><span class=\"line\">  Widget build(BuildContext context) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> MaterialApp(</span><br><span class=\"line\">      home: Scaffold(</span><br><span class=\"line\">          body: Center(</span><br><span class=\"line\">        child: Column(children: [</span><br><span class=\"line\">          Lottie.asset(<span class=\"string\">&quot;assets/lottie/animation.json&quot;</span>,</span><br><span class=\"line\">              repeat: <span class=\"keyword\">false</span>,</span><br><span class=\"line\">              controller: lottieController, onLoaded: (composition) &#123;</span><br><span class=\"line\">            lottieController.duration = composition.duration;</span><br><span class=\"line\">            lottieController.forward();</span><br><span class=\"line\">          &#125;),</span><br><span class=\"line\">          <span class=\"keyword\">const</span> SizedBox(</span><br><span class=\"line\">            height: <span class=\"number\">24</span>,</span><br><span class=\"line\">          ),</span><br><span class=\"line\">          Row(</span><br><span class=\"line\">            mainAxisAlignment: MainAxisAlignment.center,</span><br><span class=\"line\">            children: [</span><br><span class=\"line\">              RaisedButton(</span><br><span class=\"line\">                onPressed: () &#123;</span><br><span class=\"line\">                  lottieController.forward();</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                child: Text(<span class=\"string\">&quot;启动&quot;</span>),</span><br><span class=\"line\">              ),</span><br><span class=\"line\">              RaisedButton(</span><br><span class=\"line\">                onPressed: () &#123;</span><br><span class=\"line\">                  lottieController.stop();</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                child: Text(<span class=\"string\">&quot;停止&quot;</span>),</span><br><span class=\"line\">              ),</span><br><span class=\"line\">              RaisedButton(</span><br><span class=\"line\">                onPressed: () &#123;</span><br><span class=\"line\">                  lottieController.reverse();</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                child: Text(<span class=\"string\">&quot;反向播放&quot;</span>),</span><br><span class=\"line\">              ),</span><br><span class=\"line\">            ],</span><br><span class=\"line\">          )</span><br><span class=\"line\">        ]),</span><br><span class=\"line\">      )),</span><br><span class=\"line\">    );</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://user-images.githubusercontent.com/70128222/194988949-b71849ca-26b7-4b0c-bcd2-b7e13471e25e.gif\" alt=\"lottie_4\"></p>\n<h3 id=\"Vue中使用\"><a href=\"#Vue中使用\" class=\"headerlink\" title=\"Vue中使用\"></a>Vue中使用</h3>"},{"title":"Flutter 启动页实现","top_img":false,"date":"2022-06-09T16:00:00.000Z","cover":"https://img1.baidu.com/it/u=1855083458,281793390&fm=253&fmt=auto&app=138&f=JPEG?w=989&h=500","_content":"\n## 前言\n> 应用开启时, 会出现短暂白屏才会出现加载后页面, 给用户的感觉也不好\n\n## 原生\n...\n\n## Pub 插件\n\n这里使用[flutter_native_splash](https://pub.dev/packages/flutter_native_splash)\n\n1. 安装依赖\n``` yaml\ndependencies:\n  flutter:\n    sdk: flutter\n  ...\n  flutter_native_splash: ^2.1.6\n```\n\n2. 设置 pubspec.yaml\n\n- image: 图片\n- color: 背景颜色 用于图片不能充满屏幕\n- android: true 生成 andorid\n- ios: true 生成 ios\n- android_gravity: \"fill\" // 铺满\n- ios_content_mode: \"scaleAspectFit\" // 铺满\n- ...\n``` yaml\nflutter_native_splash:\n  image: assets/images/splash.png\n  color: \"#ffffff\"\n  android: true\n  ios: true\n  android_gravity: \"fill\"\n  ios_content_mode: \"scaleAspectFit\"\n```\n\n3. 生成启动页\n\n``` \nflutter pub pub run flutter_native_splash:create\n```\n\n```\n[Android] Creating splash images\n[Android] Creating dark mode splash images\n[Android] Updating launch background(s) with splash image path...\n[Android]  - android/app/src/main/res/drawable/launch_background.xml\n[Android]  - android/app/src/main/res/drawable-v21/launch_background.xml\n[Android] Updating styles...\n[Android]  - android/app/src/main/res/values-v31/styles.xml\n[Android] No android/app/src/main/res/values-v31/styles.xml found in your Android project\n[Android] Creating android/app/src/main/res/values-v31/styles.xml and adding it to your Android project\n[Android]  - android/app/src/main/res/values/styles.xml\n[iOS] Creating images\n[iOS] Creating dark mode images\n[iOS] Updating LaunchScreen.storyboard with width, and height\n[iOS] Updating ios/Runner/Info.plist for status bar hidden/visible\nWeb folder not found, skipping web splash update...\n╔════════════════════════════════════════════════════════════════════════════╗\n║                                 WHAT IS NEW:                               ║\n╠════════════════════════════════════════════════════════════════════════════╣\n║ You can now keep the splash screen up while your app initializes!          ║\n║ No need for a secondary splash screen anymore. Just use the remove()       ║\n║ method to remove the splash screen after your initialization is complete.  ║\n║ Check the docs for more info.                                              ║\n╚════════════════════════════════════════════════════════════════════════════╝\n\n✅ Native splash complete.\nNow go finish building something awesome! 💪 You rock! 🤘🤩\nLike the package? Please give it a 👍 here: https://pub.dev/packages/flutter_native_splash\n```\n\n预览\n\n![1](https://user-images.githubusercontent.com/70128222/194988713-6bde2f1e-7799-4497-a3b5-ca402e1cd48f.gif)\n\n\n当然[flutter_native_splash](https://pub.dev/packages/flutter_native_splash)也提供了方法让我们主动调用关闭，我们可以初始化数据等耗时操作执行完主动关闭\n\n``` dart\nvoid main() async {\n  WidgetsBinding widgetsBinding = WidgetsFlutterBinding.ensureInitialized();\n  // 启动页设置手动关闭\n  FlutterNativeSplash.preserve(widgetsBinding: widgetsBinding);\n  runApp(App());\n  // 模拟初始化数据等待5s\n  await Future.delayed(Duration(seconds: 3));\n  // 启动页设置关闭\n  FlutterNativeSplash.remove();\n}\n```\n\n![2](https://user-images.githubusercontent.com/70128222/194988732-f1b3b03a-6cf8-437b-9fa1-3ac031435de9.gif)\n\n\n## 完结\n如果遇到改状态栏等 就需要原生解决了～\n\n简单需求flutter_native_splash还是能满足的","source":"_posts/Flutter 启动页实现.md","raw":"---\ntitle: Flutter 启动页实现\ntop_img: false \ndate: 2022-06-10\ncategories: \n- 前端\ntags:\n- Flutter\ncover: https://img1.baidu.com/it/u=1855083458,281793390&fm=253&fmt=auto&app=138&f=JPEG?w=989&h=500\n---\n\n## 前言\n> 应用开启时, 会出现短暂白屏才会出现加载后页面, 给用户的感觉也不好\n\n## 原生\n...\n\n## Pub 插件\n\n这里使用[flutter_native_splash](https://pub.dev/packages/flutter_native_splash)\n\n1. 安装依赖\n``` yaml\ndependencies:\n  flutter:\n    sdk: flutter\n  ...\n  flutter_native_splash: ^2.1.6\n```\n\n2. 设置 pubspec.yaml\n\n- image: 图片\n- color: 背景颜色 用于图片不能充满屏幕\n- android: true 生成 andorid\n- ios: true 生成 ios\n- android_gravity: \"fill\" // 铺满\n- ios_content_mode: \"scaleAspectFit\" // 铺满\n- ...\n``` yaml\nflutter_native_splash:\n  image: assets/images/splash.png\n  color: \"#ffffff\"\n  android: true\n  ios: true\n  android_gravity: \"fill\"\n  ios_content_mode: \"scaleAspectFit\"\n```\n\n3. 生成启动页\n\n``` \nflutter pub pub run flutter_native_splash:create\n```\n\n```\n[Android] Creating splash images\n[Android] Creating dark mode splash images\n[Android] Updating launch background(s) with splash image path...\n[Android]  - android/app/src/main/res/drawable/launch_background.xml\n[Android]  - android/app/src/main/res/drawable-v21/launch_background.xml\n[Android] Updating styles...\n[Android]  - android/app/src/main/res/values-v31/styles.xml\n[Android] No android/app/src/main/res/values-v31/styles.xml found in your Android project\n[Android] Creating android/app/src/main/res/values-v31/styles.xml and adding it to your Android project\n[Android]  - android/app/src/main/res/values/styles.xml\n[iOS] Creating images\n[iOS] Creating dark mode images\n[iOS] Updating LaunchScreen.storyboard with width, and height\n[iOS] Updating ios/Runner/Info.plist for status bar hidden/visible\nWeb folder not found, skipping web splash update...\n╔════════════════════════════════════════════════════════════════════════════╗\n║                                 WHAT IS NEW:                               ║\n╠════════════════════════════════════════════════════════════════════════════╣\n║ You can now keep the splash screen up while your app initializes!          ║\n║ No need for a secondary splash screen anymore. Just use the remove()       ║\n║ method to remove the splash screen after your initialization is complete.  ║\n║ Check the docs for more info.                                              ║\n╚════════════════════════════════════════════════════════════════════════════╝\n\n✅ Native splash complete.\nNow go finish building something awesome! 💪 You rock! 🤘🤩\nLike the package? Please give it a 👍 here: https://pub.dev/packages/flutter_native_splash\n```\n\n预览\n\n![1](https://user-images.githubusercontent.com/70128222/194988713-6bde2f1e-7799-4497-a3b5-ca402e1cd48f.gif)\n\n\n当然[flutter_native_splash](https://pub.dev/packages/flutter_native_splash)也提供了方法让我们主动调用关闭，我们可以初始化数据等耗时操作执行完主动关闭\n\n``` dart\nvoid main() async {\n  WidgetsBinding widgetsBinding = WidgetsFlutterBinding.ensureInitialized();\n  // 启动页设置手动关闭\n  FlutterNativeSplash.preserve(widgetsBinding: widgetsBinding);\n  runApp(App());\n  // 模拟初始化数据等待5s\n  await Future.delayed(Duration(seconds: 3));\n  // 启动页设置关闭\n  FlutterNativeSplash.remove();\n}\n```\n\n![2](https://user-images.githubusercontent.com/70128222/194988732-f1b3b03a-6cf8-437b-9fa1-3ac031435de9.gif)\n\n\n## 完结\n如果遇到改状态栏等 就需要原生解决了～\n\n简单需求flutter_native_splash还是能满足的","slug":"Flutter 启动页实现","published":1,"updated":"2022-11-07T06:34:47.817Z","_id":"cla6che5o0006ys7762sv411w","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><blockquote>\n<p>应用开启时, 会出现短暂白屏才会出现加载后页面, 给用户的感觉也不好</p>\n</blockquote>\n<h2 id=\"原生\"><a href=\"#原生\" class=\"headerlink\" title=\"原生\"></a>原生</h2><p>…</p>\n<h2 id=\"Pub-插件\"><a href=\"#Pub-插件\" class=\"headerlink\" title=\"Pub 插件\"></a>Pub 插件</h2><p>这里使用<a href=\"https://pub.dev/packages/flutter_native_splash\">flutter_native_splash</a></p>\n<ol>\n<li><p>安装依赖</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dependencies:</span></span><br><span class=\"line\">  <span class=\"attr\">flutter:</span></span><br><span class=\"line\">    <span class=\"attr\">sdk:</span> <span class=\"string\">flutter</span></span><br><span class=\"line\">  <span class=\"string\">...</span></span><br><span class=\"line\">  <span class=\"attr\">flutter_native_splash:</span> <span class=\"string\">^2.1.6</span></span><br></pre></td></tr></table></figure></li>\n<li><p>设置 pubspec.yaml</p>\n</li>\n</ol>\n<ul>\n<li>image: 图片</li>\n<li>color: 背景颜色 用于图片不能充满屏幕</li>\n<li>android: true 生成 andorid</li>\n<li>ios: true 生成 ios</li>\n<li>android_gravity: “fill” // 铺满</li>\n<li>ios_content_mode: “scaleAspectFit” // 铺满</li>\n<li>…<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">flutter_native_splash:</span></span><br><span class=\"line\">  <span class=\"attr\">image:</span> <span class=\"string\">assets/images/splash.png</span></span><br><span class=\"line\">  <span class=\"attr\">color:</span> <span class=\"string\">&quot;#ffffff&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">android:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">ios:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">android_gravity:</span> <span class=\"string\">&quot;fill&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">ios_content_mode:</span> <span class=\"string\">&quot;scaleAspectFit&quot;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<ol start=\"3\">\n<li>生成启动页</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flutter pub pub run flutter_native_splash:create</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Android] Creating splash images</span><br><span class=\"line\">[Android] Creating dark mode splash images</span><br><span class=\"line\">[Android] Updating launch background(s) with splash image path...</span><br><span class=\"line\">[Android]  - android/app/src/main/res/drawable/launch_background.xml</span><br><span class=\"line\">[Android]  - android/app/src/main/res/drawable-v21/launch_background.xml</span><br><span class=\"line\">[Android] Updating styles...</span><br><span class=\"line\">[Android]  - android/app/src/main/res/values-v31/styles.xml</span><br><span class=\"line\">[Android] No android/app/src/main/res/values-v31/styles.xml found in your Android project</span><br><span class=\"line\">[Android] Creating android/app/src/main/res/values-v31/styles.xml and adding it to your Android project</span><br><span class=\"line\">[Android]  - android/app/src/main/res/values/styles.xml</span><br><span class=\"line\">[iOS] Creating images</span><br><span class=\"line\">[iOS] Creating dark mode images</span><br><span class=\"line\">[iOS] Updating LaunchScreen.storyboard with width, and height</span><br><span class=\"line\">[iOS] Updating ios/Runner/Info.plist for status bar hidden/visible</span><br><span class=\"line\">Web folder not found, skipping web splash update...</span><br><span class=\"line\">╔════════════════════════════════════════════════════════════════════════════╗</span><br><span class=\"line\">║                                 WHAT IS NEW:                               ║</span><br><span class=\"line\">╠════════════════════════════════════════════════════════════════════════════╣</span><br><span class=\"line\">║ You can now keep the splash screen up while your app initializes!          ║</span><br><span class=\"line\">║ No need for a secondary splash screen anymore. Just use the remove()       ║</span><br><span class=\"line\">║ method to remove the splash screen after your initialization is complete.  ║</span><br><span class=\"line\">║ Check the docs for more info.                                              ║</span><br><span class=\"line\">╚════════════════════════════════════════════════════════════════════════════╝</span><br><span class=\"line\"></span><br><span class=\"line\">✅ Native splash complete.</span><br><span class=\"line\">Now go finish building something awesome! 💪 You rock! 🤘🤩</span><br><span class=\"line\">Like the package? Please give it a 👍 here: https://pub.dev/packages/flutter_native_splash</span><br></pre></td></tr></table></figure>\n\n<p>预览</p>\n<p><img src=\"https://user-images.githubusercontent.com/70128222/194988713-6bde2f1e-7799-4497-a3b5-ca402e1cd48f.gif\" alt=\"1\"></p>\n<p>当然<a href=\"https://pub.dev/packages/flutter_native_splash\">flutter_native_splash</a>也提供了方法让我们主动调用关闭，我们可以初始化数据等耗时操作执行完主动关闭</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> main() <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">  WidgetsBinding widgetsBinding = WidgetsFlutterBinding.ensureInitialized();</span><br><span class=\"line\">  <span class=\"comment\">// 启动页设置手动关闭</span></span><br><span class=\"line\">  FlutterNativeSplash.preserve(widgetsBinding: widgetsBinding);</span><br><span class=\"line\">  runApp(App());</span><br><span class=\"line\">  <span class=\"comment\">// 模拟初始化数据等待5s</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> Future.delayed(<span class=\"built_in\">Duration</span>(seconds: <span class=\"number\">3</span>));</span><br><span class=\"line\">  <span class=\"comment\">// 启动页设置关闭</span></span><br><span class=\"line\">  FlutterNativeSplash.remove();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://user-images.githubusercontent.com/70128222/194988732-f1b3b03a-6cf8-437b-9fa1-3ac031435de9.gif\" alt=\"2\"></p>\n<h2 id=\"完结\"><a href=\"#完结\" class=\"headerlink\" title=\"完结\"></a>完结</h2><p>如果遇到改状态栏等 就需要原生解决了～</p>\n<p>简单需求flutter_native_splash还是能满足的</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><blockquote>\n<p>应用开启时, 会出现短暂白屏才会出现加载后页面, 给用户的感觉也不好</p>\n</blockquote>\n<h2 id=\"原生\"><a href=\"#原生\" class=\"headerlink\" title=\"原生\"></a>原生</h2><p>…</p>\n<h2 id=\"Pub-插件\"><a href=\"#Pub-插件\" class=\"headerlink\" title=\"Pub 插件\"></a>Pub 插件</h2><p>这里使用<a href=\"https://pub.dev/packages/flutter_native_splash\">flutter_native_splash</a></p>\n<ol>\n<li><p>安装依赖</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">dependencies:</span></span><br><span class=\"line\">  <span class=\"attr\">flutter:</span></span><br><span class=\"line\">    <span class=\"attr\">sdk:</span> <span class=\"string\">flutter</span></span><br><span class=\"line\">  <span class=\"string\">...</span></span><br><span class=\"line\">  <span class=\"attr\">flutter_native_splash:</span> <span class=\"string\">^2.1.6</span></span><br></pre></td></tr></table></figure></li>\n<li><p>设置 pubspec.yaml</p>\n</li>\n</ol>\n<ul>\n<li>image: 图片</li>\n<li>color: 背景颜色 用于图片不能充满屏幕</li>\n<li>android: true 生成 andorid</li>\n<li>ios: true 生成 ios</li>\n<li>android_gravity: “fill” // 铺满</li>\n<li>ios_content_mode: “scaleAspectFit” // 铺满</li>\n<li>…<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">flutter_native_splash:</span></span><br><span class=\"line\">  <span class=\"attr\">image:</span> <span class=\"string\">assets/images/splash.png</span></span><br><span class=\"line\">  <span class=\"attr\">color:</span> <span class=\"string\">&quot;#ffffff&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">android:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">ios:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">android_gravity:</span> <span class=\"string\">&quot;fill&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">ios_content_mode:</span> <span class=\"string\">&quot;scaleAspectFit&quot;</span></span><br></pre></td></tr></table></figure></li>\n</ul>\n<ol start=\"3\">\n<li>生成启动页</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flutter pub pub run flutter_native_splash:create</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[Android] Creating splash images</span><br><span class=\"line\">[Android] Creating dark mode splash images</span><br><span class=\"line\">[Android] Updating launch background(s) with splash image path...</span><br><span class=\"line\">[Android]  - android/app/src/main/res/drawable/launch_background.xml</span><br><span class=\"line\">[Android]  - android/app/src/main/res/drawable-v21/launch_background.xml</span><br><span class=\"line\">[Android] Updating styles...</span><br><span class=\"line\">[Android]  - android/app/src/main/res/values-v31/styles.xml</span><br><span class=\"line\">[Android] No android/app/src/main/res/values-v31/styles.xml found in your Android project</span><br><span class=\"line\">[Android] Creating android/app/src/main/res/values-v31/styles.xml and adding it to your Android project</span><br><span class=\"line\">[Android]  - android/app/src/main/res/values/styles.xml</span><br><span class=\"line\">[iOS] Creating images</span><br><span class=\"line\">[iOS] Creating dark mode images</span><br><span class=\"line\">[iOS] Updating LaunchScreen.storyboard with width, and height</span><br><span class=\"line\">[iOS] Updating ios/Runner/Info.plist for status bar hidden/visible</span><br><span class=\"line\">Web folder not found, skipping web splash update...</span><br><span class=\"line\">╔════════════════════════════════════════════════════════════════════════════╗</span><br><span class=\"line\">║                                 WHAT IS NEW:                               ║</span><br><span class=\"line\">╠════════════════════════════════════════════════════════════════════════════╣</span><br><span class=\"line\">║ You can now keep the splash screen up while your app initializes!          ║</span><br><span class=\"line\">║ No need for a secondary splash screen anymore. Just use the remove()       ║</span><br><span class=\"line\">║ method to remove the splash screen after your initialization is complete.  ║</span><br><span class=\"line\">║ Check the docs for more info.                                              ║</span><br><span class=\"line\">╚════════════════════════════════════════════════════════════════════════════╝</span><br><span class=\"line\"></span><br><span class=\"line\">✅ Native splash complete.</span><br><span class=\"line\">Now go finish building something awesome! 💪 You rock! 🤘🤩</span><br><span class=\"line\">Like the package? Please give it a 👍 here: https://pub.dev/packages/flutter_native_splash</span><br></pre></td></tr></table></figure>\n\n<p>预览</p>\n<p><img src=\"https://user-images.githubusercontent.com/70128222/194988713-6bde2f1e-7799-4497-a3b5-ca402e1cd48f.gif\" alt=\"1\"></p>\n<p>当然<a href=\"https://pub.dev/packages/flutter_native_splash\">flutter_native_splash</a>也提供了方法让我们主动调用关闭，我们可以初始化数据等耗时操作执行完主动关闭</p>\n<figure class=\"highlight dart\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> main() <span class=\"keyword\">async</span> &#123;</span><br><span class=\"line\">  WidgetsBinding widgetsBinding = WidgetsFlutterBinding.ensureInitialized();</span><br><span class=\"line\">  <span class=\"comment\">// 启动页设置手动关闭</span></span><br><span class=\"line\">  FlutterNativeSplash.preserve(widgetsBinding: widgetsBinding);</span><br><span class=\"line\">  runApp(App());</span><br><span class=\"line\">  <span class=\"comment\">// 模拟初始化数据等待5s</span></span><br><span class=\"line\">  <span class=\"keyword\">await</span> Future.delayed(<span class=\"built_in\">Duration</span>(seconds: <span class=\"number\">3</span>));</span><br><span class=\"line\">  <span class=\"comment\">// 启动页设置关闭</span></span><br><span class=\"line\">  FlutterNativeSplash.remove();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://user-images.githubusercontent.com/70128222/194988732-f1b3b03a-6cf8-437b-9fa1-3ac031435de9.gif\" alt=\"2\"></p>\n<h2 id=\"完结\"><a href=\"#完结\" class=\"headerlink\" title=\"完结\"></a>完结</h2><p>如果遇到改状态栏等 就需要原生解决了～</p>\n<p>简单需求flutter_native_splash还是能满足的</p>\n"},{"title":"前端业务埋点-SDK实践","date":"2022-11-04T16:00:00.000Z","cover":"https://user-images.githubusercontent.com/70128222/200491092-d00d8a32-5b63-40b9-96c3-fcc92de8716d.png","_content":"\n> 最近项目需要采集用户的行为数据, 从而进行分析得到页面点击量、访问量、访问路径等重要数据, 为运营和业务人员提供精准数据，为产品优化和精细化运营提供数据支持。\n\n![1111](https://user-images.githubusercontent.com/70128222/200491092-d00d8a32-5b63-40b9-96c3-fcc92de8716d.png)\n\n## 埋点方式选择\n\n这里采用代码侵入式埋点的方式进行、 SDK 提供 点击事件、曝光事件、页面时长进行上报\n\n- 点击事件(用户每点击一次按钮、商品、区块.. 就记录一次数据)\n- 曝光事件(专区、活动、商品...用户可见)\n- 页面时长(活动、页面 停留时间)\n\n---\n\n## 埋点方式实现\n\n### 点击事件\n\n如何让前端同事更轻松的捕获数据、这里实现了 dom 自定义事件实现自动上报, 在 vue 中也提供了指令 如有特殊业务场景也可以使用手动进行上报。\n\n```js\n// 自动上报\n// js\n\n// vue\n<button v-track:click=\"{\n  'page_id': 1,\n  'event_type': 12, // 事件类型\n  'objs' // 业务数据\n  }\"\n/>\n\n<button v-track:keyup=\"{\n  'page_id': 2,\n  'event_type': 12, // 事件类型\n  'objs' // 业务数据\n  }\"\n/>\n\n// 手动上报\ntrakerSDK.sendTracker({\n  'page_id': 3,\n  'event_type': 12,\n  'object_ids': [1, 2, 3]\n});\n```\n\n### 页面时长\n\n页面时长统计, 我们可以用时间戳来算出用户停留的页面时长。\n页面离开 - 页面进入 = 停留时长。\n\n```js\n// 单页应用\nrouter.beforeEach((to, from, next) => {\n  // 获取当前时间\n  const timestamp = new Date().getTime();\n  // 上次时间\n  const pretimestamp = getCache(LocalStoreEnum.PRE_TIMESTAMP);\n  // 存入当前时间\n  setCache(LocalStoreEnum.PRE_TIMESTAMP, timestamp);\n\n  // 停留时间(s)\n  let secound = (timestamp - pretimestamp) / 1000;\n  next();\n});\n```\n\n> 这样的话大多数场景都能够满足, 但是还有特殊场景无法满足。\n> 如 PC 端 浏览器 Tab 选项卡切换、 APP 切换应用等。\n> 这时候就需要另外的方案, [Page Visibility API](http://www.ruanyifeng.com/blog/2018/10/page_visibility_api.html) 能够解决这个问题\n\n```js\ndocument.addEventListener(\"visibilitychange\", () => {\n  const state = document.visibilityState;\n  let callbackData: any = null;\n  if (state === \"hidden\") {\n    // 页面不可见\n  }\n  if (state === \"visible\") {\n    // 页面可见\n  }\n\n  // 如果业务需要 时间超过1小时 则算是新开页面 自行判断\n});\n```\n\n### 曝光\n\n---\n\n## 埋点上报\n\n[埋点上报](https://hello7cat.com/2022/11/10/前端业务埋点数据上报/)\n---\n\n## SDK\n\n### 初始化\n\n### 参数\n\n| 参数                   | 必填 | 默认值 | 类型   |                                                                       |\n| ---------------------- | ---- | ------ | ------ | --------------------------------------------------------------------- |\n| debug                  | 否   | false  | bool   | 开启调试模式                                                          |\n| config                 | 否   | object | {}     | 你的配置文件, 会在上报时传给后端                                      |\n| url                    | 是   | ''     | string | 请求地址                                                              |\n| method                 | 否   | img    | string | 请求方式 GET、POST、SEND_BEACON                                       |\n| enableHeatMap          | 否   | false  | bool   | 开启坐标上传 position                                                 |\n| enableVisibilitychange | 否   | false  | bool   | 开启页面可见监听, 如开启此功能 registerVueRouterEvent 传参可能为 null |\n\n### 方法\n\n| 方法名                 | 说明                  | 参数                                                             |\n| ---------------------- | --------------------- | ---------------------------------------------------------------- |\n| setConfig              | 设置全局参数          | Options                                                          |\n| sendTracker            | 手动上报              | {自定义}                                                         |\n| initDirectives         | 初始化 vue2 指令      | Vue                                                              |\n| registerVueRouterEvent | 初始化 VueRouter 监听 | VueRouter, callback({to, from , secound,...}, callback)          |\n| registerErrorEvent     | 全局异常报错          | vm: Vue 对象, errorCallback((errorMsg, pageInfo) => {}) 异常回调 |\n\n```js\nimport SimpleJsTracker from \"simple-js-tracker\";\n\nconst simpleJsTracker = new SimpleJsTracker({\n  debug: true,\n  url: \"\", // 服务地址\n  enableHeatMap: true, // 开启热力图\n  enableHashTracker: true,\n  config: {\n    ...\n  }\n});\n\n// 更新传参\nsimpleJsTracker.setConfig(options);\n\n// 自定义上传\nsimpleJsTracker.sendTracker(params);\n\n// 初始化自定义vue2/3指令\nsimpleJsTracker.initDirectives(Vue);\n\n// 初始化 VueRouter 监听\n// 页面跳转监听， 上报的参数让用户自行提供 report\nsimpleJsTracker.registerVueRouterEvent(router, (res, report) => {\n   const { to, from, secound } = res;\n   // 页面进入\n  if(to.meta.tracking) {\n    const fromParams = {\n      'event_type': 5,\n      ...to.meta.tracking,\n    }\n\n    report(fromParams);\n  }\n  // 页面离开\n  if(from.meta.tracking) {\n    const fromParams = {\n      'event_type': 6,\n      ...from.meta.tracking,\n    }\n    report(fromParams);\n  }\n});\n// 上报拦截\n simpleJsTracker.interceptors.sendTracker.use((config) => {\n    // ...\n    return config;\n  }, () => {});\n```\n\n未完待续...\n\n> 文中完整代码\n> [github](https://github.com/l1uqi/simple-js-tracker) > [npm](https://www.npmjs.com/package/simple-js-tracker)\n\n参考:\n\n[腾讯二面：现在要你实现一个埋点监控 SDK，你会怎么设计？](https://www.51cto.com/article/706364.html)\n[为什么通常在发送数据埋点请求的时候使用的是 1x1 像素的透明 gif 图片？](https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/87)\n","source":"_posts/前端业务埋点.md","raw":"---\ntitle: 前端业务埋点-SDK实践\ndate: 2022-11-05\ncategories:\n  - 前端\ntags:\n  - 埋点采集\ncover: https://user-images.githubusercontent.com/70128222/200491092-d00d8a32-5b63-40b9-96c3-fcc92de8716d.png\n---\n\n> 最近项目需要采集用户的行为数据, 从而进行分析得到页面点击量、访问量、访问路径等重要数据, 为运营和业务人员提供精准数据，为产品优化和精细化运营提供数据支持。\n\n![1111](https://user-images.githubusercontent.com/70128222/200491092-d00d8a32-5b63-40b9-96c3-fcc92de8716d.png)\n\n## 埋点方式选择\n\n这里采用代码侵入式埋点的方式进行、 SDK 提供 点击事件、曝光事件、页面时长进行上报\n\n- 点击事件(用户每点击一次按钮、商品、区块.. 就记录一次数据)\n- 曝光事件(专区、活动、商品...用户可见)\n- 页面时长(活动、页面 停留时间)\n\n---\n\n## 埋点方式实现\n\n### 点击事件\n\n如何让前端同事更轻松的捕获数据、这里实现了 dom 自定义事件实现自动上报, 在 vue 中也提供了指令 如有特殊业务场景也可以使用手动进行上报。\n\n```js\n// 自动上报\n// js\n\n// vue\n<button v-track:click=\"{\n  'page_id': 1,\n  'event_type': 12, // 事件类型\n  'objs' // 业务数据\n  }\"\n/>\n\n<button v-track:keyup=\"{\n  'page_id': 2,\n  'event_type': 12, // 事件类型\n  'objs' // 业务数据\n  }\"\n/>\n\n// 手动上报\ntrakerSDK.sendTracker({\n  'page_id': 3,\n  'event_type': 12,\n  'object_ids': [1, 2, 3]\n});\n```\n\n### 页面时长\n\n页面时长统计, 我们可以用时间戳来算出用户停留的页面时长。\n页面离开 - 页面进入 = 停留时长。\n\n```js\n// 单页应用\nrouter.beforeEach((to, from, next) => {\n  // 获取当前时间\n  const timestamp = new Date().getTime();\n  // 上次时间\n  const pretimestamp = getCache(LocalStoreEnum.PRE_TIMESTAMP);\n  // 存入当前时间\n  setCache(LocalStoreEnum.PRE_TIMESTAMP, timestamp);\n\n  // 停留时间(s)\n  let secound = (timestamp - pretimestamp) / 1000;\n  next();\n});\n```\n\n> 这样的话大多数场景都能够满足, 但是还有特殊场景无法满足。\n> 如 PC 端 浏览器 Tab 选项卡切换、 APP 切换应用等。\n> 这时候就需要另外的方案, [Page Visibility API](http://www.ruanyifeng.com/blog/2018/10/page_visibility_api.html) 能够解决这个问题\n\n```js\ndocument.addEventListener(\"visibilitychange\", () => {\n  const state = document.visibilityState;\n  let callbackData: any = null;\n  if (state === \"hidden\") {\n    // 页面不可见\n  }\n  if (state === \"visible\") {\n    // 页面可见\n  }\n\n  // 如果业务需要 时间超过1小时 则算是新开页面 自行判断\n});\n```\n\n### 曝光\n\n---\n\n## 埋点上报\n\n[埋点上报](https://hello7cat.com/2022/11/10/前端业务埋点数据上报/)\n---\n\n## SDK\n\n### 初始化\n\n### 参数\n\n| 参数                   | 必填 | 默认值 | 类型   |                                                                       |\n| ---------------------- | ---- | ------ | ------ | --------------------------------------------------------------------- |\n| debug                  | 否   | false  | bool   | 开启调试模式                                                          |\n| config                 | 否   | object | {}     | 你的配置文件, 会在上报时传给后端                                      |\n| url                    | 是   | ''     | string | 请求地址                                                              |\n| method                 | 否   | img    | string | 请求方式 GET、POST、SEND_BEACON                                       |\n| enableHeatMap          | 否   | false  | bool   | 开启坐标上传 position                                                 |\n| enableVisibilitychange | 否   | false  | bool   | 开启页面可见监听, 如开启此功能 registerVueRouterEvent 传参可能为 null |\n\n### 方法\n\n| 方法名                 | 说明                  | 参数                                                             |\n| ---------------------- | --------------------- | ---------------------------------------------------------------- |\n| setConfig              | 设置全局参数          | Options                                                          |\n| sendTracker            | 手动上报              | {自定义}                                                         |\n| initDirectives         | 初始化 vue2 指令      | Vue                                                              |\n| registerVueRouterEvent | 初始化 VueRouter 监听 | VueRouter, callback({to, from , secound,...}, callback)          |\n| registerErrorEvent     | 全局异常报错          | vm: Vue 对象, errorCallback((errorMsg, pageInfo) => {}) 异常回调 |\n\n```js\nimport SimpleJsTracker from \"simple-js-tracker\";\n\nconst simpleJsTracker = new SimpleJsTracker({\n  debug: true,\n  url: \"\", // 服务地址\n  enableHeatMap: true, // 开启热力图\n  enableHashTracker: true,\n  config: {\n    ...\n  }\n});\n\n// 更新传参\nsimpleJsTracker.setConfig(options);\n\n// 自定义上传\nsimpleJsTracker.sendTracker(params);\n\n// 初始化自定义vue2/3指令\nsimpleJsTracker.initDirectives(Vue);\n\n// 初始化 VueRouter 监听\n// 页面跳转监听， 上报的参数让用户自行提供 report\nsimpleJsTracker.registerVueRouterEvent(router, (res, report) => {\n   const { to, from, secound } = res;\n   // 页面进入\n  if(to.meta.tracking) {\n    const fromParams = {\n      'event_type': 5,\n      ...to.meta.tracking,\n    }\n\n    report(fromParams);\n  }\n  // 页面离开\n  if(from.meta.tracking) {\n    const fromParams = {\n      'event_type': 6,\n      ...from.meta.tracking,\n    }\n    report(fromParams);\n  }\n});\n// 上报拦截\n simpleJsTracker.interceptors.sendTracker.use((config) => {\n    // ...\n    return config;\n  }, () => {});\n```\n\n未完待续...\n\n> 文中完整代码\n> [github](https://github.com/l1uqi/simple-js-tracker) > [npm](https://www.npmjs.com/package/simple-js-tracker)\n\n参考:\n\n[腾讯二面：现在要你实现一个埋点监控 SDK，你会怎么设计？](https://www.51cto.com/article/706364.html)\n[为什么通常在发送数据埋点请求的时候使用的是 1x1 像素的透明 gif 图片？](https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/87)\n","slug":"前端业务埋点","published":1,"updated":"2022-11-16T01:48:35.754Z","_id":"cla6khl5t0000qs7794s2egf9","comments":1,"layout":"post","photos":[],"link":"","content":"<blockquote>\n<p>最近项目需要采集用户的行为数据, 从而进行分析得到页面点击量、访问量、访问路径等重要数据, 为运营和业务人员提供精准数据，为产品优化和精细化运营提供数据支持。</p>\n</blockquote>\n<p><img src=\"https://user-images.githubusercontent.com/70128222/200491092-d00d8a32-5b63-40b9-96c3-fcc92de8716d.png\" alt=\"1111\"></p>\n<h2 id=\"埋点方式选择\"><a href=\"#埋点方式选择\" class=\"headerlink\" title=\"埋点方式选择\"></a>埋点方式选择</h2><p>这里采用代码侵入式埋点的方式进行、 SDK 提供 点击事件、曝光事件、页面时长进行上报</p>\n<ul>\n<li>点击事件(用户每点击一次按钮、商品、区块.. 就记录一次数据)</li>\n<li>曝光事件(专区、活动、商品…用户可见)</li>\n<li>页面时长(活动、页面 停留时间)</li>\n</ul>\n<hr>\n<h2 id=\"埋点方式实现\"><a href=\"#埋点方式实现\" class=\"headerlink\" title=\"埋点方式实现\"></a>埋点方式实现</h2><h3 id=\"点击事件\"><a href=\"#点击事件\" class=\"headerlink\" title=\"点击事件\"></a>点击事件</h3><p>如何让前端同事更轻松的捕获数据、这里实现了 dom 自定义事件实现自动上报, 在 vue 中也提供了指令 如有特殊业务场景也可以使用手动进行上报。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 自动上报</span></span><br><span class=\"line\"><span class=\"comment\">// js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// vue</span></span><br><span class=\"line\">&lt;button v-<span class=\"attr\">track</span>:click=<span class=\"string\">&quot;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &#x27;page_id&#x27;: 1,</span></span><br><span class=\"line\"><span class=\"string\">  &#x27;event_type&#x27;: 12, // 事件类型</span></span><br><span class=\"line\"><span class=\"string\">  &#x27;objs&#x27; // 业务数据</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&quot;</span></span><br><span class=\"line\">/&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">v-track:keyup</span>=<span class=\"string\">&quot;&#123;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">  &#x27;page_id&#x27;: 2,</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">  &#x27;event_type&#x27;: 12, // 事件类型</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">  &#x27;objs&#x27; // 业务数据</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">  &#125;&quot;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">/&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 手动上报</span></span><br><span class=\"line\">trakerSDK.<span class=\"title function_\">sendTracker</span>(&#123;</span><br><span class=\"line\">  <span class=\"string\">&#x27;page_id&#x27;</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">  <span class=\"string\">&#x27;event_type&#x27;</span>: <span class=\"number\">12</span>,</span><br><span class=\"line\">  <span class=\"string\">&#x27;object_ids&#x27;</span>: [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"页面时长\"><a href=\"#页面时长\" class=\"headerlink\" title=\"页面时长\"></a>页面时长</h3><p>页面时长统计, 我们可以用时间戳来算出用户停留的页面时长。<br>页面离开 - 页面进入 = 停留时长。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 单页应用</span></span><br><span class=\"line\">router.<span class=\"title function_\">beforeEach</span>(<span class=\"function\">(<span class=\"params\">to, <span class=\"keyword\">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 获取当前时间</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> timestamp = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">getTime</span>();</span><br><span class=\"line\">  <span class=\"comment\">// 上次时间</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> pretimestamp = <span class=\"title function_\">getCache</span>(<span class=\"title class_\">LocalStoreEnum</span>.<span class=\"property\">PRE_TIMESTAMP</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 存入当前时间</span></span><br><span class=\"line\">  <span class=\"title function_\">setCache</span>(<span class=\"title class_\">LocalStoreEnum</span>.<span class=\"property\">PRE_TIMESTAMP</span>, timestamp);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 停留时间(s)</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> secound = (timestamp - pretimestamp) / <span class=\"number\">1000</span>;</span><br><span class=\"line\">  <span class=\"title function_\">next</span>();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>这样的话大多数场景都能够满足, 但是还有特殊场景无法满足。<br>如 PC 端 浏览器 Tab 选项卡切换、 APP 切换应用等。<br>这时候就需要另外的方案, <a href=\"http://www.ruanyifeng.com/blog/2018/10/page_visibility_api.html\">Page Visibility API</a> 能够解决这个问题</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;visibilitychange&quot;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> state = <span class=\"variable language_\">document</span>.<span class=\"property\">visibilityState</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"attr\">callbackData</span>: any = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (state === <span class=\"string\">&quot;hidden&quot;</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 页面不可见</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (state === <span class=\"string\">&quot;visible&quot;</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 页面可见</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 如果业务需要 时间超过1小时 则算是新开页面 自行判断</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"曝光\"><a href=\"#曝光\" class=\"headerlink\" title=\"曝光\"></a>曝光</h3><hr>\n<h2 id=\"埋点上报\"><a href=\"#埋点上报\" class=\"headerlink\" title=\"埋点上报\"></a>埋点上报</h2><h2 id=\"埋点上报-1\"><a href=\"#埋点上报-1\" class=\"headerlink\" title=\"埋点上报\"></a><a href=\"https://hello7cat.com/2022/11/10/%E5%89%8D%E7%AB%AF%E4%B8%9A%E5%8A%A1%E5%9F%8B%E7%82%B9%E6%95%B0%E6%8D%AE%E4%B8%8A%E6%8A%A5/\">埋点上报</a></h2><h2 id=\"SDK\"><a href=\"#SDK\" class=\"headerlink\" title=\"SDK\"></a>SDK</h2><h3 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h3><h3 id=\"参数\"><a href=\"#参数\" class=\"headerlink\" title=\"参数\"></a>参数</h3><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>必填</th>\n<th>默认值</th>\n<th>类型</th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>debug</td>\n<td>否</td>\n<td>false</td>\n<td>bool</td>\n<td>开启调试模式</td>\n</tr>\n<tr>\n<td>config</td>\n<td>否</td>\n<td>object</td>\n<td>{}</td>\n<td>你的配置文件, 会在上报时传给后端</td>\n</tr>\n<tr>\n<td>url</td>\n<td>是</td>\n<td>‘’</td>\n<td>string</td>\n<td>请求地址</td>\n</tr>\n<tr>\n<td>method</td>\n<td>否</td>\n<td>img</td>\n<td>string</td>\n<td>请求方式 GET、POST、SEND_BEACON</td>\n</tr>\n<tr>\n<td>enableHeatMap</td>\n<td>否</td>\n<td>false</td>\n<td>bool</td>\n<td>开启坐标上传 position</td>\n</tr>\n<tr>\n<td>enableVisibilitychange</td>\n<td>否</td>\n<td>false</td>\n<td>bool</td>\n<td>开启页面可见监听, 如开启此功能 registerVueRouterEvent 传参可能为 null</td>\n</tr>\n</tbody></table>\n<h3 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a>方法</h3><table>\n<thead>\n<tr>\n<th>方法名</th>\n<th>说明</th>\n<th>参数</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>setConfig</td>\n<td>设置全局参数</td>\n<td>Options</td>\n</tr>\n<tr>\n<td>sendTracker</td>\n<td>手动上报</td>\n<td>{自定义}</td>\n</tr>\n<tr>\n<td>initDirectives</td>\n<td>初始化 vue2 指令</td>\n<td>Vue</td>\n</tr>\n<tr>\n<td>registerVueRouterEvent</td>\n<td>初始化 VueRouter 监听</td>\n<td>VueRouter, callback({to, from , secound,…}, callback)</td>\n</tr>\n<tr>\n<td>registerErrorEvent</td>\n<td>全局异常报错</td>\n<td>vm: Vue 对象, errorCallback((errorMsg, pageInfo) =&gt; {}) 异常回调</td>\n</tr>\n</tbody></table>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">SimpleJsTracker</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;simple-js-tracker&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> simpleJsTracker = <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleJsTracker</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">debug</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">url</span>: <span class=\"string\">&quot;&quot;</span>, <span class=\"comment\">// 服务地址</span></span><br><span class=\"line\">  <span class=\"attr\">enableHeatMap</span>: <span class=\"literal\">true</span>, <span class=\"comment\">// 开启热力图</span></span><br><span class=\"line\">  <span class=\"attr\">enableHashTracker</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">config</span>: &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 更新传参</span></span><br><span class=\"line\">simpleJsTracker.<span class=\"title function_\">setConfig</span>(options);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 自定义上传</span></span><br><span class=\"line\">simpleJsTracker.<span class=\"title function_\">sendTracker</span>(params);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 初始化自定义vue2/3指令</span></span><br><span class=\"line\">simpleJsTracker.<span class=\"title function_\">initDirectives</span>(<span class=\"title class_\">Vue</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 初始化 VueRouter 监听</span></span><br><span class=\"line\"><span class=\"comment\">// 页面跳转监听， 上报的参数让用户自行提供 report</span></span><br><span class=\"line\">simpleJsTracker.<span class=\"title function_\">registerVueRouterEvent</span>(router, <span class=\"function\">(<span class=\"params\">res, report</span>) =&gt;</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">const</span> &#123; to, <span class=\"keyword\">from</span>, secound &#125; = res;</span><br><span class=\"line\">   <span class=\"comment\">// 页面进入</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(to.<span class=\"property\">meta</span>.<span class=\"property\">tracking</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> fromParams = &#123;</span><br><span class=\"line\">      <span class=\"string\">&#x27;event_type&#x27;</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">      ...to.<span class=\"property\">meta</span>.<span class=\"property\">tracking</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">report</span>(fromParams);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 页面离开</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">from</span>.<span class=\"property\">meta</span>.<span class=\"property\">tracking</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> fromParams = &#123;</span><br><span class=\"line\">      <span class=\"string\">&#x27;event_type&#x27;</span>: <span class=\"number\">6</span>,</span><br><span class=\"line\">      ...<span class=\"keyword\">from</span>.<span class=\"property\">meta</span>.<span class=\"property\">tracking</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">report</span>(fromParams);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 上报拦截</span></span><br><span class=\"line\"> simpleJsTracker.<span class=\"property\">interceptors</span>.<span class=\"property\">sendTracker</span>.<span class=\"title function_\">use</span>(<span class=\"function\">(<span class=\"params\">config</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> config;</span><br><span class=\"line\">  &#125;, <span class=\"function\">() =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>未完待续…</p>\n<blockquote>\n<p>文中完整代码<br><a href=\"https://github.com/l1uqi/simple-js-tracker\">github</a> &gt; <a href=\"https://www.npmjs.com/package/simple-js-tracker\">npm</a></p>\n</blockquote>\n<p>参考:</p>\n<p><a href=\"https://www.51cto.com/article/706364.html\">腾讯二面：现在要你实现一个埋点监控 SDK，你会怎么设计？</a><br><a href=\"https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/87\">为什么通常在发送数据埋点请求的时候使用的是 1x1 像素的透明 gif 图片？</a></p>\n","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p>最近项目需要采集用户的行为数据, 从而进行分析得到页面点击量、访问量、访问路径等重要数据, 为运营和业务人员提供精准数据，为产品优化和精细化运营提供数据支持。</p>\n</blockquote>\n<p><img src=\"https://user-images.githubusercontent.com/70128222/200491092-d00d8a32-5b63-40b9-96c3-fcc92de8716d.png\" alt=\"1111\"></p>\n<h2 id=\"埋点方式选择\"><a href=\"#埋点方式选择\" class=\"headerlink\" title=\"埋点方式选择\"></a>埋点方式选择</h2><p>这里采用代码侵入式埋点的方式进行、 SDK 提供 点击事件、曝光事件、页面时长进行上报</p>\n<ul>\n<li>点击事件(用户每点击一次按钮、商品、区块.. 就记录一次数据)</li>\n<li>曝光事件(专区、活动、商品…用户可见)</li>\n<li>页面时长(活动、页面 停留时间)</li>\n</ul>\n<hr>\n<h2 id=\"埋点方式实现\"><a href=\"#埋点方式实现\" class=\"headerlink\" title=\"埋点方式实现\"></a>埋点方式实现</h2><h3 id=\"点击事件\"><a href=\"#点击事件\" class=\"headerlink\" title=\"点击事件\"></a>点击事件</h3><p>如何让前端同事更轻松的捕获数据、这里实现了 dom 自定义事件实现自动上报, 在 vue 中也提供了指令 如有特殊业务场景也可以使用手动进行上报。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 自动上报</span></span><br><span class=\"line\"><span class=\"comment\">// js</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// vue</span></span><br><span class=\"line\">&lt;button v-<span class=\"attr\">track</span>:click=<span class=\"string\">&quot;&#123;</span></span><br><span class=\"line\"><span class=\"string\">  &#x27;page_id&#x27;: 1,</span></span><br><span class=\"line\"><span class=\"string\">  &#x27;event_type&#x27;: 12, // 事件类型</span></span><br><span class=\"line\"><span class=\"string\">  &#x27;objs&#x27; // 业务数据</span></span><br><span class=\"line\"><span class=\"string\">  &#125;&quot;</span></span><br><span class=\"line\">/&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">v-track:keyup</span>=<span class=\"string\">&quot;&#123;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">  &#x27;page_id&#x27;: 2,</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">  &#x27;event_type&#x27;: 12, // 事件类型</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">  &#x27;objs&#x27; // 业务数据</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">  &#125;&quot;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">/&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 手动上报</span></span><br><span class=\"line\">trakerSDK.<span class=\"title function_\">sendTracker</span>(&#123;</span><br><span class=\"line\">  <span class=\"string\">&#x27;page_id&#x27;</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">  <span class=\"string\">&#x27;event_type&#x27;</span>: <span class=\"number\">12</span>,</span><br><span class=\"line\">  <span class=\"string\">&#x27;object_ids&#x27;</span>: [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"页面时长\"><a href=\"#页面时长\" class=\"headerlink\" title=\"页面时长\"></a>页面时长</h3><p>页面时长统计, 我们可以用时间戳来算出用户停留的页面时长。<br>页面离开 - 页面进入 = 停留时长。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 单页应用</span></span><br><span class=\"line\">router.<span class=\"title function_\">beforeEach</span>(<span class=\"function\">(<span class=\"params\">to, <span class=\"keyword\">from</span>, next</span>) =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// 获取当前时间</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> timestamp = <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>().<span class=\"title function_\">getTime</span>();</span><br><span class=\"line\">  <span class=\"comment\">// 上次时间</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> pretimestamp = <span class=\"title function_\">getCache</span>(<span class=\"title class_\">LocalStoreEnum</span>.<span class=\"property\">PRE_TIMESTAMP</span>);</span><br><span class=\"line\">  <span class=\"comment\">// 存入当前时间</span></span><br><span class=\"line\">  <span class=\"title function_\">setCache</span>(<span class=\"title class_\">LocalStoreEnum</span>.<span class=\"property\">PRE_TIMESTAMP</span>, timestamp);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 停留时间(s)</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> secound = (timestamp - pretimestamp) / <span class=\"number\">1000</span>;</span><br><span class=\"line\">  <span class=\"title function_\">next</span>();</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>这样的话大多数场景都能够满足, 但是还有特殊场景无法满足。<br>如 PC 端 浏览器 Tab 选项卡切换、 APP 切换应用等。<br>这时候就需要另外的方案, <a href=\"http://www.ruanyifeng.com/blog/2018/10/page_visibility_api.html\">Page Visibility API</a> 能够解决这个问题</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;visibilitychange&quot;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> state = <span class=\"variable language_\">document</span>.<span class=\"property\">visibilityState</span>;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> <span class=\"attr\">callbackData</span>: any = <span class=\"literal\">null</span>;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (state === <span class=\"string\">&quot;hidden&quot;</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 页面不可见</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (state === <span class=\"string\">&quot;visible&quot;</span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 页面可见</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 如果业务需要 时间超过1小时 则算是新开页面 自行判断</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"曝光\"><a href=\"#曝光\" class=\"headerlink\" title=\"曝光\"></a>曝光</h3><hr>\n<h2 id=\"埋点上报\"><a href=\"#埋点上报\" class=\"headerlink\" title=\"埋点上报\"></a>埋点上报</h2><h2 id=\"埋点上报-1\"><a href=\"#埋点上报-1\" class=\"headerlink\" title=\"埋点上报\"></a><a href=\"https://hello7cat.com/2022/11/10/%E5%89%8D%E7%AB%AF%E4%B8%9A%E5%8A%A1%E5%9F%8B%E7%82%B9%E6%95%B0%E6%8D%AE%E4%B8%8A%E6%8A%A5/\">埋点上报</a></h2><h2 id=\"SDK\"><a href=\"#SDK\" class=\"headerlink\" title=\"SDK\"></a>SDK</h2><h3 id=\"初始化\"><a href=\"#初始化\" class=\"headerlink\" title=\"初始化\"></a>初始化</h3><h3 id=\"参数\"><a href=\"#参数\" class=\"headerlink\" title=\"参数\"></a>参数</h3><table>\n<thead>\n<tr>\n<th>参数</th>\n<th>必填</th>\n<th>默认值</th>\n<th>类型</th>\n<th></th>\n</tr>\n</thead>\n<tbody><tr>\n<td>debug</td>\n<td>否</td>\n<td>false</td>\n<td>bool</td>\n<td>开启调试模式</td>\n</tr>\n<tr>\n<td>config</td>\n<td>否</td>\n<td>object</td>\n<td>{}</td>\n<td>你的配置文件, 会在上报时传给后端</td>\n</tr>\n<tr>\n<td>url</td>\n<td>是</td>\n<td>‘’</td>\n<td>string</td>\n<td>请求地址</td>\n</tr>\n<tr>\n<td>method</td>\n<td>否</td>\n<td>img</td>\n<td>string</td>\n<td>请求方式 GET、POST、SEND_BEACON</td>\n</tr>\n<tr>\n<td>enableHeatMap</td>\n<td>否</td>\n<td>false</td>\n<td>bool</td>\n<td>开启坐标上传 position</td>\n</tr>\n<tr>\n<td>enableVisibilitychange</td>\n<td>否</td>\n<td>false</td>\n<td>bool</td>\n<td>开启页面可见监听, 如开启此功能 registerVueRouterEvent 传参可能为 null</td>\n</tr>\n</tbody></table>\n<h3 id=\"方法\"><a href=\"#方法\" class=\"headerlink\" title=\"方法\"></a>方法</h3><table>\n<thead>\n<tr>\n<th>方法名</th>\n<th>说明</th>\n<th>参数</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>setConfig</td>\n<td>设置全局参数</td>\n<td>Options</td>\n</tr>\n<tr>\n<td>sendTracker</td>\n<td>手动上报</td>\n<td>{自定义}</td>\n</tr>\n<tr>\n<td>initDirectives</td>\n<td>初始化 vue2 指令</td>\n<td>Vue</td>\n</tr>\n<tr>\n<td>registerVueRouterEvent</td>\n<td>初始化 VueRouter 监听</td>\n<td>VueRouter, callback({to, from , secound,…}, callback)</td>\n</tr>\n<tr>\n<td>registerErrorEvent</td>\n<td>全局异常报错</td>\n<td>vm: Vue 对象, errorCallback((errorMsg, pageInfo) =&gt; {}) 异常回调</td>\n</tr>\n</tbody></table>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">SimpleJsTracker</span> <span class=\"keyword\">from</span> <span class=\"string\">&quot;simple-js-tracker&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> simpleJsTracker = <span class=\"keyword\">new</span> <span class=\"title class_\">SimpleJsTracker</span>(&#123;</span><br><span class=\"line\">  <span class=\"attr\">debug</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">url</span>: <span class=\"string\">&quot;&quot;</span>, <span class=\"comment\">// 服务地址</span></span><br><span class=\"line\">  <span class=\"attr\">enableHeatMap</span>: <span class=\"literal\">true</span>, <span class=\"comment\">// 开启热力图</span></span><br><span class=\"line\">  <span class=\"attr\">enableHashTracker</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">  <span class=\"attr\">config</span>: &#123;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 更新传参</span></span><br><span class=\"line\">simpleJsTracker.<span class=\"title function_\">setConfig</span>(options);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 自定义上传</span></span><br><span class=\"line\">simpleJsTracker.<span class=\"title function_\">sendTracker</span>(params);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 初始化自定义vue2/3指令</span></span><br><span class=\"line\">simpleJsTracker.<span class=\"title function_\">initDirectives</span>(<span class=\"title class_\">Vue</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 初始化 VueRouter 监听</span></span><br><span class=\"line\"><span class=\"comment\">// 页面跳转监听， 上报的参数让用户自行提供 report</span></span><br><span class=\"line\">simpleJsTracker.<span class=\"title function_\">registerVueRouterEvent</span>(router, <span class=\"function\">(<span class=\"params\">res, report</span>) =&gt;</span> &#123;</span><br><span class=\"line\">   <span class=\"keyword\">const</span> &#123; to, <span class=\"keyword\">from</span>, secound &#125; = res;</span><br><span class=\"line\">   <span class=\"comment\">// 页面进入</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(to.<span class=\"property\">meta</span>.<span class=\"property\">tracking</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> fromParams = &#123;</span><br><span class=\"line\">      <span class=\"string\">&#x27;event_type&#x27;</span>: <span class=\"number\">5</span>,</span><br><span class=\"line\">      ...to.<span class=\"property\">meta</span>.<span class=\"property\">tracking</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_\">report</span>(fromParams);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">// 页面离开</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span>(<span class=\"keyword\">from</span>.<span class=\"property\">meta</span>.<span class=\"property\">tracking</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> fromParams = &#123;</span><br><span class=\"line\">      <span class=\"string\">&#x27;event_type&#x27;</span>: <span class=\"number\">6</span>,</span><br><span class=\"line\">      ...<span class=\"keyword\">from</span>.<span class=\"property\">meta</span>.<span class=\"property\">tracking</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"title function_\">report</span>(fromParams);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"comment\">// 上报拦截</span></span><br><span class=\"line\"> simpleJsTracker.<span class=\"property\">interceptors</span>.<span class=\"property\">sendTracker</span>.<span class=\"title function_\">use</span>(<span class=\"function\">(<span class=\"params\">config</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// ...</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> config;</span><br><span class=\"line\">  &#125;, <span class=\"function\">() =&gt;</span> &#123;&#125;);</span><br></pre></td></tr></table></figure>\n\n<p>未完待续…</p>\n<blockquote>\n<p>文中完整代码<br><a href=\"https://github.com/l1uqi/simple-js-tracker\">github</a> &gt; <a href=\"https://www.npmjs.com/package/simple-js-tracker\">npm</a></p>\n</blockquote>\n<p>参考:</p>\n<p><a href=\"https://www.51cto.com/article/706364.html\">腾讯二面：现在要你实现一个埋点监控 SDK，你会怎么设计？</a><br><a href=\"https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/87\">为什么通常在发送数据埋点请求的时候使用的是 1x1 像素的透明 gif 图片？</a></p>\n"},{"title":"前端业务埋点-曝光实现","top_img":false,"date":"2022-11-07T16:00:00.000Z","cover":"https://raw.githubusercontent.com/l1uqi/PicGo/main/blog/1063297.jpg","_content":"\n## 什么是曝光?\n\n商品曝光人数：看到商品在首页、列表页、活动页面，以及在商品详情页下方的更多展现的人数。（不包括商品详情页的访客数量）\n商品曝光次数：商品在店铺首页、列表页、活动页面，以及在商品详情页下方的更多展现的次数。（不包括商品详情页的浏览量）\n\n> 通过商品曝光我们能得出商品在不同营销位的比重， 从而得出用户操作喜好\n\n## 如何判断元素可视区域?\n\n### Element.getBoundingClientRect()\n\ngetBoundingClientRect 方法返回一个 对象，该 DOMRect 对象提供有关元素大小及其相对于视口的位置的信息。\n如果目标元素 rect 满足 top > 0 && left > 0 && bottom >= 视窗高度 && right <= 视窗宽度\n便能得出元素完全在视窗内。 在长列表下 我们可以通过监听滚动条事件， 从而获取目标元素是否暴露在用户视窗内。\n\n[在线代码示例 CodePen](https://codepen.io/l1uqi/pen/ExRZKeN)\n\n> 这种方法实现起来简单，兼容性相对较好，这个属性频繁计算会引发页面的重绘，当元素过多时，会造成性能问题，出现卡顿，影响使用体验。\n\n```js\n// 判断可视区域内\nconst isElementInViewport = (el) => {\n  let rect = el.getBoundingClientRect();\n  return (\n    rect.top >= 0 &&\n    rect.left >= 0 &&\n    rect.bottom <=\n      (window.innerHeight || document.documentElement.clientHeight) &&\n    rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n  );\n};\n```\n\n### Intersection Observer API\n\nIntersection Observer API 提供了一种异步检测目标元素与祖先元素或 viewport 相交情况变化的方法。\nIntersection Observer API 会注册一个回调函数，每当被监视的元素进入或者退出另外一个元素时 (或者 viewport )，或者两个元素的相交部分大小发生变化时，该回调方法会被触发执行。这样，我们网站的主线程不需要再为了监听元素相交而辛苦劳作，浏览器会自行优化元素相交管理。\n\n[浏览器兼容性](https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7)\n\n[在线代码示例 CodePen](https://codepen.io/l1uqi/pen/qBKRZLX?editors=1111)\n\n```js\nconst intersectionObserverCallBack = (entries) => {\n  for (const entry of entries) {\n    if (entry.isIntersecting) {\n      // 可见\n      var container = entry.target;\n    }\n  }\n};\n\nvar observer = new IntersectionObserver(intersectionObserverCallBack);\n\nobserver.observe(element);\n\n// 停止观察\nobserver.unobserve(element);\n\n// 关闭观察器\nobserver.disconnect();\n```\n\n![](https://user-images.githubusercontent.com/70128222/200589085-fac93e79-b391-448b-bd81-f33cf9a352f1.gif)\n\n## 总结\n\n两种方案\n\n- getBoundingClientRect 浏览器支持不错, 简单易用但是可能存在性能问题。\n- Intersection Observer API 没有性能问题， 但是存在一定兼容性。\n\n好消息是我们可以使用[polyfill](https://github.com/GoogleChromeLabs/intersection-observer) 解决 Intersection Observer API 兼容性问题\n它会在不支持的浏览器 使用 getBoundingClientRect 去重新实现一遍 Intersection Observer API。\n\n[polyfill](https://github.com/GoogleChromeLabs/intersection-observer)浏览器支持:\n\n<table>\n  <tr>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/chrome/chrome_48x48.png\" alt=\"Chrome\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/firefox/firefox_48x48.png\" alt=\"Firefox\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/safari/safari_48x48.png\" alt=\"Safari\"><br>\n      6+\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/edge/edge_48x48.png\" alt=\"Edge\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/archive/internet-explorer_7-8/internet-explorer_7-8_48x48.png\" alt=\"Internet Explorer\"><br>\n      7+\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/opera/opera_48x48.png\" alt=\"Opera\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/android/android_48x48.png\" alt=\"Android\"><br>\n      4.4+\n    </td>\n  </tr>\n</table>\n\n```shell\n// 安装\nnpm install intersection-observer\n```\n\n## 实现\n\n曝光肯定是结合埋点一起使用， 通过采集某个商品是否出现在用户的可视区域内, 进行上报\n\n```js\nimport IntersectionObserver from 'intersection-observer';\n\nconst attrName = 'exposure-data'\n\nclass Exposure {\n  private observer: IntersectionObserver | undefined;\n\n  init() {\n    return new IntersectionObserver((entries, observer) => {\n      entries.forEach((item) => {\n        if (item.isIntersecting) {\n          const el: Element = item.target\n          observer!.unobserve(el);\n          const arrtString = el.getAttribute(attrName) || null;\n          if(!arrtString) return\n          const params = JSON.parse(arrtString);\n          // 上报\n          autoSendTracker({\n            ...params,\n          });\n        }\n      });\n    });\n  }\n  add(entry: { el: Element; binding: any }) {\n    entry.el.setAttribute(attrName, typeof entry.binding.value === 'string' ? entry.binding.value : JSON.stringify(entry.binding.value))\n    if (this.observer === undefined) {\n      this.observer = this.init();\n    }\n    this.observer.observe(entry.el);\n  }\n  remove(entry: { el: Element; binding?: any }) {\n    this.observer?.unobserve(entry.el);\n    this.observer?.disconnect();\n  }\n}\n\nexport default Exposure;\n\n\nconst exposure = new Exposure();\n\n// 自定义指令\nconst track = {\n  inserted: function (el: any, binding: { arg: any }) {\n    const { arg } = binding;\n    arg.split(\"|\").forEach((item) => {\n      // 点击\n      switch (item) {\n        case \"click\":\n          cli.add({ el, binding });\n          break;\n\n        case \"keyup\":\n          keyup.add({ el, binding });\n          break;\n        case \"exposure\":\n          exposure.add({ el, binding });\n          break;\n      }\n    });\n  },\n  unbind(el, binding) {\n    const { arg } = binding;\n    arg.split(\"|\").forEach((item) => {\n      // 点击\n      switch (item) {\n        case \"click\":\n          cli.remove({ el, binding });\n          break;\n\n        case \"keyup\":\n          keyup.remove({ el, binding });\n          break;\n\n        case \"exposure\":\n          exposure.remove({ el, binding });\n          break;\n      }\n    });\n  },\n};\n\n\n// 使用\n<div\n  v-track:exposure=\"{\n    object_ids: item.skuoid,\n    event_type: 8,\n    ...\n  }\"\n  >\n  ...\n</div>\n\n\n```\n\n> 文中完整代码\n> [github](https://github.com/l1uqi/simple-js-tracker) > [npm](https://www.npmjs.com/package/simple-js-tracker)\n\n\n## 参考\n\n[IntersectionObserver API 使用教程](https://www.ruanyifeng.com/blog/2016/11/intersectionobserver_api.html)\n","source":"_posts/前端业务埋点曝光实现.md","raw":"---\ntitle: 前端业务埋点-曝光实现\ntop_img: false\ndate: 2022-11-08\ncategories:\n  - 前端\ntags:\n  - 埋点采集\ncover: https://raw.githubusercontent.com/l1uqi/PicGo/main/blog/1063297.jpg\n---\n\n## 什么是曝光?\n\n商品曝光人数：看到商品在首页、列表页、活动页面，以及在商品详情页下方的更多展现的人数。（不包括商品详情页的访客数量）\n商品曝光次数：商品在店铺首页、列表页、活动页面，以及在商品详情页下方的更多展现的次数。（不包括商品详情页的浏览量）\n\n> 通过商品曝光我们能得出商品在不同营销位的比重， 从而得出用户操作喜好\n\n## 如何判断元素可视区域?\n\n### Element.getBoundingClientRect()\n\ngetBoundingClientRect 方法返回一个 对象，该 DOMRect 对象提供有关元素大小及其相对于视口的位置的信息。\n如果目标元素 rect 满足 top > 0 && left > 0 && bottom >= 视窗高度 && right <= 视窗宽度\n便能得出元素完全在视窗内。 在长列表下 我们可以通过监听滚动条事件， 从而获取目标元素是否暴露在用户视窗内。\n\n[在线代码示例 CodePen](https://codepen.io/l1uqi/pen/ExRZKeN)\n\n> 这种方法实现起来简单，兼容性相对较好，这个属性频繁计算会引发页面的重绘，当元素过多时，会造成性能问题，出现卡顿，影响使用体验。\n\n```js\n// 判断可视区域内\nconst isElementInViewport = (el) => {\n  let rect = el.getBoundingClientRect();\n  return (\n    rect.top >= 0 &&\n    rect.left >= 0 &&\n    rect.bottom <=\n      (window.innerHeight || document.documentElement.clientHeight) &&\n    rect.right <= (window.innerWidth || document.documentElement.clientWidth)\n  );\n};\n```\n\n### Intersection Observer API\n\nIntersection Observer API 提供了一种异步检测目标元素与祖先元素或 viewport 相交情况变化的方法。\nIntersection Observer API 会注册一个回调函数，每当被监视的元素进入或者退出另外一个元素时 (或者 viewport )，或者两个元素的相交部分大小发生变化时，该回调方法会被触发执行。这样，我们网站的主线程不需要再为了监听元素相交而辛苦劳作，浏览器会自行优化元素相交管理。\n\n[浏览器兼容性](https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7)\n\n[在线代码示例 CodePen](https://codepen.io/l1uqi/pen/qBKRZLX?editors=1111)\n\n```js\nconst intersectionObserverCallBack = (entries) => {\n  for (const entry of entries) {\n    if (entry.isIntersecting) {\n      // 可见\n      var container = entry.target;\n    }\n  }\n};\n\nvar observer = new IntersectionObserver(intersectionObserverCallBack);\n\nobserver.observe(element);\n\n// 停止观察\nobserver.unobserve(element);\n\n// 关闭观察器\nobserver.disconnect();\n```\n\n![](https://user-images.githubusercontent.com/70128222/200589085-fac93e79-b391-448b-bd81-f33cf9a352f1.gif)\n\n## 总结\n\n两种方案\n\n- getBoundingClientRect 浏览器支持不错, 简单易用但是可能存在性能问题。\n- Intersection Observer API 没有性能问题， 但是存在一定兼容性。\n\n好消息是我们可以使用[polyfill](https://github.com/GoogleChromeLabs/intersection-observer) 解决 Intersection Observer API 兼容性问题\n它会在不支持的浏览器 使用 getBoundingClientRect 去重新实现一遍 Intersection Observer API。\n\n[polyfill](https://github.com/GoogleChromeLabs/intersection-observer)浏览器支持:\n\n<table>\n  <tr>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/chrome/chrome_48x48.png\" alt=\"Chrome\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/firefox/firefox_48x48.png\" alt=\"Firefox\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/safari/safari_48x48.png\" alt=\"Safari\"><br>\n      6+\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/edge/edge_48x48.png\" alt=\"Edge\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/archive/internet-explorer_7-8/internet-explorer_7-8_48x48.png\" alt=\"Internet Explorer\"><br>\n      7+\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/opera/opera_48x48.png\" alt=\"Opera\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/android/android_48x48.png\" alt=\"Android\"><br>\n      4.4+\n    </td>\n  </tr>\n</table>\n\n```shell\n// 安装\nnpm install intersection-observer\n```\n\n## 实现\n\n曝光肯定是结合埋点一起使用， 通过采集某个商品是否出现在用户的可视区域内, 进行上报\n\n```js\nimport IntersectionObserver from 'intersection-observer';\n\nconst attrName = 'exposure-data'\n\nclass Exposure {\n  private observer: IntersectionObserver | undefined;\n\n  init() {\n    return new IntersectionObserver((entries, observer) => {\n      entries.forEach((item) => {\n        if (item.isIntersecting) {\n          const el: Element = item.target\n          observer!.unobserve(el);\n          const arrtString = el.getAttribute(attrName) || null;\n          if(!arrtString) return\n          const params = JSON.parse(arrtString);\n          // 上报\n          autoSendTracker({\n            ...params,\n          });\n        }\n      });\n    });\n  }\n  add(entry: { el: Element; binding: any }) {\n    entry.el.setAttribute(attrName, typeof entry.binding.value === 'string' ? entry.binding.value : JSON.stringify(entry.binding.value))\n    if (this.observer === undefined) {\n      this.observer = this.init();\n    }\n    this.observer.observe(entry.el);\n  }\n  remove(entry: { el: Element; binding?: any }) {\n    this.observer?.unobserve(entry.el);\n    this.observer?.disconnect();\n  }\n}\n\nexport default Exposure;\n\n\nconst exposure = new Exposure();\n\n// 自定义指令\nconst track = {\n  inserted: function (el: any, binding: { arg: any }) {\n    const { arg } = binding;\n    arg.split(\"|\").forEach((item) => {\n      // 点击\n      switch (item) {\n        case \"click\":\n          cli.add({ el, binding });\n          break;\n\n        case \"keyup\":\n          keyup.add({ el, binding });\n          break;\n        case \"exposure\":\n          exposure.add({ el, binding });\n          break;\n      }\n    });\n  },\n  unbind(el, binding) {\n    const { arg } = binding;\n    arg.split(\"|\").forEach((item) => {\n      // 点击\n      switch (item) {\n        case \"click\":\n          cli.remove({ el, binding });\n          break;\n\n        case \"keyup\":\n          keyup.remove({ el, binding });\n          break;\n\n        case \"exposure\":\n          exposure.remove({ el, binding });\n          break;\n      }\n    });\n  },\n};\n\n\n// 使用\n<div\n  v-track:exposure=\"{\n    object_ids: item.skuoid,\n    event_type: 8,\n    ...\n  }\"\n  >\n  ...\n</div>\n\n\n```\n\n> 文中完整代码\n> [github](https://github.com/l1uqi/simple-js-tracker) > [npm](https://www.npmjs.com/package/simple-js-tracker)\n\n\n## 参考\n\n[IntersectionObserver API 使用教程](https://www.ruanyifeng.com/blog/2016/11/intersectionobserver_api.html)\n","slug":"前端业务埋点曝光实现","published":1,"updated":"2022-12-06T05:46:47.471Z","_id":"clai4xvf50000lkkfff940kxj","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"什么是曝光\"><a href=\"#什么是曝光\" class=\"headerlink\" title=\"什么是曝光?\"></a>什么是曝光?</h2><p>商品曝光人数：看到商品在首页、列表页、活动页面，以及在商品详情页下方的更多展现的人数。（不包括商品详情页的访客数量）<br>商品曝光次数：商品在店铺首页、列表页、活动页面，以及在商品详情页下方的更多展现的次数。（不包括商品详情页的浏览量）</p>\n<blockquote>\n<p>通过商品曝光我们能得出商品在不同营销位的比重， 从而得出用户操作喜好</p>\n</blockquote>\n<h2 id=\"如何判断元素可视区域\"><a href=\"#如何判断元素可视区域\" class=\"headerlink\" title=\"如何判断元素可视区域?\"></a>如何判断元素可视区域?</h2><h3 id=\"Element-getBoundingClientRect\"><a href=\"#Element-getBoundingClientRect\" class=\"headerlink\" title=\"Element.getBoundingClientRect()\"></a>Element.getBoundingClientRect()</h3><p>getBoundingClientRect 方法返回一个 对象，该 DOMRect 对象提供有关元素大小及其相对于视口的位置的信息。<br>如果目标元素 rect 满足 top &gt; 0 &amp;&amp; left &gt; 0 &amp;&amp; bottom &gt;= 视窗高度 &amp;&amp; right &lt;= 视窗宽度<br>便能得出元素完全在视窗内。 在长列表下 我们可以通过监听滚动条事件， 从而获取目标元素是否暴露在用户视窗内。</p>\n<p><a href=\"https://codepen.io/l1uqi/pen/ExRZKeN\">在线代码示例 CodePen</a></p>\n<blockquote>\n<p>这种方法实现起来简单，兼容性相对较好，这个属性频繁计算会引发页面的重绘，当元素过多时，会造成性能问题，出现卡顿，影响使用体验。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 判断可视区域内</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">isElementInViewport</span> = (<span class=\"params\">el</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> rect = el.<span class=\"title function_\">getBoundingClientRect</span>();</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    rect.<span class=\"property\">top</span> &gt;= <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">    rect.<span class=\"property\">left</span> &gt;= <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">    rect.<span class=\"property\">bottom</span> &lt;=</span><br><span class=\"line\">      (<span class=\"variable language_\">window</span>.<span class=\"property\">innerHeight</span> || <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">clientHeight</span>) &amp;&amp;</span><br><span class=\"line\">    rect.<span class=\"property\">right</span> &lt;= (<span class=\"variable language_\">window</span>.<span class=\"property\">innerWidth</span> || <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">clientWidth</span>)</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Intersection-Observer-API\"><a href=\"#Intersection-Observer-API\" class=\"headerlink\" title=\"Intersection Observer API\"></a>Intersection Observer API</h3><p>Intersection Observer API 提供了一种异步检测目标元素与祖先元素或 viewport 相交情况变化的方法。<br>Intersection Observer API 会注册一个回调函数，每当被监视的元素进入或者退出另外一个元素时 (或者 viewport )，或者两个元素的相交部分大小发生变化时，该回调方法会被触发执行。这样，我们网站的主线程不需要再为了监听元素相交而辛苦劳作，浏览器会自行优化元素相交管理。</p>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7\">浏览器兼容性</a></p>\n<p><a href=\"https://codepen.io/l1uqi/pen/qBKRZLX?editors=1111\">在线代码示例 CodePen</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">intersectionObserverCallBack</span> = (<span class=\"params\">entries</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> entry <span class=\"keyword\">of</span> entries) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (entry.<span class=\"property\">isIntersecting</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 可见</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> container = entry.<span class=\"property\">target</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> observer = <span class=\"keyword\">new</span> <span class=\"title class_\">IntersectionObserver</span>(intersectionObserverCallBack);</span><br><span class=\"line\"></span><br><span class=\"line\">observer.<span class=\"title function_\">observe</span>(element);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 停止观察</span></span><br><span class=\"line\">observer.<span class=\"title function_\">unobserve</span>(element);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 关闭观察器</span></span><br><span class=\"line\">observer.<span class=\"title function_\">disconnect</span>();</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://user-images.githubusercontent.com/70128222/200589085-fac93e79-b391-448b-bd81-f33cf9a352f1.gif\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>两种方案</p>\n<ul>\n<li>getBoundingClientRect 浏览器支持不错, 简单易用但是可能存在性能问题。</li>\n<li>Intersection Observer API 没有性能问题， 但是存在一定兼容性。</li>\n</ul>\n<p>好消息是我们可以使用<a href=\"https://github.com/GoogleChromeLabs/intersection-observer\">polyfill</a> 解决 Intersection Observer API 兼容性问题<br>它会在不支持的浏览器 使用 getBoundingClientRect 去重新实现一遍 Intersection Observer API。</p>\n<p><a href=\"https://github.com/GoogleChromeLabs/intersection-observer\">polyfill</a>浏览器支持:</p>\n<table>\n  <tr>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/chrome/chrome_48x48.png\" alt=\"Chrome\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/firefox/firefox_48x48.png\" alt=\"Firefox\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/safari/safari_48x48.png\" alt=\"Safari\"><br>\n      6+\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/edge/edge_48x48.png\" alt=\"Edge\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/archive/internet-explorer_7-8/internet-explorer_7-8_48x48.png\" alt=\"Internet Explorer\"><br>\n      7+\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/opera/opera_48x48.png\" alt=\"Opera\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/android/android_48x48.png\" alt=\"Android\"><br>\n      4.4+\n    </td>\n  </tr>\n</table>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 安装</span><br><span class=\"line\">npm install intersection-observer</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><p>曝光肯定是结合埋点一起使用， 通过采集某个商品是否出现在用户的可视区域内, 进行上报</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">IntersectionObserver</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;intersection-observer&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> attrName = <span class=\"string\">&#x27;exposure-data&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Exposure</span> &#123;</span><br><span class=\"line\">  private <span class=\"attr\">observer</span>: <span class=\"title class_\">IntersectionObserver</span> | <span class=\"literal\">undefined</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">init</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IntersectionObserver</span>(<span class=\"function\">(<span class=\"params\">entries, observer</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      entries.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (item.<span class=\"property\">isIntersecting</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> <span class=\"attr\">el</span>: <span class=\"title class_\">Element</span> = item.<span class=\"property\">target</span></span><br><span class=\"line\">          observer!.<span class=\"title function_\">unobserve</span>(el);</span><br><span class=\"line\">          <span class=\"keyword\">const</span> arrtString = el.<span class=\"title function_\">getAttribute</span>(attrName) || <span class=\"literal\">null</span>;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(!arrtString) <span class=\"keyword\">return</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> params = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(arrtString);</span><br><span class=\"line\">          <span class=\"comment\">// 上报</span></span><br><span class=\"line\">          <span class=\"title function_\">autoSendTracker</span>(&#123;</span><br><span class=\"line\">            ...params,</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">add</span>(<span class=\"params\">entry: &#123; el: Element; binding: any &#125;</span>) &#123;</span><br><span class=\"line\">    entry.<span class=\"property\">el</span>.<span class=\"title function_\">setAttribute</span>(attrName, <span class=\"keyword\">typeof</span> entry.<span class=\"property\">binding</span>.<span class=\"property\">value</span> === <span class=\"string\">&#x27;string&#x27;</span> ? entry.<span class=\"property\">binding</span>.<span class=\"property\">value</span> : <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(entry.<span class=\"property\">binding</span>.<span class=\"property\">value</span>))</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">observer</span> === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">observer</span> = <span class=\"variable language_\">this</span>.<span class=\"title function_\">init</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">observer</span>.<span class=\"title function_\">observe</span>(entry.<span class=\"property\">el</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">remove</span>(<span class=\"params\">entry: &#123; el: Element; binding?: any &#125;</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">observer</span>?.<span class=\"title function_\">unobserve</span>(entry.<span class=\"property\">el</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">observer</span>?.<span class=\"title function_\">disconnect</span>();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Exposure</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> exposure = <span class=\"keyword\">new</span> <span class=\"title class_\">Exposure</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 自定义指令</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> track = &#123;</span><br><span class=\"line\">  <span class=\"attr\">inserted</span>: <span class=\"keyword\">function</span> (<span class=\"params\">el: any, binding: &#123; arg: any &#125;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; arg &#125; = binding;</span><br><span class=\"line\">    arg.<span class=\"title function_\">split</span>(<span class=\"string\">&quot;|&quot;</span>).<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 点击</span></span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (item) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;click&quot;</span>:</span><br><span class=\"line\">          cli.<span class=\"title function_\">add</span>(&#123; el, binding &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;keyup&quot;</span>:</span><br><span class=\"line\">          keyup.<span class=\"title function_\">add</span>(&#123; el, binding &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;exposure&quot;</span>:</span><br><span class=\"line\">          exposure.<span class=\"title function_\">add</span>(&#123; el, binding &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">unbind</span>(<span class=\"params\">el, binding</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; arg &#125; = binding;</span><br><span class=\"line\">    arg.<span class=\"title function_\">split</span>(<span class=\"string\">&quot;|&quot;</span>).<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 点击</span></span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (item) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;click&quot;</span>:</span><br><span class=\"line\">          cli.<span class=\"title function_\">remove</span>(&#123; el, binding &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;keyup&quot;</span>:</span><br><span class=\"line\">          keyup.<span class=\"title function_\">remove</span>(&#123; el, binding &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;exposure&quot;</span>:</span><br><span class=\"line\">          exposure.<span class=\"title function_\">remove</span>(&#123; el, binding &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用</span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">  <span class=\"attr\">v-track:exposure</span>=<span class=\"string\">&quot;&#123;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">    object_ids: item.skuoid,</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">    event_type: 8,</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">    ...</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">  &#125;&quot;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">  &gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  ...</span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>文中完整代码<br><a href=\"https://github.com/l1uqi/simple-js-tracker\">github</a> &gt; <a href=\"https://www.npmjs.com/package/simple-js-tracker\">npm</a></p>\n</blockquote>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://www.ruanyifeng.com/blog/2016/11/intersectionobserver_api.html\">IntersectionObserver API 使用教程</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"什么是曝光\"><a href=\"#什么是曝光\" class=\"headerlink\" title=\"什么是曝光?\"></a>什么是曝光?</h2><p>商品曝光人数：看到商品在首页、列表页、活动页面，以及在商品详情页下方的更多展现的人数。（不包括商品详情页的访客数量）<br>商品曝光次数：商品在店铺首页、列表页、活动页面，以及在商品详情页下方的更多展现的次数。（不包括商品详情页的浏览量）</p>\n<blockquote>\n<p>通过商品曝光我们能得出商品在不同营销位的比重， 从而得出用户操作喜好</p>\n</blockquote>\n<h2 id=\"如何判断元素可视区域\"><a href=\"#如何判断元素可视区域\" class=\"headerlink\" title=\"如何判断元素可视区域?\"></a>如何判断元素可视区域?</h2><h3 id=\"Element-getBoundingClientRect\"><a href=\"#Element-getBoundingClientRect\" class=\"headerlink\" title=\"Element.getBoundingClientRect()\"></a>Element.getBoundingClientRect()</h3><p>getBoundingClientRect 方法返回一个 对象，该 DOMRect 对象提供有关元素大小及其相对于视口的位置的信息。<br>如果目标元素 rect 满足 top &gt; 0 &amp;&amp; left &gt; 0 &amp;&amp; bottom &gt;= 视窗高度 &amp;&amp; right &lt;= 视窗宽度<br>便能得出元素完全在视窗内。 在长列表下 我们可以通过监听滚动条事件， 从而获取目标元素是否暴露在用户视窗内。</p>\n<p><a href=\"https://codepen.io/l1uqi/pen/ExRZKeN\">在线代码示例 CodePen</a></p>\n<blockquote>\n<p>这种方法实现起来简单，兼容性相对较好，这个属性频繁计算会引发页面的重绘，当元素过多时，会造成性能问题，出现卡顿，影响使用体验。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 判断可视区域内</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">isElementInViewport</span> = (<span class=\"params\">el</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> rect = el.<span class=\"title function_\">getBoundingClientRect</span>();</span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    rect.<span class=\"property\">top</span> &gt;= <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">    rect.<span class=\"property\">left</span> &gt;= <span class=\"number\">0</span> &amp;&amp;</span><br><span class=\"line\">    rect.<span class=\"property\">bottom</span> &lt;=</span><br><span class=\"line\">      (<span class=\"variable language_\">window</span>.<span class=\"property\">innerHeight</span> || <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">clientHeight</span>) &amp;&amp;</span><br><span class=\"line\">    rect.<span class=\"property\">right</span> &lt;= (<span class=\"variable language_\">window</span>.<span class=\"property\">innerWidth</span> || <span class=\"variable language_\">document</span>.<span class=\"property\">documentElement</span>.<span class=\"property\">clientWidth</span>)</span><br><span class=\"line\">  );</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Intersection-Observer-API\"><a href=\"#Intersection-Observer-API\" class=\"headerlink\" title=\"Intersection Observer API\"></a>Intersection Observer API</h3><p>Intersection Observer API 提供了一种异步检测目标元素与祖先元素或 viewport 相交情况变化的方法。<br>Intersection Observer API 会注册一个回调函数，每当被监视的元素进入或者退出另外一个元素时 (或者 viewport )，或者两个元素的相交部分大小发生变化时，该回调方法会被触发执行。这样，我们网站的主线程不需要再为了监听元素相交而辛苦劳作，浏览器会自行优化元素相交管理。</p>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Intersection_Observer_API#%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7\">浏览器兼容性</a></p>\n<p><a href=\"https://codepen.io/l1uqi/pen/qBKRZLX?editors=1111\">在线代码示例 CodePen</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">intersectionObserverCallBack</span> = (<span class=\"params\">entries</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">const</span> entry <span class=\"keyword\">of</span> entries) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (entry.<span class=\"property\">isIntersecting</span>) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 可见</span></span><br><span class=\"line\">      <span class=\"keyword\">var</span> container = entry.<span class=\"property\">target</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> observer = <span class=\"keyword\">new</span> <span class=\"title class_\">IntersectionObserver</span>(intersectionObserverCallBack);</span><br><span class=\"line\"></span><br><span class=\"line\">observer.<span class=\"title function_\">observe</span>(element);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 停止观察</span></span><br><span class=\"line\">observer.<span class=\"title function_\">unobserve</span>(element);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 关闭观察器</span></span><br><span class=\"line\">observer.<span class=\"title function_\">disconnect</span>();</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://user-images.githubusercontent.com/70128222/200589085-fac93e79-b391-448b-bd81-f33cf9a352f1.gif\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>两种方案</p>\n<ul>\n<li>getBoundingClientRect 浏览器支持不错, 简单易用但是可能存在性能问题。</li>\n<li>Intersection Observer API 没有性能问题， 但是存在一定兼容性。</li>\n</ul>\n<p>好消息是我们可以使用<a href=\"https://github.com/GoogleChromeLabs/intersection-observer\">polyfill</a> 解决 Intersection Observer API 兼容性问题<br>它会在不支持的浏览器 使用 getBoundingClientRect 去重新实现一遍 Intersection Observer API。</p>\n<p><a href=\"https://github.com/GoogleChromeLabs/intersection-observer\">polyfill</a>浏览器支持:</p>\n<table>\n  <tr>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/chrome/chrome_48x48.png\" alt=\"Chrome\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/firefox/firefox_48x48.png\" alt=\"Firefox\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/safari/safari_48x48.png\" alt=\"Safari\"><br>\n      6+\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/edge/edge_48x48.png\" alt=\"Edge\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/archive/internet-explorer_7-8/internet-explorer_7-8_48x48.png\" alt=\"Internet Explorer\"><br>\n      7+\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/opera/opera_48x48.png\" alt=\"Opera\"><br>\n      ✔\n    </td>\n    <td align=\"center\">\n      <img src=\"https://raw.github.com/alrra/browser-logos/39.2.2/src/android/android_48x48.png\" alt=\"Android\"><br>\n      4.4+\n    </td>\n  </tr>\n</table>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 安装</span><br><span class=\"line\">npm install intersection-observer</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><p>曝光肯定是结合埋点一起使用， 通过采集某个商品是否出现在用户的可视区域内, 进行上报</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"title class_\">IntersectionObserver</span> <span class=\"keyword\">from</span> <span class=\"string\">&#x27;intersection-observer&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> attrName = <span class=\"string\">&#x27;exposure-data&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Exposure</span> &#123;</span><br><span class=\"line\">  private <span class=\"attr\">observer</span>: <span class=\"title class_\">IntersectionObserver</span> | <span class=\"literal\">undefined</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">init</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">IntersectionObserver</span>(<span class=\"function\">(<span class=\"params\">entries, observer</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      entries.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (item.<span class=\"property\">isIntersecting</span>) &#123;</span><br><span class=\"line\">          <span class=\"keyword\">const</span> <span class=\"attr\">el</span>: <span class=\"title class_\">Element</span> = item.<span class=\"property\">target</span></span><br><span class=\"line\">          observer!.<span class=\"title function_\">unobserve</span>(el);</span><br><span class=\"line\">          <span class=\"keyword\">const</span> arrtString = el.<span class=\"title function_\">getAttribute</span>(attrName) || <span class=\"literal\">null</span>;</span><br><span class=\"line\">          <span class=\"keyword\">if</span>(!arrtString) <span class=\"keyword\">return</span></span><br><span class=\"line\">          <span class=\"keyword\">const</span> params = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(arrtString);</span><br><span class=\"line\">          <span class=\"comment\">// 上报</span></span><br><span class=\"line\">          <span class=\"title function_\">autoSendTracker</span>(&#123;</span><br><span class=\"line\">            ...params,</span><br><span class=\"line\">          &#125;);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">add</span>(<span class=\"params\">entry: &#123; el: Element; binding: any &#125;</span>) &#123;</span><br><span class=\"line\">    entry.<span class=\"property\">el</span>.<span class=\"title function_\">setAttribute</span>(attrName, <span class=\"keyword\">typeof</span> entry.<span class=\"property\">binding</span>.<span class=\"property\">value</span> === <span class=\"string\">&#x27;string&#x27;</span> ? entry.<span class=\"property\">binding</span>.<span class=\"property\">value</span> : <span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(entry.<span class=\"property\">binding</span>.<span class=\"property\">value</span>))</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable language_\">this</span>.<span class=\"property\">observer</span> === <span class=\"literal\">undefined</span>) &#123;</span><br><span class=\"line\">      <span class=\"variable language_\">this</span>.<span class=\"property\">observer</span> = <span class=\"variable language_\">this</span>.<span class=\"title function_\">init</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">observer</span>.<span class=\"title function_\">observe</span>(entry.<span class=\"property\">el</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"title function_\">remove</span>(<span class=\"params\">entry: &#123; el: Element; binding?: any &#125;</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">observer</span>?.<span class=\"title function_\">unobserve</span>(entry.<span class=\"property\">el</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">observer</span>?.<span class=\"title function_\">disconnect</span>();</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Exposure</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> exposure = <span class=\"keyword\">new</span> <span class=\"title class_\">Exposure</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 自定义指令</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> track = &#123;</span><br><span class=\"line\">  <span class=\"attr\">inserted</span>: <span class=\"keyword\">function</span> (<span class=\"params\">el: any, binding: &#123; arg: any &#125;</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; arg &#125; = binding;</span><br><span class=\"line\">    arg.<span class=\"title function_\">split</span>(<span class=\"string\">&quot;|&quot;</span>).<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 点击</span></span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (item) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;click&quot;</span>:</span><br><span class=\"line\">          cli.<span class=\"title function_\">add</span>(&#123; el, binding &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;keyup&quot;</span>:</span><br><span class=\"line\">          keyup.<span class=\"title function_\">add</span>(&#123; el, binding &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;exposure&quot;</span>:</span><br><span class=\"line\">          exposure.<span class=\"title function_\">add</span>(&#123; el, binding &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"title function_\">unbind</span>(<span class=\"params\">el, binding</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> &#123; arg &#125; = binding;</span><br><span class=\"line\">    arg.<span class=\"title function_\">split</span>(<span class=\"string\">&quot;|&quot;</span>).<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">item</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 点击</span></span><br><span class=\"line\">      <span class=\"keyword\">switch</span> (item) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;click&quot;</span>:</span><br><span class=\"line\">          cli.<span class=\"title function_\">remove</span>(&#123; el, binding &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;keyup&quot;</span>:</span><br><span class=\"line\">          keyup.<span class=\"title function_\">remove</span>(&#123; el, binding &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"string\">&quot;exposure&quot;</span>:</span><br><span class=\"line\">          exposure.<span class=\"title function_\">remove</span>(&#123; el, binding &#125;);</span><br><span class=\"line\">          <span class=\"keyword\">break</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 使用</span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">  <span class=\"attr\">v-track:exposure</span>=<span class=\"string\">&quot;&#123;</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">    object_ids: item.skuoid,</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">    event_type: 8,</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">    ...</span></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"tag\"><span class=\"language-xml\">  &#125;&quot;</span></span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"language-xml\">  &gt;</span></span></span><br><span class=\"line\"><span class=\"language-xml\">  ...</span></span><br><span class=\"line\"><span class=\"language-xml\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>文中完整代码<br><a href=\"https://github.com/l1uqi/simple-js-tracker\">github</a> &gt; <a href=\"https://www.npmjs.com/package/simple-js-tracker\">npm</a></p>\n</blockquote>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://www.ruanyifeng.com/blog/2016/11/intersectionobserver_api.html\">IntersectionObserver API 使用教程</a></p>\n"},{"title":"JS Image加载遇到的问题","date":"2022-11-14T16:00:00.000Z","top_img":false,"cover":"https://raw.githubusercontent.com/l1uqi/PicGo/main/blog/1007338.jpg","_content":"\n## 背景\n\n最近在做前端业务埋点, 遇到的问题。\n业务场景是在列表中监听商品是否曝光, 如果用户可见就进行商品上报。\n上报是用 Image()传输。\n\n[为什么要用 image 进行埋点上报](https://hello7cat.com/2022/11/10/前端业务埋点数据上报/)\n\n```js\n// str 传参\nconst img = new Image();\nimg.src = `${url}?${str}`;\n```\n\n## 问题\n\n[浏览器并发请求资源数](https://www.zhihu.com/question/20474326)\n浏览器的并发请求数目限制是针对同一域名的。\n同一时间针对同一域名下的请求有一定数量限制。超过限制数目的请求会被阻塞。\n\n以 chrome 为例浏览器同域名下资源加载的最大并发连接数为 6，当资源文件大于 6 时，多于 6 个的文件就会进入待定，等第一批加载完才会加载第二批的 6 个图片资源，这样就增加了等待时间。无形中就增加用户加载网页等待的时间；\n\n当时在测试环境下, 后端接口在更新, 导致上报请求未能完成。\n列表曝光又是逐个进行上报(偷懒了没有合并上传), 遇上了浏览器并发请求限制!\n当时页面与接口又是同域名, 从而导致用户无法进行操作(因为网络请求阻塞导致)\n\n---\n\n## 解决\n\n### 域名分片\n\n由于浏览器限制了每个域（domain）的活动连接数。为了可以同时下载超过该限制数的资源，域名分片（domain sharding）会将内容拆分到多个子域中。当使用多个域来处理多个资源时，浏览器能够同时下载更多资源，从而缩短了页面加载时间并改善了用户体验。\n\n比如 jd.com 随便找张图片\n如下:\nhttps://img10.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif\nhttps://img11.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif\nhttps://img12.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif\n\n修改 img1, 10, 11, 12.. 都能够访问\n\n### HTTP/2\n\n由于 HTTP/2 没有限制并发请求（unlimited concurrent requests），因此启用 HTTP/2 后，就没必要再使用域名分片来解决并发限制了。\n\n>由于以上都不适用埋点上报的场景 T T.\nImage() 又不能设置请求超时时间, 所以只能进行 src 置空\n用setTimeout 设置1s后替换src为空(埋点上报1s足够了)\n目前看起来是没问题了。\n\n```js\nconst timeout = 1000;\nconst img = new Image();\nimg.src = `${url}?${str}`;\n\nsetTimeout(() => {\n  img.src = \"\";\n}, timeout);\n```\n\n如有错误, 还望指正！\n","source":"_posts/JS Image加载遇到的问题.md","raw":"---\ntitle: JS Image加载遇到的问题\ndate: 2022-11-15\ntop_img: false\ncategories:\n  - 前端\ntags:\n  - 图片加载\ncover: https://raw.githubusercontent.com/l1uqi/PicGo/main/blog/1007338.jpg\n---\n\n## 背景\n\n最近在做前端业务埋点, 遇到的问题。\n业务场景是在列表中监听商品是否曝光, 如果用户可见就进行商品上报。\n上报是用 Image()传输。\n\n[为什么要用 image 进行埋点上报](https://hello7cat.com/2022/11/10/前端业务埋点数据上报/)\n\n```js\n// str 传参\nconst img = new Image();\nimg.src = `${url}?${str}`;\n```\n\n## 问题\n\n[浏览器并发请求资源数](https://www.zhihu.com/question/20474326)\n浏览器的并发请求数目限制是针对同一域名的。\n同一时间针对同一域名下的请求有一定数量限制。超过限制数目的请求会被阻塞。\n\n以 chrome 为例浏览器同域名下资源加载的最大并发连接数为 6，当资源文件大于 6 时，多于 6 个的文件就会进入待定，等第一批加载完才会加载第二批的 6 个图片资源，这样就增加了等待时间。无形中就增加用户加载网页等待的时间；\n\n当时在测试环境下, 后端接口在更新, 导致上报请求未能完成。\n列表曝光又是逐个进行上报(偷懒了没有合并上传), 遇上了浏览器并发请求限制!\n当时页面与接口又是同域名, 从而导致用户无法进行操作(因为网络请求阻塞导致)\n\n---\n\n## 解决\n\n### 域名分片\n\n由于浏览器限制了每个域（domain）的活动连接数。为了可以同时下载超过该限制数的资源，域名分片（domain sharding）会将内容拆分到多个子域中。当使用多个域来处理多个资源时，浏览器能够同时下载更多资源，从而缩短了页面加载时间并改善了用户体验。\n\n比如 jd.com 随便找张图片\n如下:\nhttps://img10.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif\nhttps://img11.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif\nhttps://img12.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif\n\n修改 img1, 10, 11, 12.. 都能够访问\n\n### HTTP/2\n\n由于 HTTP/2 没有限制并发请求（unlimited concurrent requests），因此启用 HTTP/2 后，就没必要再使用域名分片来解决并发限制了。\n\n>由于以上都不适用埋点上报的场景 T T.\nImage() 又不能设置请求超时时间, 所以只能进行 src 置空\n用setTimeout 设置1s后替换src为空(埋点上报1s足够了)\n目前看起来是没问题了。\n\n```js\nconst timeout = 1000;\nconst img = new Image();\nimg.src = `${url}?${str}`;\n\nsetTimeout(() => {\n  img.src = \"\";\n}, timeout);\n```\n\n如有错误, 还望指正！\n","slug":"JS Image加载遇到的问题","published":1,"updated":"2022-11-16T02:05:43.664Z","_id":"claixhyfr00007c77fe8id3qn","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>最近在做前端业务埋点, 遇到的问题。<br>业务场景是在列表中监听商品是否曝光, 如果用户可见就进行商品上报。<br>上报是用 Image()传输。</p>\n<p><a href=\"https://hello7cat.com/2022/11/10/%E5%89%8D%E7%AB%AF%E4%B8%9A%E5%8A%A1%E5%9F%8B%E7%82%B9%E6%95%B0%E6%8D%AE%E4%B8%8A%E6%8A%A5/\">为什么要用 image 进行埋点上报</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// str 传参</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> img = <span class=\"keyword\">new</span> <span class=\"title class_\">Image</span>();</span><br><span class=\"line\">img.<span class=\"property\">src</span> = <span class=\"string\">`<span class=\"subst\">$&#123;url&#125;</span>?<span class=\"subst\">$&#123;str&#125;</span>`</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h2><p><a href=\"https://www.zhihu.com/question/20474326\">浏览器并发请求资源数</a><br>浏览器的并发请求数目限制是针对同一域名的。<br>同一时间针对同一域名下的请求有一定数量限制。超过限制数目的请求会被阻塞。</p>\n<p>以 chrome 为例浏览器同域名下资源加载的最大并发连接数为 6，当资源文件大于 6 时，多于 6 个的文件就会进入待定，等第一批加载完才会加载第二批的 6 个图片资源，这样就增加了等待时间。无形中就增加用户加载网页等待的时间；</p>\n<p>当时在测试环境下, 后端接口在更新, 导致上报请求未能完成。<br>列表曝光又是逐个进行上报(偷懒了没有合并上传), 遇上了浏览器并发请求限制!<br>当时页面与接口又是同域名, 从而导致用户无法进行操作(因为网络请求阻塞导致)</p>\n<hr>\n<h2 id=\"解决\"><a href=\"#解决\" class=\"headerlink\" title=\"解决\"></a>解决</h2><h3 id=\"域名分片\"><a href=\"#域名分片\" class=\"headerlink\" title=\"域名分片\"></a>域名分片</h3><p>由于浏览器限制了每个域（domain）的活动连接数。为了可以同时下载超过该限制数的资源，域名分片（domain sharding）会将内容拆分到多个子域中。当使用多个域来处理多个资源时，浏览器能够同时下载更多资源，从而缩短了页面加载时间并改善了用户体验。</p>\n<p>比如 jd.com 随便找张图片<br>如下:<br><a href=\"https://img10.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif\">https://img10.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif</a><br><a href=\"https://img11.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif\">https://img11.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif</a><br><a href=\"https://img12.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif\">https://img12.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif</a></p>\n<p>修改 img1, 10, 11, 12.. 都能够访问</p>\n<h3 id=\"HTTP-2\"><a href=\"#HTTP-2\" class=\"headerlink\" title=\"HTTP/2\"></a>HTTP/2</h3><p>由于 HTTP/2 没有限制并发请求（unlimited concurrent requests），因此启用 HTTP/2 后，就没必要再使用域名分片来解决并发限制了。</p>\n<blockquote>\n<p>由于以上都不适用埋点上报的场景 T T.<br>Image() 又不能设置请求超时时间, 所以只能进行 src 置空<br>用setTimeout 设置1s后替换src为空(埋点上报1s足够了)<br>目前看起来是没问题了。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> timeout = <span class=\"number\">1000</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> img = <span class=\"keyword\">new</span> <span class=\"title class_\">Image</span>();</span><br><span class=\"line\">img.<span class=\"property\">src</span> = <span class=\"string\">`<span class=\"subst\">$&#123;url&#125;</span>?<span class=\"subst\">$&#123;str&#125;</span>`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  img.<span class=\"property\">src</span> = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">&#125;, timeout);</span><br></pre></td></tr></table></figure>\n\n<p>如有错误, 还望指正！</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"背景\"><a href=\"#背景\" class=\"headerlink\" title=\"背景\"></a>背景</h2><p>最近在做前端业务埋点, 遇到的问题。<br>业务场景是在列表中监听商品是否曝光, 如果用户可见就进行商品上报。<br>上报是用 Image()传输。</p>\n<p><a href=\"https://hello7cat.com/2022/11/10/%E5%89%8D%E7%AB%AF%E4%B8%9A%E5%8A%A1%E5%9F%8B%E7%82%B9%E6%95%B0%E6%8D%AE%E4%B8%8A%E6%8A%A5/\">为什么要用 image 进行埋点上报</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// str 传参</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> img = <span class=\"keyword\">new</span> <span class=\"title class_\">Image</span>();</span><br><span class=\"line\">img.<span class=\"property\">src</span> = <span class=\"string\">`<span class=\"subst\">$&#123;url&#125;</span>?<span class=\"subst\">$&#123;str&#125;</span>`</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"问题\"><a href=\"#问题\" class=\"headerlink\" title=\"问题\"></a>问题</h2><p><a href=\"https://www.zhihu.com/question/20474326\">浏览器并发请求资源数</a><br>浏览器的并发请求数目限制是针对同一域名的。<br>同一时间针对同一域名下的请求有一定数量限制。超过限制数目的请求会被阻塞。</p>\n<p>以 chrome 为例浏览器同域名下资源加载的最大并发连接数为 6，当资源文件大于 6 时，多于 6 个的文件就会进入待定，等第一批加载完才会加载第二批的 6 个图片资源，这样就增加了等待时间。无形中就增加用户加载网页等待的时间；</p>\n<p>当时在测试环境下, 后端接口在更新, 导致上报请求未能完成。<br>列表曝光又是逐个进行上报(偷懒了没有合并上传), 遇上了浏览器并发请求限制!<br>当时页面与接口又是同域名, 从而导致用户无法进行操作(因为网络请求阻塞导致)</p>\n<hr>\n<h2 id=\"解决\"><a href=\"#解决\" class=\"headerlink\" title=\"解决\"></a>解决</h2><h3 id=\"域名分片\"><a href=\"#域名分片\" class=\"headerlink\" title=\"域名分片\"></a>域名分片</h3><p>由于浏览器限制了每个域（domain）的活动连接数。为了可以同时下载超过该限制数的资源，域名分片（domain sharding）会将内容拆分到多个子域中。当使用多个域来处理多个资源时，浏览器能够同时下载更多资源，从而缩短了页面加载时间并改善了用户体验。</p>\n<p>比如 jd.com 随便找张图片<br>如下:<br><a href=\"https://img10.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif\">https://img10.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif</a><br><a href=\"https://img11.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif\">https://img11.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif</a><br><a href=\"https://img12.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif\">https://img12.360buyimg.com/seckillcms/s280x280_jfs/t1/216379/19/19449/40977/628c9742Ee1612b6f/e032fe03d144ce2c.jpg.avif</a></p>\n<p>修改 img1, 10, 11, 12.. 都能够访问</p>\n<h3 id=\"HTTP-2\"><a href=\"#HTTP-2\" class=\"headerlink\" title=\"HTTP/2\"></a>HTTP/2</h3><p>由于 HTTP/2 没有限制并发请求（unlimited concurrent requests），因此启用 HTTP/2 后，就没必要再使用域名分片来解决并发限制了。</p>\n<blockquote>\n<p>由于以上都不适用埋点上报的场景 T T.<br>Image() 又不能设置请求超时时间, 所以只能进行 src 置空<br>用setTimeout 设置1s后替换src为空(埋点上报1s足够了)<br>目前看起来是没问题了。</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> timeout = <span class=\"number\">1000</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> img = <span class=\"keyword\">new</span> <span class=\"title class_\">Image</span>();</span><br><span class=\"line\">img.<span class=\"property\">src</span> = <span class=\"string\">`<span class=\"subst\">$&#123;url&#125;</span>?<span class=\"subst\">$&#123;str&#125;</span>`</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">setTimeout</span>(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  img.<span class=\"property\">src</span> = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">&#125;, timeout);</span><br></pre></td></tr></table></figure>\n\n<p>如有错误, 还望指正！</p>\n"},{"title":"前端业务埋点-数据上报","top_img":false,"date":"2022-11-09T16:00:00.000Z","cover":"https://raw.githubusercontent.com/l1uqi/PicGo/main/blog/899633.png","_content":"\n## 上报方式\n\n我们采集了埋点数据后, 就需要把采集的数据交给后端。\n那么我们应该如何上报?\n我们得考虑接口跨域、上报异常(正在进行上报时, 用户关闭了页面, 这样上报就会失败)、性能要求(不能应用应用使用)\n\n基于以上要求, 提供了三种方式供用户自行选择\n\n- sendBeacon\n  浏览器引入的 sendBeacon 方法，发出的是异步请求，但是请求是作为浏览器任务执行的，\n  与当前页面是脱钩的。因此该方法不会阻塞页面卸载流程和延迟后面页面的加载，用户体验较好。\n  缺点： 浏览器存在支持问题\n- img\n\n  避免跨域\n  1x1 像素 img 对网页内容的影响几乎没有影响\n  图片请求不占用 Ajax 请求限额\n  不会阻塞页面加载，影响用户的体验\n  相比 XMLHttpRequest 对象发送 GET 请求，性能上更好\n  触发 GET 请求之后不需要获取和处理数据、服务器也不需要发送数据\n\n- post\n  超出 get 最大请求数、或者用户手动进行上报方式配置则会采用 post\n\n默认情况下优先级 sendBeacon > img > post\n\n```js\n// 判断上传长度 2000 个字符\nconst urlIsLong = (url: string) => {\n  let totalLength = 0,\n    charCode = 0;\n  for (var i = 0; i < url.length; i++) {\n    charCode = url.charCodeAt(i);\n    if (charCode < 0x007f) {\n      totalLength++;\n    } else if (0x0080 <= charCode && charCode <= 0x07ff) {\n      totalLength += 2;\n    } else if (0x0800 <= charCode && charCode <= 0xffff) {\n      totalLength += 3;\n    }\n  }\n  return totalLength < 2000 ? false : true;\n};\n\nif (navigator.sendBeacon) {\n  sendBeacon(url, params);\n} else if (method === \"POST\" || urlIsLong(str)) {\n  xmlRequest(url, params);\n} else {\n  const img = new Image();\n  img.src = `${url}?${str}`;\n}\n```\n\n## 上报拦截\n\n用户可能需要在上传前对参数进行变更, 我们可以在上报前提供拦截器给用户进行变更参数操作。\n这里借鉴[Axios Interceptor](https://sourcegraph.com/github.com/axios/axios/-/blob/lib/core/InterceptorManager.js)拦截器实现\n\n```js\nclass Interceptor {\n  private handlers;\n  constructor() {\n    this.handlers = [];\n  }\n\n  // params promise then resolve reject\n  use(fulfilled, rejected, options) {\n    this.handlers.push({\n      fulfilled,\n      rejected\n    });\n  }\n  ...\n}\n\nexport default Interceptor;\n\nclass SimpleJsTracker {\n  constructor(options: IDefaultOptions) {\n    this['_init'](options);\n    this['interceptors'] = {\n      sendTracker: new Interceptor()\n    }\n  }\n  ...\n}\n\nSJTracker.prototype.sendTracker = function (data = {}) {\n  let reportData = Object.assign(Object.assign({}, this._options), data);\n  // 调用拦截方法\n  this.interceptors.sendTracker.handlers.forEach((interceptor) => {\n    const onFulfilled = interceptor.fulfilled;\n    reportData = onFulfilled(reportData);\n  });\n  sendTracker(this._options, reportData);\n};\n\n\n\n```\n\n> 文中完整代码\n> [github](https://github.com/l1uqi/simple-js-tracker) > [npm](https://www.npmjs.com/package/simple-js-tracker)\n","source":"_posts/前端业务埋点数据上报.md","raw":"---\ntitle: 前端业务埋点-数据上报\ntop_img: false\ndate: 2022-11-10\ncategories:\n  - 前端\ntags:\n  - 埋点采集\ncover: https://raw.githubusercontent.com/l1uqi/PicGo/main/blog/899633.png\n---\n\n## 上报方式\n\n我们采集了埋点数据后, 就需要把采集的数据交给后端。\n那么我们应该如何上报?\n我们得考虑接口跨域、上报异常(正在进行上报时, 用户关闭了页面, 这样上报就会失败)、性能要求(不能应用应用使用)\n\n基于以上要求, 提供了三种方式供用户自行选择\n\n- sendBeacon\n  浏览器引入的 sendBeacon 方法，发出的是异步请求，但是请求是作为浏览器任务执行的，\n  与当前页面是脱钩的。因此该方法不会阻塞页面卸载流程和延迟后面页面的加载，用户体验较好。\n  缺点： 浏览器存在支持问题\n- img\n\n  避免跨域\n  1x1 像素 img 对网页内容的影响几乎没有影响\n  图片请求不占用 Ajax 请求限额\n  不会阻塞页面加载，影响用户的体验\n  相比 XMLHttpRequest 对象发送 GET 请求，性能上更好\n  触发 GET 请求之后不需要获取和处理数据、服务器也不需要发送数据\n\n- post\n  超出 get 最大请求数、或者用户手动进行上报方式配置则会采用 post\n\n默认情况下优先级 sendBeacon > img > post\n\n```js\n// 判断上传长度 2000 个字符\nconst urlIsLong = (url: string) => {\n  let totalLength = 0,\n    charCode = 0;\n  for (var i = 0; i < url.length; i++) {\n    charCode = url.charCodeAt(i);\n    if (charCode < 0x007f) {\n      totalLength++;\n    } else if (0x0080 <= charCode && charCode <= 0x07ff) {\n      totalLength += 2;\n    } else if (0x0800 <= charCode && charCode <= 0xffff) {\n      totalLength += 3;\n    }\n  }\n  return totalLength < 2000 ? false : true;\n};\n\nif (navigator.sendBeacon) {\n  sendBeacon(url, params);\n} else if (method === \"POST\" || urlIsLong(str)) {\n  xmlRequest(url, params);\n} else {\n  const img = new Image();\n  img.src = `${url}?${str}`;\n}\n```\n\n## 上报拦截\n\n用户可能需要在上传前对参数进行变更, 我们可以在上报前提供拦截器给用户进行变更参数操作。\n这里借鉴[Axios Interceptor](https://sourcegraph.com/github.com/axios/axios/-/blob/lib/core/InterceptorManager.js)拦截器实现\n\n```js\nclass Interceptor {\n  private handlers;\n  constructor() {\n    this.handlers = [];\n  }\n\n  // params promise then resolve reject\n  use(fulfilled, rejected, options) {\n    this.handlers.push({\n      fulfilled,\n      rejected\n    });\n  }\n  ...\n}\n\nexport default Interceptor;\n\nclass SimpleJsTracker {\n  constructor(options: IDefaultOptions) {\n    this['_init'](options);\n    this['interceptors'] = {\n      sendTracker: new Interceptor()\n    }\n  }\n  ...\n}\n\nSJTracker.prototype.sendTracker = function (data = {}) {\n  let reportData = Object.assign(Object.assign({}, this._options), data);\n  // 调用拦截方法\n  this.interceptors.sendTracker.handlers.forEach((interceptor) => {\n    const onFulfilled = interceptor.fulfilled;\n    reportData = onFulfilled(reportData);\n  });\n  sendTracker(this._options, reportData);\n};\n\n\n\n```\n\n> 文中完整代码\n> [github](https://github.com/l1uqi/simple-js-tracker) > [npm](https://www.npmjs.com/package/simple-js-tracker)\n","slug":"前端业务埋点数据上报","published":1,"updated":"2022-12-06T05:46:53.211Z","_id":"claj0dz6k0000gc772efpfme6","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"上报方式\"><a href=\"#上报方式\" class=\"headerlink\" title=\"上报方式\"></a>上报方式</h2><p>我们采集了埋点数据后, 就需要把采集的数据交给后端。<br>那么我们应该如何上报?<br>我们得考虑接口跨域、上报异常(正在进行上报时, 用户关闭了页面, 这样上报就会失败)、性能要求(不能应用应用使用)</p>\n<p>基于以上要求, 提供了三种方式供用户自行选择</p>\n<ul>\n<li><p>sendBeacon<br>浏览器引入的 sendBeacon 方法，发出的是异步请求，但是请求是作为浏览器任务执行的，<br>与当前页面是脱钩的。因此该方法不会阻塞页面卸载流程和延迟后面页面的加载，用户体验较好。<br>缺点： 浏览器存在支持问题</p>\n</li>\n<li><p>img</p>\n<p>避免跨域<br>1x1 像素 img 对网页内容的影响几乎没有影响<br>图片请求不占用 Ajax 请求限额<br>不会阻塞页面加载，影响用户的体验<br>相比 XMLHttpRequest 对象发送 GET 请求，性能上更好<br>触发 GET 请求之后不需要获取和处理数据、服务器也不需要发送数据</p>\n</li>\n<li><p>post<br>超出 get 最大请求数、或者用户手动进行上报方式配置则会采用 post</p>\n</li>\n</ul>\n<p>默认情况下优先级 sendBeacon &gt; img &gt; post</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 判断上传长度 2000 个字符</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">urlIsLong</span> = (<span class=\"params\">url: string</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> totalLength = <span class=\"number\">0</span>,</span><br><span class=\"line\">    charCode = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; url.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">    charCode = url.<span class=\"title function_\">charCodeAt</span>(i);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (charCode &lt; <span class=\"number\">0x007f</span>) &#123;</span><br><span class=\"line\">      totalLength++;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"number\">0x0080</span> &lt;= charCode &amp;&amp; charCode &lt;= <span class=\"number\">0x07ff</span>) &#123;</span><br><span class=\"line\">      totalLength += <span class=\"number\">2</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"number\">0x0800</span> &lt;= charCode &amp;&amp; charCode &lt;= <span class=\"number\">0xffff</span>) &#123;</span><br><span class=\"line\">      totalLength += <span class=\"number\">3</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> totalLength &lt; <span class=\"number\">2000</span> ? <span class=\"literal\">false</span> : <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (navigator.<span class=\"property\">sendBeacon</span>) &#123;</span><br><span class=\"line\">  <span class=\"title function_\">sendBeacon</span>(url, params);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method === <span class=\"string\">&quot;POST&quot;</span> || <span class=\"title function_\">urlIsLong</span>(str)) &#123;</span><br><span class=\"line\">  <span class=\"title function_\">xmlRequest</span>(url, params);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> img = <span class=\"keyword\">new</span> <span class=\"title class_\">Image</span>();</span><br><span class=\"line\">  img.<span class=\"property\">src</span> = <span class=\"string\">`<span class=\"subst\">$&#123;url&#125;</span>?<span class=\"subst\">$&#123;str&#125;</span>`</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"上报拦截\"><a href=\"#上报拦截\" class=\"headerlink\" title=\"上报拦截\"></a>上报拦截</h2><p>用户可能需要在上传前对参数进行变更, 我们可以在上报前提供拦截器给用户进行变更参数操作。<br>这里借鉴<a href=\"https://sourcegraph.com/github.com/axios/axios/-/blob/lib/core/InterceptorManager.js\">Axios Interceptor</a>拦截器实现</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Interceptor</span> &#123;</span><br><span class=\"line\">  private handlers;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">handlers</span> = [];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// params promise then resolve reject</span></span><br><span class=\"line\">  <span class=\"title function_\">use</span>(<span class=\"params\">fulfilled, rejected, options</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">handlers</span>.<span class=\"title function_\">push</span>(&#123;</span><br><span class=\"line\">      fulfilled,</span><br><span class=\"line\">      rejected</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Interceptor</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">SimpleJsTracker</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">options: IDefaultOptions</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>[<span class=\"string\">&#x27;_init&#x27;</span>](options);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>[<span class=\"string\">&#x27;interceptors&#x27;</span>] = &#123;</span><br><span class=\"line\">      <span class=\"attr\">sendTracker</span>: <span class=\"keyword\">new</span> <span class=\"title class_\">Interceptor</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">SJTracker</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">sendTracker</span> = <span class=\"keyword\">function</span> (<span class=\"params\">data = &#123;&#125;</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> reportData = <span class=\"title class_\">Object</span>.<span class=\"title function_\">assign</span>(<span class=\"title class_\">Object</span>.<span class=\"title function_\">assign</span>(&#123;&#125;, <span class=\"variable language_\">this</span>.<span class=\"property\">_options</span>), data);</span><br><span class=\"line\">  <span class=\"comment\">// 调用拦截方法</span></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">interceptors</span>.<span class=\"property\">sendTracker</span>.<span class=\"property\">handlers</span>.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">interceptor</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> onFulfilled = interceptor.<span class=\"property\">fulfilled</span>;</span><br><span class=\"line\">    reportData = <span class=\"title function_\">onFulfilled</span>(reportData);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"title function_\">sendTracker</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">_options</span>, reportData);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>文中完整代码<br><a href=\"https://github.com/l1uqi/simple-js-tracker\">github</a> &gt; <a href=\"https://www.npmjs.com/package/simple-js-tracker\">npm</a></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"上报方式\"><a href=\"#上报方式\" class=\"headerlink\" title=\"上报方式\"></a>上报方式</h2><p>我们采集了埋点数据后, 就需要把采集的数据交给后端。<br>那么我们应该如何上报?<br>我们得考虑接口跨域、上报异常(正在进行上报时, 用户关闭了页面, 这样上报就会失败)、性能要求(不能应用应用使用)</p>\n<p>基于以上要求, 提供了三种方式供用户自行选择</p>\n<ul>\n<li><p>sendBeacon<br>浏览器引入的 sendBeacon 方法，发出的是异步请求，但是请求是作为浏览器任务执行的，<br>与当前页面是脱钩的。因此该方法不会阻塞页面卸载流程和延迟后面页面的加载，用户体验较好。<br>缺点： 浏览器存在支持问题</p>\n</li>\n<li><p>img</p>\n<p>避免跨域<br>1x1 像素 img 对网页内容的影响几乎没有影响<br>图片请求不占用 Ajax 请求限额<br>不会阻塞页面加载，影响用户的体验<br>相比 XMLHttpRequest 对象发送 GET 请求，性能上更好<br>触发 GET 请求之后不需要获取和处理数据、服务器也不需要发送数据</p>\n</li>\n<li><p>post<br>超出 get 最大请求数、或者用户手动进行上报方式配置则会采用 post</p>\n</li>\n</ul>\n<p>默认情况下优先级 sendBeacon &gt; img &gt; post</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 判断上传长度 2000 个字符</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">urlIsLong</span> = (<span class=\"params\">url: string</span>) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> totalLength = <span class=\"number\">0</span>,</span><br><span class=\"line\">    charCode = <span class=\"number\">0</span>;</span><br><span class=\"line\">  <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; url.<span class=\"property\">length</span>; i++) &#123;</span><br><span class=\"line\">    charCode = url.<span class=\"title function_\">charCodeAt</span>(i);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (charCode &lt; <span class=\"number\">0x007f</span>) &#123;</span><br><span class=\"line\">      totalLength++;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"number\">0x0080</span> &lt;= charCode &amp;&amp; charCode &lt;= <span class=\"number\">0x07ff</span>) &#123;</span><br><span class=\"line\">      totalLength += <span class=\"number\">2</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"number\">0x0800</span> &lt;= charCode &amp;&amp; charCode &lt;= <span class=\"number\">0xffff</span>) &#123;</span><br><span class=\"line\">      totalLength += <span class=\"number\">3</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> totalLength &lt; <span class=\"number\">2000</span> ? <span class=\"literal\">false</span> : <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (navigator.<span class=\"property\">sendBeacon</span>) &#123;</span><br><span class=\"line\">  <span class=\"title function_\">sendBeacon</span>(url, params);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (method === <span class=\"string\">&quot;POST&quot;</span> || <span class=\"title function_\">urlIsLong</span>(str)) &#123;</span><br><span class=\"line\">  <span class=\"title function_\">xmlRequest</span>(url, params);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> img = <span class=\"keyword\">new</span> <span class=\"title class_\">Image</span>();</span><br><span class=\"line\">  img.<span class=\"property\">src</span> = <span class=\"string\">`<span class=\"subst\">$&#123;url&#125;</span>?<span class=\"subst\">$&#123;str&#125;</span>`</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"上报拦截\"><a href=\"#上报拦截\" class=\"headerlink\" title=\"上报拦截\"></a>上报拦截</h2><p>用户可能需要在上传前对参数进行变更, 我们可以在上报前提供拦截器给用户进行变更参数操作。<br>这里借鉴<a href=\"https://sourcegraph.com/github.com/axios/axios/-/blob/lib/core/InterceptorManager.js\">Axios Interceptor</a>拦截器实现</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Interceptor</span> &#123;</span><br><span class=\"line\">  private handlers;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">handlers</span> = [];</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// params promise then resolve reject</span></span><br><span class=\"line\">  <span class=\"title function_\">use</span>(<span class=\"params\">fulfilled, rejected, options</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">handlers</span>.<span class=\"title function_\">push</span>(&#123;</span><br><span class=\"line\">      fulfilled,</span><br><span class=\"line\">      rejected</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"title class_\">Interceptor</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">SimpleJsTracker</span> &#123;</span><br><span class=\"line\">  <span class=\"title function_\">constructor</span>(<span class=\"params\">options: IDefaultOptions</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>[<span class=\"string\">&#x27;_init&#x27;</span>](options);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>[<span class=\"string\">&#x27;interceptors&#x27;</span>] = &#123;</span><br><span class=\"line\">      <span class=\"attr\">sendTracker</span>: <span class=\"keyword\">new</span> <span class=\"title class_\">Interceptor</span>()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  ...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title class_\">SJTracker</span>.<span class=\"property\"><span class=\"keyword\">prototype</span></span>.<span class=\"property\">sendTracker</span> = <span class=\"keyword\">function</span> (<span class=\"params\">data = &#123;&#125;</span>) &#123;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> reportData = <span class=\"title class_\">Object</span>.<span class=\"title function_\">assign</span>(<span class=\"title class_\">Object</span>.<span class=\"title function_\">assign</span>(&#123;&#125;, <span class=\"variable language_\">this</span>.<span class=\"property\">_options</span>), data);</span><br><span class=\"line\">  <span class=\"comment\">// 调用拦截方法</span></span><br><span class=\"line\">  <span class=\"variable language_\">this</span>.<span class=\"property\">interceptors</span>.<span class=\"property\">sendTracker</span>.<span class=\"property\">handlers</span>.<span class=\"title function_\">forEach</span>(<span class=\"function\">(<span class=\"params\">interceptor</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> onFulfilled = interceptor.<span class=\"property\">fulfilled</span>;</span><br><span class=\"line\">    reportData = <span class=\"title function_\">onFulfilled</span>(reportData);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">  <span class=\"title function_\">sendTracker</span>(<span class=\"variable language_\">this</span>.<span class=\"property\">_options</span>, reportData);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>文中完整代码<br><a href=\"https://github.com/l1uqi/simple-js-tracker\">github</a> &gt; <a href=\"https://www.npmjs.com/package/simple-js-tracker\">npm</a></p>\n</blockquote>\n"},{"title":"JS对象中addEventListener this指向","top_img":false,"date":"2023-02-02T16:00:00.000Z","cover":"https://img0.baidu.com/it/u=2395867072,4290056404&fm=253&fmt=auto&app=120&f=JPEG?w=798&h=500","_content":"\n最近使用canvas在实现拖拽功能, 需要监听鼠标按下跟移动事件。所以创建canvas js对象来统一管理。\n但是遇到了addEventListener指向了当前元素, 导致监听事件无法移除出现问题。\n\n``` js\nexport default class FlowChatCanvas {\n  // ...业务代码省略\n  mousedown() {\n    // 此时this指向了元素本身 \n    console.log(this);\n    // 需要在鼠标按下的同时, 监听鼠标移动\n    this.canvas.addEventListener('mouseup', this.mouseup, false);\n    this.canvas.addEventListener('mousemove', this.mousemove, false);\n  }\n\n  mouseup() {}\n\n  mousemove() {}\n\n  registerEvents() {\n    this.canvas.addEventListener('mousedown', this.mousedown, false);\n  }\n}\n```\n\n### 解决\n首先想到的就是使用Bind去修改this\n```js\nthis.canvas.addEventListener('mousedown', this.mousedown.bind(this), false);\n```\n\n显而易见现在的mousedown方法中this 已经指向了对象本身。\n但是缺陷就是监听事件没法移除, 如果你不需要移除事件的话 那么这一步就能解决问题了。\n\n```js\nmousedown() {\n    // 需要在鼠标按下的同时, 监听鼠标移动\n    this.canvas.addEventListener('mouseup', this.mouseup.bind(this), false);\n    this.canvas.addEventListener('mousemove', this.mousemove.bind(this), false);\n  }\n\n  mouseup() {\n    // 鼠标松开时, 移除move事件\n    // 但是由于使用bind 导致无法移除\n    this.canvas.removeEventListener('mousemove', this.mousemove);\n    this.canvas.removeEventListener('mouseup', this.mouseup);\n  }\n\n  mousemove(e) {\n    console.log(this);\n  }\n\n  registerEvents() {\n    this.canvas.addEventListener('mousedown', this.mousedown.bind(this), false);\n  }\n```\n\n\n查阅mdn发现, 除了bind指定this值外 还可以使用handleEvent() 这个特殊函数来捕获任何事件\n\n[MDN addEventListener 处理过程中 this 的值的问题](https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener#%E5%A4%87%E6%B3%A8)\n\n\n```js \n handleEvent(e) {\n    switch (e.type) {\n      case 'mousedown':\n        this.canvas.addEventListener('mouseup', this, false);\n        this.canvas.addEventListener('mousemove', this, false);\n        break;\n      case 'mousemove':\n        this.painting(e);\n        break;\n      case 'mouseup':\n        this.canvas.removeEventListener('mousemove', this);\n        this.canvas.removeEventListener('mouseup', this);\n        break;\n    }\n  }\n\n  registerEvents() {\n    this.canvas.addEventListener('mousedown', this, false);\n  }\n```\n\n大功告成！ 所以有问题还是得先看文档 ！！！！！ ","source":"_posts/JS对象中addEventListener this指向.md","raw":"---\ntitle: JS对象中addEventListener this指向\ntop_img: false\ndate: 2023-02-03\ncategories: \n- 前端\ntags:\n- JS\ncover: https://img0.baidu.com/it/u=2395867072,4290056404&fm=253&fmt=auto&app=120&f=JPEG?w=798&h=500\n---\n\n最近使用canvas在实现拖拽功能, 需要监听鼠标按下跟移动事件。所以创建canvas js对象来统一管理。\n但是遇到了addEventListener指向了当前元素, 导致监听事件无法移除出现问题。\n\n``` js\nexport default class FlowChatCanvas {\n  // ...业务代码省略\n  mousedown() {\n    // 此时this指向了元素本身 \n    console.log(this);\n    // 需要在鼠标按下的同时, 监听鼠标移动\n    this.canvas.addEventListener('mouseup', this.mouseup, false);\n    this.canvas.addEventListener('mousemove', this.mousemove, false);\n  }\n\n  mouseup() {}\n\n  mousemove() {}\n\n  registerEvents() {\n    this.canvas.addEventListener('mousedown', this.mousedown, false);\n  }\n}\n```\n\n### 解决\n首先想到的就是使用Bind去修改this\n```js\nthis.canvas.addEventListener('mousedown', this.mousedown.bind(this), false);\n```\n\n显而易见现在的mousedown方法中this 已经指向了对象本身。\n但是缺陷就是监听事件没法移除, 如果你不需要移除事件的话 那么这一步就能解决问题了。\n\n```js\nmousedown() {\n    // 需要在鼠标按下的同时, 监听鼠标移动\n    this.canvas.addEventListener('mouseup', this.mouseup.bind(this), false);\n    this.canvas.addEventListener('mousemove', this.mousemove.bind(this), false);\n  }\n\n  mouseup() {\n    // 鼠标松开时, 移除move事件\n    // 但是由于使用bind 导致无法移除\n    this.canvas.removeEventListener('mousemove', this.mousemove);\n    this.canvas.removeEventListener('mouseup', this.mouseup);\n  }\n\n  mousemove(e) {\n    console.log(this);\n  }\n\n  registerEvents() {\n    this.canvas.addEventListener('mousedown', this.mousedown.bind(this), false);\n  }\n```\n\n\n查阅mdn发现, 除了bind指定this值外 还可以使用handleEvent() 这个特殊函数来捕获任何事件\n\n[MDN addEventListener 处理过程中 this 的值的问题](https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener#%E5%A4%87%E6%B3%A8)\n\n\n```js \n handleEvent(e) {\n    switch (e.type) {\n      case 'mousedown':\n        this.canvas.addEventListener('mouseup', this, false);\n        this.canvas.addEventListener('mousemove', this, false);\n        break;\n      case 'mousemove':\n        this.painting(e);\n        break;\n      case 'mouseup':\n        this.canvas.removeEventListener('mousemove', this);\n        this.canvas.removeEventListener('mouseup', this);\n        break;\n    }\n  }\n\n  registerEvents() {\n    this.canvas.addEventListener('mousedown', this, false);\n  }\n```\n\n大功告成！ 所以有问题还是得先看文档 ！！！！！ ","slug":"JS对象中addEventListener this指向","published":1,"updated":"2023-02-03T02:29:13.118Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cldnx1xt40000ic77amedg2bn","content":"<p>最近使用canvas在实现拖拽功能, 需要监听鼠标按下跟移动事件。所以创建canvas js对象来统一管理。<br>但是遇到了addEventListener指向了当前元素, 导致监听事件无法移除出现问题。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FlowChatCanvas</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...业务代码省略</span></span><br><span class=\"line\">  <span class=\"title function_\">mousedown</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 此时this指向了元素本身 </span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 需要在鼠标按下的同时, 监听鼠标移动</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mouseup</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mousemove</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">mouseup</span>(<span class=\"params\"></span>) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">mousemove</span>(<span class=\"params\"></span>) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">registerEvents</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mousedown</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"解决\"><a href=\"#解决\" class=\"headerlink\" title=\"解决\"></a>解决</h3><p>首先想到的就是使用Bind去修改this</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mousedown</span>.<span class=\"title function_\">bind</span>(<span class=\"variable language_\">this</span>), <span class=\"literal\">false</span>);</span><br></pre></td></tr></table></figure>\n\n<p>显而易见现在的mousedown方法中this 已经指向了对象本身。<br>但是缺陷就是监听事件没法移除, 如果你不需要移除事件的话 那么这一步就能解决问题了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">mousedown</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 需要在鼠标按下的同时, 监听鼠标移动</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mouseup</span>.<span class=\"title function_\">bind</span>(<span class=\"variable language_\">this</span>), <span class=\"literal\">false</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mousemove</span>.<span class=\"title function_\">bind</span>(<span class=\"variable language_\">this</span>), <span class=\"literal\">false</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">mouseup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 鼠标松开时, 移除move事件</span></span><br><span class=\"line\">    <span class=\"comment\">// 但是由于使用bind 导致无法移除</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mousemove</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mouseup</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">mousemove</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">registerEvents</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mousedown</span>.<span class=\"title function_\">bind</span>(<span class=\"variable language_\">this</span>), <span class=\"literal\">false</span>);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n<p>查阅mdn发现, 除了bind指定this值外 还可以使用handleEvent() 这个特殊函数来捕获任何事件</p>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener#%E5%A4%87%E6%B3%A8\">MDN addEventListener 处理过程中 this 的值的问题</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">handleEvent</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">switch</span> (e.<span class=\"property\">type</span>) &#123;</span><br><span class=\"line\">     <span class=\"keyword\">case</span> <span class=\"string\">&#x27;mousedown&#x27;</span>:</span><br><span class=\"line\">       <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"variable language_\">this</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">       <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"variable language_\">this</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">       <span class=\"keyword\">break</span>;</span><br><span class=\"line\">     <span class=\"keyword\">case</span> <span class=\"string\">&#x27;mousemove&#x27;</span>:</span><br><span class=\"line\">       <span class=\"variable language_\">this</span>.<span class=\"title function_\">painting</span>(e);</span><br><span class=\"line\">       <span class=\"keyword\">break</span>;</span><br><span class=\"line\">     <span class=\"keyword\">case</span> <span class=\"string\">&#x27;mouseup&#x27;</span>:</span><br><span class=\"line\">       <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"variable language_\">this</span>);</span><br><span class=\"line\">       <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"variable language_\">this</span>);</span><br><span class=\"line\">       <span class=\"keyword\">break</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"title function_\">registerEvents</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">   <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"variable language_\">this</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n<p>大功告成！ 所以有问题还是得先看文档 ！！！！！ </p>\n","site":{"data":{}},"excerpt":"","more":"<p>最近使用canvas在实现拖拽功能, 需要监听鼠标按下跟移动事件。所以创建canvas js对象来统一管理。<br>但是遇到了addEventListener指向了当前元素, 导致监听事件无法移除出现问题。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FlowChatCanvas</span> &#123;</span><br><span class=\"line\">  <span class=\"comment\">// ...业务代码省略</span></span><br><span class=\"line\">  <span class=\"title function_\">mousedown</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 此时this指向了元素本身 </span></span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 需要在鼠标按下的同时, 监听鼠标移动</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mouseup</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mousemove</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">mouseup</span>(<span class=\"params\"></span>) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">mousemove</span>(<span class=\"params\"></span>) &#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">registerEvents</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mousedown</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"解决\"><a href=\"#解决\" class=\"headerlink\" title=\"解决\"></a>解决</h3><p>首先想到的就是使用Bind去修改this</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mousedown</span>.<span class=\"title function_\">bind</span>(<span class=\"variable language_\">this</span>), <span class=\"literal\">false</span>);</span><br></pre></td></tr></table></figure>\n\n<p>显而易见现在的mousedown方法中this 已经指向了对象本身。<br>但是缺陷就是监听事件没法移除, 如果你不需要移除事件的话 那么这一步就能解决问题了。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">mousedown</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 需要在鼠标按下的同时, 监听鼠标移动</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mouseup</span>.<span class=\"title function_\">bind</span>(<span class=\"variable language_\">this</span>), <span class=\"literal\">false</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mousemove</span>.<span class=\"title function_\">bind</span>(<span class=\"variable language_\">this</span>), <span class=\"literal\">false</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">mouseup</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 鼠标松开时, 移除move事件</span></span><br><span class=\"line\">    <span class=\"comment\">// 但是由于使用bind 导致无法移除</span></span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mousemove</span>);</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mouseup</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">mousemove</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"variable language_\">this</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"title function_\">registerEvents</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"variable language_\">this</span>.<span class=\"property\">mousedown</span>.<span class=\"title function_\">bind</span>(<span class=\"variable language_\">this</span>), <span class=\"literal\">false</span>);</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n\n\n<p>查阅mdn发现, 除了bind指定this值外 还可以使用handleEvent() 这个特殊函数来捕获任何事件</p>\n<p><a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/EventTarget/addEventListener#%E5%A4%87%E6%B3%A8\">MDN addEventListener 处理过程中 this 的值的问题</a></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"title function_\">handleEvent</span>(<span class=\"params\">e</span>) &#123;</span><br><span class=\"line\">   <span class=\"keyword\">switch</span> (e.<span class=\"property\">type</span>) &#123;</span><br><span class=\"line\">     <span class=\"keyword\">case</span> <span class=\"string\">&#x27;mousedown&#x27;</span>:</span><br><span class=\"line\">       <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"variable language_\">this</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">       <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"variable language_\">this</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\">       <span class=\"keyword\">break</span>;</span><br><span class=\"line\">     <span class=\"keyword\">case</span> <span class=\"string\">&#x27;mousemove&#x27;</span>:</span><br><span class=\"line\">       <span class=\"variable language_\">this</span>.<span class=\"title function_\">painting</span>(e);</span><br><span class=\"line\">       <span class=\"keyword\">break</span>;</span><br><span class=\"line\">     <span class=\"keyword\">case</span> <span class=\"string\">&#x27;mouseup&#x27;</span>:</span><br><span class=\"line\">       <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mousemove&#x27;</span>, <span class=\"variable language_\">this</span>);</span><br><span class=\"line\">       <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">removeEventListener</span>(<span class=\"string\">&#x27;mouseup&#x27;</span>, <span class=\"variable language_\">this</span>);</span><br><span class=\"line\">       <span class=\"keyword\">break</span>;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"title function_\">registerEvents</span>(<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">   <span class=\"variable language_\">this</span>.<span class=\"property\">canvas</span>.<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&#x27;mousedown&#x27;</span>, <span class=\"variable language_\">this</span>, <span class=\"literal\">false</span>);</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n<p>大功告成！ 所以有问题还是得先看文档 ！！！！！ </p>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"cla6che5f0000ys77fhxvfc1y","category_id":"cla6ecapa0001pk77g4j6cvq8","_id":"cla6ecapg0006pk779mu60p61"},{"post_id":"cla6che5m0002ys77bkto2tmx","category_id":"cla6ecape0003pk7774axfa0c","_id":"cla6ecapj000cpk77bgmygimm"},{"post_id":"cla6bjxvs0001w0779t273tpe","category_id":"cla6ecape0003pk7774axfa0c","_id":"cla6ecapj000epk77fgo31o7y"},{"post_id":"cla6che5n0004ys77h95gao5t","category_id":"cla6ecape0003pk7774axfa0c","_id":"cla6ecapk000gpk77a3x02v7z"},{"post_id":"cla6che5o0006ys7762sv411w","category_id":"cla6ecape0003pk7774axfa0c","_id":"cla6ecapl000jpk77eo513lsh"},{"post_id":"cla68v71x0000nk775wcff8ql","category_id":"cla6ecape0003pk7774axfa0c","_id":"cla6ecapl000lpk77ae4mez9l"},{"post_id":"cla6che5n0005ys7736ybbmw7","category_id":"cla6ecape0003pk7774axfa0c","_id":"cla6ecapl000npk77g4gzcww0"},{"post_id":"cla6bjxvt0002w077epv6f3ak","category_id":"cla6ecapa0001pk77g4j6cvq8","_id":"cla6ecapl000ppk773vo27f3h"},{"post_id":"cla6bjxvo0000w077afij1kl9","category_id":"cla6ecape0003pk7774axfa0c","_id":"cla6ecapl000rpk77ha2n1o0l"},{"post_id":"cla6che5m0003ys77407qb6pv","category_id":"cla6ecape0003pk7774axfa0c","_id":"cla6ecapl000tpk77dftw10ja"},{"post_id":"cla6che5k0001ys775vpe5ewu","category_id":"cla6ecape0003pk7774axfa0c","_id":"cla6ecapm000vpk772bs1elde"},{"post_id":"cla6khl5t0000qs7794s2egf9","category_id":"cla6ecape0003pk7774axfa0c","_id":"cla6khl610002qs77a3rl7nx8"},{"post_id":"clai4xvf50000lkkfff940kxj","category_id":"cla6ecape0003pk7774axfa0c","_id":"clai4xvfe0002lkkf7aqeg84s"},{"post_id":"claixhyfr00007c77fe8id3qn","category_id":"cla6ecape0003pk7774axfa0c","_id":"claixhyfx00027c77h8irfdjo"},{"post_id":"claj0dz6k0000gc772efpfme6","category_id":"cla6ecape0003pk7774axfa0c","_id":"claj0dz6m0003gc7737xmf1op"},{"post_id":"cldnx1xt40000ic77amedg2bn","category_id":"cla6ecape0003pk7774axfa0c","_id":"cldnx1xt90002ic777htw0zmz"}],"PostTag":[{"post_id":"cla6che5f0000ys77fhxvfc1y","tag_id":"cla6ecapc0002pk77dr0e6z08","_id":"cla6ecapf0005pk77byqwdxzf"},{"post_id":"cla6bjxvs0001w0779t273tpe","tag_id":"cla6ecapf0004pk7770oghqv7","_id":"cla6ecapi0009pk772opmbhjh"},{"post_id":"cla68v71x0000nk775wcff8ql","tag_id":"cla6ecapf0004pk7770oghqv7","_id":"cla6ecapj000dpk77gq4s98rc"},{"post_id":"cla6bjxvt0002w077epv6f3ak","tag_id":"cla6ecapc0002pk77dr0e6z08","_id":"cla6ecapk000ipk77dj9x6r9a"},{"post_id":"cla6bjxvo0000w077afij1kl9","tag_id":"cla6ecapi000bpk77chg4dh4t","_id":"cla6ecapl000kpk776glv7mv5"},{"post_id":"cla6che5k0001ys775vpe5ewu","tag_id":"cla6ecapk000hpk778262c9v9","_id":"cla6ecapl000opk771h7t32w1"},{"post_id":"cla6che5m0002ys77bkto2tmx","tag_id":"cla6ecapi000bpk77chg4dh4t","_id":"cla6ecapl000spk770iyn2cmf"},{"post_id":"cla6che5n0004ys77h95gao5t","tag_id":"cla6ecapl000qpk77aej4fk5k","_id":"cla6ecapm000wpk77d5hh6cng"},{"post_id":"cla6che5o0006ys7762sv411w","tag_id":"cla6ecapl000qpk77aej4fk5k","_id":"cla6ecapm000ypk77bl9f0lfk"},{"post_id":"cla6che5n0005ys7736ybbmw7","tag_id":"cla6ecapm000xpk77damn8mbv","_id":"cla6ecapm0010pk777n4idull"},{"post_id":"cla6che5m0003ys77407qb6pv","tag_id":"cla6ecapm000zpk77gmzu7h0x","_id":"cla6ecapn0011pk77dgfj8kp5"},{"post_id":"cla6khl5t0000qs7794s2egf9","tag_id":"cla6khl5x0001qs7790351ok9","_id":"cla6khl610003qs770v8g8z7f"},{"post_id":"claixhyfr00007c77fe8id3qn","tag_id":"claixhyfu00017c779o837igz","_id":"claixhyfy00037c778axya08l"},{"post_id":"claj0dz6k0000gc772efpfme6","tag_id":"cla6khl5x0001qs7790351ok9","_id":"claj0dz6m0001gc77bcp2bvvt"},{"post_id":"clai4xvf50000lkkfff940kxj","tag_id":"cla6khl5x0001qs7790351ok9","_id":"claj0dz6m0002gc77a8d2fcr9"},{"post_id":"cldnx1xt40000ic77amedg2bn","tag_id":"cldnw0e730001p4771pcc7rvl","_id":"cldnx1xt90001ic7755tm0jq7"}],"Tag":[{"name":"杂谈","_id":"cla6ecapc0002pk77dr0e6z08"},{"name":"Eslint","_id":"cla6ecapf0004pk7770oghqv7"},{"name":"Electron","_id":"cla6ecapi000bpk77chg4dh4t"},{"name":"CSS","_id":"cla6ecapk000hpk778262c9v9"},{"name":"Flutter","_id":"cla6ecapl000qpk77aej4fk5k"},{"name":"动画","_id":"cla6ecapm000xpk77damn8mbv"},{"name":"Luckysheet","_id":"cla6ecapm000zpk77gmzu7h0x"},{"name":"埋点采集","_id":"cla6khl5x0001qs7790351ok9"},{"name":"埋点","_id":"cla86z8qg0001w8to3wt1hbbg"},{"name":"埋点、vue指令","_id":"clai4xvfa0001lkkf8u2hf1uh"},{"name":"图片加载","_id":"claixhyfu00017c779o837igz"},{"name":"JS","_id":"cldnw0e730001p4771pcc7rvl"}]}}